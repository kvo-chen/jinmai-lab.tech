var Se=Object.defineProperty;var Ce=(d,s,t)=>s in d?Se(d,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[s]=t;var H=(d,s,t)=>Ce(d,typeof s!="symbol"?s+"":s,t);import{u as ce,r,A as pe,t as $,j as e,m as f,x as te,L as ie,G as Te}from"./index-DW-f9EnK.js";import Le from"./CulturalMatchingGame-DqPNqUBU.js";class Pe{constructor(s="jinmai_game"){H(this,"prefix");this.prefix=s}save(s,t){try{const a={data:t,timestamp:Date.now()};localStorage.setItem(`${this.prefix}_${s}`,JSON.stringify(a))}catch(a){console.error("Failed to save game data:",a)}}load(s,t){try{const a=localStorage.getItem(`${this.prefix}_${s}`);if(a)return JSON.parse(a).data}catch(a){console.error("Failed to load game data:",a)}return t}clear(s){try{localStorage.removeItem(`${this.prefix}_${s}`)}catch(t){console.error("Failed to clear game data:",t)}}clearAll(){try{Object.keys(localStorage).forEach(t=>{t.startsWith(this.prefix)&&localStorage.removeItem(t)})}catch(s){console.error("Failed to clear all game data:",s)}}getAllKeys(){try{return Object.keys(localStorage).filter(t=>t.startsWith(this.prefix)).map(t=>t.replace(`${this.prefix}_`,""))}catch(s){return console.error("Failed to get all game keys:",s),[]}}}const ve=new Pe;class _e{constructor(){H(this,"questions",[]);H(this,"levels",[]);H(this,"gameProgress",new Map);H(this,"nextQuestionId",1);H(this,"nextLevelId",1);this.initQuestions(),this.initLevels(),this.loadGameProgress()}initQuestions(){this.questions=[{id:`question-${this.nextQuestionId++}`,type:"single",title:"天津文化常识",content:"天津的市花是什么？",options:["梅花","月季","菊花","牡丹"],correctAnswers:[1],explanation:"天津的市花是月季，象征着天津人民的热情和活力。",hint:"天津的市花是一种四季常开的花卉。",culturalTheme:"天津地方文化",category:"天津文化"},{id:`question-${this.nextQuestionId++}`,type:"single",title:"天津传统小吃",content:'天津的传统名吃"狗不理包子"的创始人是谁？',options:["张三","李四","王五","高贵友"],correctAnswers:[3],explanation:'狗不理包子的创始人是高贵友，因其乳名"狗子"，且卖包子时忙于生意不与人说话，被顾客戏称为"狗不理"。',hint:'创始人的乳名是"狗子"。',culturalTheme:"天津地方文化",category:"天津美食"},{id:`question-${this.nextQuestionId++}`,type:"multiple",title:"天津文化遗产",content:"以下哪些是天津的国家级非物质文化遗产？",options:["杨柳青年画","泥人张彩塑","天津相声","狗不理包子制作技艺"],correctAnswers:[0,1,2,3],explanation:"杨柳青年画、泥人张彩塑、天津相声和狗不理包子制作技艺均为天津的国家级非物质文化遗产。",hint:"这些都是天津的传统特色文化。",culturalTheme:"天津地方文化",category:"天津文化遗产"},{id:`question-${this.nextQuestionId++}`,type:"judgment",title:"天津历史",content:"天津是中国北方最早开放的通商口岸之一。",correctAnswers:[0],explanation:"天津是中国北方最早开放的通商口岸之一，自1860年开埠以来，逐渐发展成为重要的工商业城市。",hint:"天津开埠时间较早。",culturalTheme:"天津地方文化",category:"天津历史"},{id:`question-${this.nextQuestionId++}`,type:"single",title:"天津方言",content:'天津方言中"嘛意思"是什么意思？',options:["什么意思","没关系","不用谢","再见"],correctAnswers:[0],explanation:'"嘛意思"是天津方言中"什么意思"的常用表达。',hint:'"嘛"是天津方言中的疑问词。',culturalTheme:"天津地方文化",category:"天津方言"},{id:`question-${this.nextQuestionId++}`,type:"single",title:"中国传统节日",content:"以下哪个节日是中国的传统节日？",options:["情人节","圣诞节","中秋节","感恩节"],correctAnswers:[2],explanation:"中秋节是中国的传统节日，每年农历八月十五，人们会赏月、吃月饼。",hint:"这个节日与月亮有关。",culturalTheme:"中国传统文化",category:"传统节日"},{id:`question-${this.nextQuestionId++}`,type:"multiple",title:"中国传统绘画",content:"以下哪些是中国传统绘画的主要形式？",options:["国画","油画","水彩画","工笔画"],correctAnswers:[0,3],explanation:"国画和工笔画是中国传统绘画的主要形式，油画和水彩画是西方绘画形式。",hint:"这些是中国本土的绘画形式。",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`question-${this.nextQuestionId++}`,type:"judgment",title:"中国传统哲学",content:'儒家思想的核心是"仁、义、礼、智、信"。',correctAnswers:[0],explanation:'儒家思想的核心是"仁、义、礼、智、信"，这是中国传统文化的重要组成部分。',hint:"这是孔子思想的核心。",culturalTheme:"中国传统文化",category:"传统哲学"},{id:`question-${this.nextQuestionId++}`,type:"single",title:"中国传统工艺",content:"青花瓷是中国哪个朝代的代表性瓷器？",options:["唐朝","宋朝","元朝","明朝"],correctAnswers:[2],explanation:"青花瓷起源于唐朝，但在元朝达到鼎盛，成为中国瓷器的代表品种之一。",hint:"这个朝代是蒙古族建立的。",culturalTheme:"中国传统文化",category:"传统工艺"},{id:`question-${this.nextQuestionId++}`,type:"single",title:"中国传统医学",content:'中医理论中的"五脏六腑"不包括以下哪个器官？',options:["心脏","肝脏","脾脏","胰腺"],correctAnswers:[3],explanation:'中医理论中的"五脏"指心、肝、脾、肺、肾，"六腑"指胆、胃、小肠、大肠、膀胱、三焦，不包括胰腺。',hint:"这个器官在西医中很重要，但中医理论中没有单独列出。",culturalTheme:"中国传统文化",category:"传统医学"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津文化入门",description:"了解天津的基本文化常识",questions:this.questions.slice(0,5),gridSize:{rows:4,cols:4},difficulty:"easy",reward:"解锁天津文化素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20cultural%20heritage%20tourism"},{id:`level-${this.nextLevelId++}`,name:"中国传统文化基础",description:"了解中国传统文化的基本常识",questions:this.questions.slice(5,10),gridSize:{rows:4,cols:4},difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁中国传统文化素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20traditional%20culture%20collection"},{id:`level-${this.nextLevelId++}`,name:"文化知识挑战",description:"综合挑战天津文化和中国传统文化知识",questions:[...this.questions.slice(0,3),...this.questions.slice(5,8)],gridSize:{rows:4,cols:5},difficulty:"hard",unlockCondition:{type:"level",value:2},reward:"解锁高级文化素材包",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20knowledge%20challenge"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getQuestions(){return[...this.questions]}getQuestionById(s){return this.questions.find(t=>t.id===s)}loadGameProgress(){const s=ve.load("quiz_game_progress",new Map);s instanceof Map?this.gameProgress=s:this.gameProgress=new Map(Object.entries(s||{}))}saveGameProgress(){const s=Object.fromEntries(this.gameProgress.entries());ve.save("quiz_game_progress",s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},unlockedHints:3,bestTimes:{},lastPlayed:new Date};this.gameProgress.set(s,t),this.saveGameProgress()}return this.gameProgress.get(s)}updateGameProgress(s,t){const l={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,l),this.saveGameProgress(),l}checkAnswer(s,t){const a=[...s.correctAnswers].sort(),l=[...t].sort();if(a.length!==l.length)return!1;for(let n=0;n<a.length;n++)if(a[n]!==l[n])return!1;return!0}calculateQuestionScore(s,t,a){let n=0;return t&&(n=10,a&&a<10?n+=5:a&&a<20&&(n+=3),s.type==="multiple"?n+=5:s.type==="judgment"&&(n+=2)),n}calculateLevelScore(s,t,a,l){const n=s/t,h=Math.round(100*n),w={easy:.3,medium:.5,hard:.8}[l]||.5,i=t*20,z=Math.max(0,i-a)*w,p={easy:1,medium:1.2,hard:1.5}[l]||1;return Math.round((h+z)*p)}completeLevel(s,t,a,l){const n=this.getGameProgress(s),h={...n.bestTimes};(!h[t]||l<h[t])&&(h[t]=l);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:h,lastPlayed:new Date};return this.gameProgress.set(s,w),this.saveGameProgress(),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),this.saveGameProgress(),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1}),this.saveGameProgress()}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const l=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?l.completedLevels.length>=n.value:n.type==="score"?l.totalScore>=n.value:!1}}const me=new _e,Ie=({isOpen:d,onClose:s})=>{var E;const{isDark:t}=ce(),{user:a}=r.useContext(pe),[l,n]=r.useState("menu"),[h,w]=r.useState([]),[i,z]=r.useState(null),[p,C]=r.useState(0),[g,L]=r.useState(null),[u,U]=r.useState([]),[k,P]=r.useState(!1),[R,G]=r.useState(!1),[D,q]=r.useState(0),[S,B]=r.useState(null),[_,W]=r.useState(null),[F,A]=r.useState(null),[K,X]=r.useState(!1),[ae,J]=r.useState(!0),[Z,ee]=r.useState(0);r.useEffect(()=>{if(d){J(!0);try{const c=me.getLevels();if(w(c),a){const N=me.getGameProgress(a.id);B(N)}}catch(c){console.error("加载游戏数据失败:",c)}finally{J(!1)}}},[d,a]),r.useEffect(()=>{i&&(C(0),L(i.questions[0]),U([]),P(!1),G(!1),q(0),n("playing"),W(new Date),A(null),X(!1),ee(0))},[i]),r.useEffect(()=>{i&&i.questions[p]&&(L(i.questions[p]),U([]),P(!1),G(!1),X(!1))},[i,p]),r.useEffect(()=>{let c;return _&&l==="playing"&&(c=setInterval(()=>{const y=Math.round((new Date().getTime()-_.getTime())/1e3);ee(y)},1e3)),()=>clearInterval(c)},[_,l]);const o=r.useCallback(c=>{if(!a){$.error("请先登录！");return}me.isLevelUnlocked(a.id,c.id)?z(c):$.error("该关卡尚未解锁！")},[a]),m=r.useCallback(c=>{k||g&&(g.type==="single"?U([c]):U(N=>N.includes(c)?N.filter(y=>y!==c):[...N,c]))},[g,k]),b=r.useCallback(()=>{if(!g||u.length===0){$.error("请选择答案！");return}const c=me.checkAnswer(g,u);P(!0),G(c),c?(q(N=>N+1),$.success("回答正确！")):$.error("回答错误")},[g,u]),T=r.useCallback(()=>{i&&(p<i.questions.length-1?C(c=>c+1):Y())},[p,i]),Y=r.useCallback(()=>{if(!a||!i)return;const N=_?Math.round((new Date().getTime()-_.getTime())/1e3):0;A(N);const y=me.calculateLevelScore(D,i.questions.length,N,i.difficulty),V=me.completeLevel(a.id,i.id,y,N);B(V),n("completed"),$.success(`关卡完成！得分：${y}`)},[a,i,D,_]),j=r.useCallback(()=>{if(!a||!S||!g)return;if(me.useHint(a.id)){X(!0);const N=me.getGameProgress(a.id);B(N),$.success("已显示提示")}else $.error("提示已用完")},[a,S,g]),M=r.useCallback(()=>{n("menu"),z(null),L(null),C(0),U([]),P(!1),G(!1),q(0),W(null),A(null),X(!1),ee(0)},[]),x=r.useCallback(()=>{i&&(C(0),L(i.questions[0]),U([]),P(!1),G(!1),q(0),n("playing"),W(new Date),A(null),X(!1),ee(0))},[i]),I=r.useCallback(c=>{if(!c)return"00:00";const N=Math.floor(c/60),y=c%60;return`${N.toString().padStart(2,"0")}:${y.toString().padStart(2,"0")}`},[]);return d?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:c=>c.target===c.currentTarget&&s(),children:e.jsxs(f.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-2xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化知识挑战"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[ae&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(te,{mode:"wait",children:l==="menu"&&!ae&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化知识挑战"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"测试你对天津地方文化和中国传统文化的了解"})]}),S&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:S.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:S.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:S.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:h.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(c=>{const N=(S==null?void 0:S.completedLevels.includes(c.id))||!1,y=!a||me.isLevelUnlocked(a.id,c.id);return e.jsxs(f.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${y?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:y?{y:-4}:{},onClick:()=>y&&o(c),children:[c.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(ie,{src:c.imageUrl,alt:c.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),N&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!y&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:c.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:c.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:c.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[c.questions.length," 题"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:c.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[c.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",I(c.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",c.reward]})]})]},c.id)})})]},"menu")}),e.jsx(te,{mode:"wait",children:l==="playing"&&i&&g&&!ae&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:M,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:j,disabled:!S||S.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(S==null?void 0:S.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"题目进度"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:p+1}),e.jsxs("span",{className:"text-xs",children:["/ ",i.questions.length]})]})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"正确题数"}),e.jsx("span",{className:"font-medium",children:D})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"用时"}),e.jsx("span",{className:"font-medium",children:I(Z)})]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h4",{className:"text-lg font-medium mb-2",children:g.title}),e.jsx("p",{className:`mb-4 ${t?"text-gray-300":"text-gray-700"}`,children:g.content}),K&&g.hint&&e.jsx("div",{className:`p-3 rounded-lg mb-4 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mt-1 mr-2"}),e.jsx("p",{className:`text-sm ${t?"text-yellow-200":"text-yellow-800"}`,children:g.hint})]})}),e.jsx("div",{className:"space-y-3",children:(E=g.options)==null?void 0:E.map((c,N)=>e.jsx(f.button,{className:`w-full p-3 rounded-lg text-left transition-all ${t?"bg-gray-800 hover:bg-gray-700":"bg-white hover:bg-gray-50"} border ${t?"border-gray-700":"border-gray-200"} ${u.includes(N)?k?R?"border-green-500 bg-green-500 bg-opacity-10":"border-red-500 bg-red-500 bg-opacity-10":"border-blue-500 bg-blue-500 bg-opacity-10":""} ${k&&g.correctAnswers.includes(N)?"border-green-500 bg-green-500 bg-opacity-10":""}`,whileHover:u.length===0?{scale:1.02}:{},onClick:()=>m(N),disabled:k,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center mr-3 border ${u.includes(N)?k?R?"border-green-500 bg-green-500 text-white":"border-red-500 bg-red-500 text-white":"border-blue-500 bg-blue-500 text-white":k&&g.correctAnswers.includes(N)?"border-green-500 bg-green-500 text-white":t?"border-gray-600":"border-gray-300"}`,children:String.fromCharCode(65+N)}),e.jsx("span",{children:c})]})},N))}),k&&e.jsxs("div",{className:`mt-4 p-3 rounded-lg ${R?t?"bg-green-900 bg-opacity-30":"bg-green-100":t?"bg-red-900 bg-opacity-30":"bg-red-100"} border ${R?t?"border-green-700":"border-green-200":t?"border-red-700":"border-red-200"}`,children:[e.jsx("h5",{className:"font-medium mb-2",children:"答案解析"}),e.jsx("p",{className:t?"text-gray-300":"text-gray-700",children:g.explanation})]})]}),e.jsx("div",{className:"flex justify-end gap-3",children:k?e.jsx("button",{onClick:T,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-green-600 hover:bg-green-700":"bg-green-500 hover:bg-green-600"} text-white`,children:p<i.questions.length-1?"下一题":"完成关卡"}):e.jsx("button",{onClick:b,disabled:u.length===0,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:"提交答案"})})]},"playing")}),e.jsx(te,{mode:"wait",children:l==="completed"&&i&&S&&!ae&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:S.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:I(F||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsxs("p",{className:"text-xl font-bold",children:[Math.round(D/i.questions.length*100),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确题数"}),e.jsxs("p",{className:"text-xl font-bold",children:[D," / ",i.questions.length]})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:x,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:M,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class Ue{constructor(){H(this,"cardDatabase",[]);H(this,"levels",[]);H(this,"gameProgress",new Map);H(this,"nextCardId",1);H(this,"nextLevelId",1);this.initCardDatabase(),this.initLevels(),this.loadGameProgress()}initCardDatabase(){[{name:"天津之眼",description:"天津标志性建筑，是世界上唯一一个桥上瞰景摩天轮。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Tianjin%20Eye%20ferris%20wheel%20night%20view",culturalTheme:"天津地方文化",category:"地标建筑"},{name:"杨柳青年画",description:"中国著名的民间木版年画，源于天津杨柳青镇。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Yangliuqing%20New%20Year%20paintings%20traditional%20Chinese%20folk%20art",culturalTheme:"天津地方文化",category:"传统艺术"},{name:"泥人张彩塑",description:"天津传统民间艺术，以泥塑造各种人物形象。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Nirenzhang%20clay%20sculptures%20traditional%20Tianjin%20art",culturalTheme:"天津地方文化",category:"传统工艺"},{name:"狗不理包子",description:"天津传统名吃，以皮薄馅大、味道鲜美著称。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Goubuli%20steamed%20buns%20traditional%20Tianjin%20food",culturalTheme:"天津地方文化",category:"传统美食"},{name:"天津相声",description:"中国北方传统曲艺形式，天津是相声的重要发源地。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Tianjin%20cross-talk%20traditional%20Chinese%20comedy",culturalTheme:"天津地方文化",category:"传统曲艺"},{name:"瓷房子",description:"天津特色建筑，用数万件古董瓷器装饰而成。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Porcelain%20House%20Tianjin%20China%20unique%20architecture",culturalTheme:"天津地方文化",category:"特色建筑"},{name:"古文化街",description:"天津著名的文化旅游街区，展示传统民俗文化。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Tianjin%20Ancient%20Culture%20Street%20traditional%20architecture",culturalTheme:"天津地方文化",category:"文化街区"},{name:"麻花",description:"天津传统小吃，酥脆香甜，造型独特。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Tianjin%20twisted%20dough%20sticks%20traditional%20snack",culturalTheme:"天津地方文化",category:"传统美食"},{name:"京剧脸谱",description:"京剧艺术中的重要元素，通过不同颜色和图案表达人物性格。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Peking%20Opera%20facial%20makeup%20traditional%20Chinese%20art",culturalTheme:"中国传统文化",category:"传统艺术"},{name:"故宫",description:"中国明清两代的皇家宫殿，世界上现存规模最大、保存最为完整的木质结构古建筑之一。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Forbidden%20City%20Beijing%20China%20ancient%20palace",culturalTheme:"中国传统文化",category:"历史建筑"},{name:"长城",description:"中国古代的军事防御工程，是世界七大奇迹之一。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Great%20Wall%20of%20China%20mountain%20scenery",culturalTheme:"中国传统文化",category:"历史遗迹"},{name:"兵马俑",description:'秦始皇陵中的陶俑群，被誉为"世界第八大奇迹"。',imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Terracotta%20Army%20Xi%27an%20China%20ancient%20sculptures",culturalTheme:"中国传统文化",category:"历史文物"},{name:"青花瓷",description:"中国传统瓷器工艺，以白地蓝花为主要特征。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Blue%20and%20white%20porcelain%20traditional%20Chinese%20craft",culturalTheme:"中国传统文化",category:"传统工艺"},{name:"书法",description:"中国特有的传统艺术，通过汉字的书写表现美感。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Chinese%20calligraphy%20traditional%20art%20brush%20writing",culturalTheme:"中国传统文化",category:"传统艺术"},{name:"剪纸",description:"中国传统民间艺术，用剪刀或刻刀在纸上剪刻图案。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Chinese%20paper%20cutting%20traditional%20folk%20art",culturalTheme:"中国传统文化",category:"传统工艺"},{name:"中国结",description:"中国传统手工艺品，象征着团结、幸福和吉祥。",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Chinese%20knot%20traditional%20decoration%20red%20thread",culturalTheme:"中国传统文化",category:"传统工艺"}].forEach(t=>{const a=`pair-${this.nextCardId}`;for(let l=0;l<2;l++)this.cardDatabase.push({id:`card-${this.nextCardId}-${l+1}`,pairId:a,name:t.name,description:t.description,imageUrl:t.imageUrl,culturalTheme:t.culturalTheme,category:t.category,isFlipped:!1,isMatched:!1,isSelected:!1});this.nextCardId++})}initLevels(){const s=this.getShuffledCards(8),t=this.getShuffledCards(12),a=this.getShuffledCards(16);this.levels=[{id:`memory-level-${this.nextLevelId++}`,name:"文化记忆入门",description:"了解天津和中国传统文化的基本元素",cards:s,gridSize:{rows:4,cols:4},difficulty:"easy",timeLimit:180,reward:"解锁文化记忆入门徽章",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Memory%20game%20easy%20level%20cultural%20elements"},{id:`memory-level-${this.nextLevelId++}`,name:"文化记忆挑战",description:"挑战你的文化记忆能力，识别更多文化元素",cards:t,gridSize:{rows:6,cols:6},difficulty:"medium",unlockCondition:{type:"level",value:1},timeLimit:300,reward:"解锁文化记忆挑战徽章",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Memory%20game%20medium%20level%20cultural%20elements"},{id:`memory-level-${this.nextLevelId++}`,name:"文化记忆大师",description:"成为文化记忆大师，挑战最难的记忆关卡",cards:a,gridSize:{rows:8,cols:8},difficulty:"hard",unlockCondition:{type:"level",value:2},timeLimit:600,reward:"解锁文化记忆大师徽章",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=512x512&prompt=Memory%20game%20hard%20level%20cultural%20elements"}]}getShuffledCards(s){const t=this.nextCardId-1,a=Math.min(s,t),l=Array.from({length:t},(z,p)=>`pair-${p+1}`),n=this.shuffleArray(l),h=new Set(n.slice(0,a)),w=this.cardDatabase.filter(z=>h.has(z.pairId));return this.shuffleArray([...w]).map(z=>({...z,isFlipped:!1,isMatched:!1,isSelected:!1}))}shuffleArray(s){const t=[...s];for(let a=t.length-1;a>0;a--){const l=Math.floor(Math.random()*(a+1));[t[a],t[l]]=[t[l],t[a]]}return t}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getLevelCards(s){const t=this.getLevelById(s);if(t)return JSON.parse(JSON.stringify(t.cards))}loadGameProgress(){const s=ve.load("memory_game_progress",new Map);s instanceof Map?this.gameProgress=s:this.gameProgress=new Map(Object.entries(s||{}))}saveGameProgress(){const s=Object.fromEntries(this.gameProgress.entries());ve.save("memory_game_progress",s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},bestTimes:{},lastPlayed:new Date};this.gameProgress.set(s,t),this.saveGameProgress()}return this.gameProgress.get(s)}updateGameProgress(s,t){const l={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,l),this.saveGameProgress(),l}calculateScore(s,t,a,l){const n=s/t,h=Math.round(1e3*n),w={easy:.5,medium:1,hard:1.5}[l],i={easy:10,medium:8,hard:6}[l],z=t*i,p=Math.max(0,z-a)*w,C={easy:1,medium:1.5,hard:2}[l];return Math.round((h+p)*C)}completeLevel(s,t,a,l){const n=this.getGameProgress(s);if(!this.getLevelById(t))return n;const w={...n.bestTimes};(!w[t]||l<w[t])&&(w[t]=l);const i={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:w,lastPlayed:new Date};return this.gameProgress.set(s,i),this.saveGameProgress(),i}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const l=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?l.completedLevels.length>=n.value:n.type==="score"?l.totalScore>=n.value:!1}}const fe=new Ue,Ge=({isOpen:d,onClose:s})=>{const{isDark:t}=ce(),{user:a}=r.useContext(pe),[l,n]=r.useState("menu"),[h,w]=r.useState([]),[i,z]=r.useState(null),[p,C]=r.useState([]),[g,L]=r.useState([]),[u,U]=r.useState(0),[k,P]=r.useState(!1),[R,G]=r.useState(null),[D,q]=r.useState(0),[S,B]=r.useState(null),[_,W]=r.useState(null),[F,A]=r.useState(!0);r.useEffect(()=>{if(d){A(!0);try{const o=fe.getLevels();if(w(o),a){const m=fe.getGameProgress(a.id);W(m)}}catch(o){console.error("加载游戏数据失败:",o)}finally{A(!1)}}},[d,a]),r.useEffect(()=>{let o;return R&&l==="playing"&&(o=setInterval(()=>{const b=Math.round((new Date().getTime()-R.getTime())/1e3);q(b)},1e3)),()=>clearInterval(o)},[R,l]),r.useEffect(()=>{if(i){const o=fe.getLevelCards(i.id);o&&(C(o),L([]),U(0),n("playing"),G(new Date),q(0),B(null),P(!1))}},[i]),r.useEffect(()=>{if(i&&l==="playing"){const o=i.cards.length/2;u===o&&ae()}},[u,i,l]);const K=r.useCallback(o=>{if(!a){$.error("请先登录！");return}fe.isLevelUnlocked(a.id,o.id)?z(o):$.error("该关卡尚未解锁！")},[a]),X=r.useCallback(o=>{l!=="playing"||k||o.isFlipped||o.isMatched||g.length>=2||(C(m=>m.map(b=>b.id===o.id?{...b,isFlipped:!0}:b)),L(m=>{const b=[...m,{...o,isFlipped:!0}];if(b.length===2){P(!0);const[T,Y]=b,j=T.pairId===Y.pairId;setTimeout(()=>{C(M=>{if(j){const x=M.map(I=>I.pairId===T.pairId?{...I,isMatched:!0,isFlipped:!0}:I);return U(I=>I+1),$.success("配对成功！"),x}else return M.map(x=>x.id===T.id||x.id===Y.id?{...x,isFlipped:!1}:x)}),L([]),P(!1)},800)}return b}))},[l,k]),ae=r.useCallback(()=>{if(!a||!i)return;const m=R?Math.round((new Date().getTime()-R.getTime())/1e3):0;B(m);const b=i.cards.length/2,T=fe.calculateScore(u,b,m,i.difficulty),Y=fe.completeLevel(a.id,i.id,T,m);W(Y),n("completed"),$.success(`关卡完成！得分：${T}`)},[a,i,u,R]),J=r.useCallback(()=>{n("menu"),z(null),C([]),L([]),U(0),G(null),q(0),B(null),P(!1)},[]),Z=r.useCallback(()=>{if(!i)return;const o=fe.getLevelCards(i.id);o&&(C(o),L([]),U(0),n("playing"),G(new Date),q(0),B(null),P(!1))},[i]),ee=r.useCallback(o=>{const m=Math.floor(o/60),b=o%60;return`${m.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`},[]);return d?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:o=>o.target===o.currentTarget&&s(),children:e.jsxs(f.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化记忆游戏"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[F&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(te,{mode:"wait",children:l==="menu"&&!F&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化记忆游戏"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"翻牌匹配相同的文化元素，挑战你的记忆力和文化知识"})]}),_&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:_.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:_.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:h.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最佳时间"}),e.jsx("p",{className:"text-xl font-bold",children:_.bestTimes&&Object.keys(_.bestTimes).length>0?ee(Math.min(...Object.values(_.bestTimes))):"--:--"})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(o=>{const m=(_==null?void 0:_.completedLevels.includes(o.id))||!1,b=!a||fe.isLevelUnlocked((a==null?void 0:a.id)||"",o.id);return e.jsxs(f.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${b?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:b?{y:-4}:{},onClick:()=>b&&K(o),children:[o.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(ie,{src:o.imageUrl,alt:o.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),m&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!b&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:o.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:o.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:o.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[o.gridSize.rows,"x",o.gridSize.cols]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[o.cards.length/2," 对卡片"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[o.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",ee(o.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",o.reward]})]})]},o.id)})})]},"menu")}),e.jsx(te,{mode:"wait",children:l==="playing"&&i&&!F&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-wrap justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 md:mb-0",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"时间"}),e.jsx("span",{className:"font-medium",children:ee(D)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已匹配"}),e.jsxs("span",{className:"font-medium",children:[u," / ",i.cards.length/2]})]}),e.jsx("button",{onClick:J,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"})]})]})}),e.jsx("div",{className:"grid gap-2 mb-6 mx-auto",style:{gridTemplateColumns:`repeat(${i.gridSize.cols}, 1fr)`,maxWidth:"600px"},children:p.map(o=>e.jsx(f.div,{className:"aspect-square perspective-1000",onClick:()=>X(o),children:e.jsxs(f.div,{className:"relative w-full h-full cursor-pointer",style:{transformStyle:"preserve-3d",transition:"transform 0.6s"},animate:{rotateY:o.isFlipped||o.isMatched?180:0},transition:{duration:.5},children:[e.jsx(f.div,{className:`absolute w-full h-full backface-hidden rounded-lg flex items-center justify-center transition-all ${t?"bg-gradient-to-br from-red-600 to-purple-600":"bg-gradient-to-br from-blue-500 to-purple-500"} shadow-md`,style:{transform:"rotateY(180deg)",backfaceVisibility:"hidden"},children:o.isMatched?e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},children:e.jsx("i",{className:"fas fa-check-circle text-4xl text-green-500"})}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-2",children:[e.jsx(ie,{src:o.imageUrl,alt:o.name,className:"w-full h-full object-cover rounded-lg mb-2",ratio:"square",fit:"cover"}),e.jsx("p",{className:"text-sm font-medium text-center",children:o.name})]})}),e.jsx(f.div,{className:`absolute w-full h-full backface-hidden rounded-lg flex items-center justify-center ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"} border ${t?"border-gray-600":"border-gray-300"} shadow-md transition-all`,style:{backfaceVisibility:"hidden"},children:e.jsx("div",{className:"text-2xl",children:e.jsx("i",{className:"fas fa-question-circle"})})})]})},o.id))}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h4",{className:"font-medium mb-2",children:"游戏提示"}),e.jsx("p",{className:`text-sm ${t?"text-gray-300":"text-gray-700"}`,children:"点击卡片查看文化元素，记住它们的位置，然后找出所有配对的卡片。 配对成功后，你可以看到文化元素的详细信息。"})]})]},"playing")}),e.jsx(te,{mode:"wait",children:l==="completed"&&i&&_&&!F&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:_.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:ee(S||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总配对数"}),e.jsx("p",{className:"text-xl font-bold",children:i.cards.length/2})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[e.jsx("button",{onClick:Z,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:J,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null},$e="cultural_puzzle_game_progress",we=[{id:"level1",name:"天津之眼",description:"天津地标建筑，世界上唯一建在桥上的摩天轮",imageUrl:"https://images.unsplash.com/photo-1618005198919-d3d4b5a92ead?w=1024&h=768&fit=crop",difficulty:"easy",pieceCount:16,rows:4,cols:4,timeLimit:300,reward:"100积分 + 1个提示",culturalTheme:"天津地标",unlockedHints:2},{id:"level2",name:"古文化街",description:"天津最具代表性的古文化街区，展示天津民俗文化",imageUrl:"https://images.unsplash.com/photo-1549298916-b41d501d3772?w=1024&h=768&fit=crop",difficulty:"medium",pieceCount:25,rows:5,cols:5,timeLimit:480,reward:"150积分 + 2个提示",culturalTheme:"天津民俗",unlockedHints:3},{id:"level3",name:"泥人张彩塑",description:"天津传统民间艺术，国家级非物质文化遗产",imageUrl:"https://images.unsplash.com/photo-1618005198919-d3d4b5a92ead?w=1024&h=768&fit=crop",difficulty:"hard",pieceCount:36,rows:6,cols:6,timeLimit:600,reward:"200积分 + 3个提示",culturalTheme:"天津非遗",unlockedHints:4}],ze=d=>{const s=[],t=100/d.cols,a=100/d.rows;let l=0;for(let n=0;n<d.rows;n++)for(let h=0;h<d.cols;h++)s.push({id:l++,x:Math.random()*100,y:Math.random()*100,width:t,height:a,correctX:h*t,correctY:n*a,isPlaced:!1,imageUrl:d.imageUrl});return We(s)},De=(d,s,t)=>Math.abs(s-d.correctX)<=5&&Math.abs(t-d.correctY)<=5,Me=d=>d.every(s=>s.isPlaced),He=(d,s,t,a)=>{let l=1e3;const n={easy:1,medium:1.5,hard:2},h=Math.max(0,1-s/d.timeLimit),w=l*h,i=Math.max(0,1-t/(d.pieceCount*2)),z=l*i,p=a*50,C=Math.round((w+z)/2*n[d.difficulty]-p);return Math.max(0,C)},Ee=()=>we,qe=d=>we.find(s=>s.id===d),Be=(d,s)=>{const t=Ne(d);if(s==="level1")return!0;const a=we.findIndex(l=>l.id===s);if(a>0){const l=we[a-1].id;return t.completedLevels.includes(l)}return!1},Ne=d=>{try{const s=localStorage.getItem($e);if(s){const t=JSON.parse(s);if(t[d])return{...t[d],lastPlayed:new Date(t[d].lastPlayed)}}}catch(s){console.error("读取游戏进度失败:",s)}return{userId:d,completedLevels:[],levelScores:{},totalScore:0,unlockedHints:3,lastPlayed:new Date}},ke=d=>{try{const s=localStorage.getItem($e),t=s?JSON.parse(s):{};t[d.userId]={...d,lastPlayed:new Date},localStorage.setItem($e,JSON.stringify(t))}catch(s){console.error("保存游戏进度失败:",s)}},Ae=(d,s,t,a)=>{const l=Ne(d);if(l.completedLevels.includes(s)||l.completedLevels.push(s),!l.levelScores[s]||t>l.levelScores[s]){l.levelScores[s]=t;const n=Object.values(l.levelScores).reduce((h,w)=>h+w,0);l.totalScore=n}return ke(l),l},Re=d=>{const s=Ne(d);return s.unlockedHints>0?(s.unlockedHints-=1,ke(s),!0):!1},We=d=>{const s=[...d];for(let t=s.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[s[t],s[a]]=[s[a],s[t]]}return s},re={generatePuzzlePieces:ze,checkPiecePlacement:De,checkPuzzleComplete:Me,calculateScore:He,getLevels:Ee,getLevel:qe,isLevelUnlocked:Be,getGameProgress:Ne,saveGameProgress:ke,completeLevel:Ae,useHint:Re},Qe=({isOpen:d,onClose:s})=>{const{isDark:t}=ce(),{user:a}=r.useContext(pe),[l,n]=r.useState("menu"),[h,w]=r.useState([]),[i,z]=r.useState(null),[p,C]=r.useState([]),[g,L]=r.useState(null),[u,U]=r.useState(null),[k,P]=r.useState(null),[R,G]=r.useState(null),[D,q]=r.useState(0),[S,B]=r.useState(0),[_,W]=r.useState(0),[F,A]=r.useState(!1),[K,X]=r.useState(!0),[ae,J]=r.useState(!1),Z=r.useRef(null);r.useEffect(()=>{if(d){X(!0);try{const c=re.getLevels();if(w(c),a){const N=re.getGameProgress(a.id);U(N)}}catch(c){console.error("加载游戏数据失败:",c)}finally{X(!1)}}},[d,a]),r.useEffect(()=>{if(i){const c=re.generatePuzzlePieces(i);C(c),n("playing"),P(new Date),G(null),q(0),B(0),W(0),A(!1),J(!1)}},[i]),r.useEffect(()=>{let c;return k&&l==="playing"&&(c=setInterval(()=>{const y=Math.round((new Date().getTime()-k.getTime())/1e3);q(y)},1e3)),()=>clearInterval(c)},[k,l]);const ee=r.useCallback(c=>{if(!a){$.error("请先登录！");return}re.isLevelUnlocked(a.id,c.id)?z(c):$.error("该关卡尚未解锁！")},[a]),o=r.useCallback((c,N)=>{N.isPlaced||L(N)},[]),m=r.useCallback(c=>{L(null)},[]),b=r.useCallback(c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},[]),T=r.useCallback(c=>{if(c.preventDefault(),!g||!Z.current)return;const N=parseInt(c.dataTransfer.getData("text/plain")),y=p.find(O=>O.id===N);if(!y||y.isPlaced)return;const V=Z.current.getBoundingClientRect(),se=(c.clientX-V.left)/V.width*100,ye=(c.clientY-V.top)/V.height*100,oe=re.checkPiecePlacement(y,se,ye),v=p.map(O=>O.id===y.id?{...O,x:oe?O.correctX:se,y:oe?O.correctY:ye,isPlaced:oe}:O);C(v),B(O=>O+1),re.checkPuzzleComplete(v)&&Y()},[g,p]),Y=r.useCallback(()=>{if(!a||!i)return;const N=k?Math.round((new Date().getTime()-k.getTime())/1e3):0;G(N);const y=re.calculateScore(i,N,S,_),V=re.completeLevel(a.id,i.id,y,N);U(V),n("completed"),$.success(`拼图完成！得分：${y}`)},[a,i,k,S,_]),j=r.useCallback(()=>{if(!a||!u||!i)return;if(re.useHint(a.id)){A(!0),W(y=>y+1);const N=re.getGameProgress(a.id);U(N),$.success("已显示提示"),setTimeout(()=>{A(!1)},3e3)}else $.error("提示已用完")},[a,u,i]),M=r.useCallback(()=>{J(c=>!c)},[]),x=r.useCallback(()=>{n("menu"),z(null),C([]),L(null),P(null),G(null),q(0),B(0),W(0),A(!1),J(!1)},[]),I=r.useCallback(()=>{if(!i)return;const c=re.generatePuzzlePieces(i);C(c),n("playing"),P(new Date),G(null),q(0),B(0),W(0),A(!1),J(!1)},[i]),E=r.useCallback(c=>{if(!c)return"00:00";const N=Math.floor(c/60),y=c%60;return`${N.toString().padStart(2,"0")}:${y.toString().padStart(2,"0")}`},[]);return u!=null&&u.unlockedHints,d?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:c=>c.target===c.currentTarget&&s(),children:e.jsxs(f.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化拼图游戏"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[K&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(te,{mode:"wait",children:l==="menu"&&!K&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化拼图游戏"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"拼合文化图片，了解天津地方文化和中国传统文化"})]}),u&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:u.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:u.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:u.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:h.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(c=>{const N=(u==null?void 0:u.completedLevels.includes(c.id))||!1,y=!a||re.isLevelUnlocked(a.id,c.id);return e.jsxs(f.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${y?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:y?{y:-4}:{},onClick:()=>y&&ee(c),children:[e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(ie,{src:c.imageUrl,alt:c.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),N&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!y&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:c.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:c.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:c.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[c.pieceCount," 片"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:c.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",E(c.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",c.reward]})]})]},c.id)})})]},"menu")}),e.jsx(te,{mode:"wait",children:l==="playing"&&i&&p.length>0&&!K&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:M,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-purple-600 hover:bg-purple-700":"bg-purple-500 hover:bg-purple-600"} text-white`,children:[e.jsx("i",{className:"fas fa-eye mr-1"}),ae?"隐藏":"显示","答案"]}),e.jsxs("button",{onClick:j,disabled:!u||u.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(u==null?void 0:u.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"时间"}),e.jsx("span",{className:"font-medium",children:E(D)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"移动次数"}),e.jsx("span",{className:"font-medium",children:S})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已完成"}),e.jsxs("span",{className:"font-medium",children:[p.filter(c=>c.isPlaced).length," / ",i.pieceCount]})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{ref:Z,className:`relative aspect-video rounded-lg overflow-hidden border ${t?"border-gray-700":"border-gray-300"} bg-${t?"gray-800":"gray-100"}`,onDragOver:b,onDrop:T,children:[ae&&e.jsx("div",{className:"absolute inset-0 opacity-50 z-0",children:e.jsx(ie,{src:i.imageUrl,alt:"Solution",className:"w-full h-full object-cover",ratio:"landscape",fit:"cover",priority:!0})}),e.jsx("div",{className:"absolute inset-0 z-0",children:Array.from({length:i.rows}).map((c,N)=>Array.from({length:i.cols}).map((y,V)=>{const se=V/i.cols*100,ye=N/i.rows*100,oe=100/i.cols,v=100/i.rows;return e.jsx("div",{className:`absolute border border-dashed ${t?"border-gray-600":"border-gray-300"} bg-opacity-10`,style:{left:`${se}%`,top:`${ye}%`,width:`${oe}%`,height:`${v}%`}},`slot-${N}-${V}`)}))}),p.map(c=>e.jsx(f.div,{className:`absolute cursor-move z-20 shadow-md ${c.isPlaced?"z-10 opacity-100":"opacity-80 hover:opacity-100"}`,style:{left:`${c.x}%`,top:`${c.y}%`,width:`${c.width}%`,height:`${c.height}%`,backgroundImage:`url(${c.imageUrl})`,backgroundPosition:`-${c.correctX}% -${c.correctY}%`,backgroundSize:`${i.cols*100}% ${i.rows*100}%`,backgroundRepeat:"no-repeat",border:t?"1px solid #4b5563":"1px solid #e5e7eb",borderRadius:"4px",opacity:c.isPlaced?1:.8},draggable:!c.isPlaced,onDragStart:N=>o(N,c),onDragEnd:m,whileHover:c.isPlaced?{}:{scale:1.05},whileTap:c.isPlaced?{}:{scale:.95},animate:c.isPlaced?{scale:[1,1.1,1],transition:{duration:.3}}:{}},c.id))]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"未放置的碎片"}),e.jsx("div",{className:`p-4 rounded-lg overflow-x-auto ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsx("div",{className:"flex gap-2 min-w-max",children:p.filter(c=>!c.isPlaced).map(c=>e.jsx(f.div,{className:`cursor-move flex-shrink-0 shadow-md ${t?"border-gray-600":"border-gray-300"}`,style:{width:"80px",height:"80px",backgroundImage:`url(${c.imageUrl})`,backgroundPosition:`-${c.correctX}% -${c.correctY}%`,backgroundSize:`${i.cols*100}% ${i.rows*100}%`,backgroundRepeat:"no-repeat",border:"1px solid",borderRadius:"4px"},draggable:!0,onDragStart:N=>o(N,c),onDragEnd:m,whileHover:{scale:1.1},whileTap:{scale:.9}},`piece-${c.id}`))})})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{onClick:I,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新开始"})})]},"playing")}),e.jsx(te,{mode:"wait",children:l==="completed"&&i&&u&&R!==null&&!K&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成拼图！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」拼图"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:u.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:E(R)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"移动次数"}),e.jsx("p",{className:"text-xl font-bold",children:S})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"提示使用"}),e.jsx("p",{className:"text-xl font-bold",children:_})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:I,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:x,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class Oe{constructor(){H(this,"sortItems",[]);H(this,"questions",[]);H(this,"levels",[]);H(this,"gameProgress",new Map);H(this,"nextItemId",1);H(this,"nextQuestionId",1);H(this,"nextLevelId",1);this.initSortItems(),this.initQuestions(),this.initLevels()}initSortItems(){this.sortItems=[{id:`item-${this.nextItemId++}`,name:"天津鼓楼",content:"天津鼓楼",sortValue:1420,description:"天津鼓楼是天津卫的发源地，始建于明永乐十八年（1420年）",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"石家大院",content:"石家大院",sortValue:1875,description:"石家大院是清代津门八大家之一石万程第四子石元士的宅第，始建于1875年",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"天津劝业场",content:"天津劝业场",sortValue:1928,description:"天津劝业场是天津商业的象征，始建于1928年",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"天津广播电视塔",content:"天津广播电视塔",sortValue:1991,description:"天津广播电视塔又称天塔，建成于1991年，是天津的标志性建筑之一",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"天津环球金融中心",content:"天津环球金融中心",sortValue:2010,description:"天津环球金融中心又称津塔，建成于2010年，是天津的摩天大楼",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"天津周大福金融中心",content:"天津周大福金融中心",sortValue:2019,description:"天津周大福金融中心又称津沽棒，建成于2019年，是天津的新地标",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`item-${this.nextItemId++}`,name:"春节",content:"春节",sortValue:1,description:"春节是中国最重要的传统节日，农历正月初一",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"元宵节",content:"元宵节",sortValue:15,description:"元宵节又称上元节，农历正月十五",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"清明节",content:"清明节",sortValue:105,description:"清明节是传统祭祖节日，农历三月初五前后",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"端午节",content:"端午节",sortValue:145,description:"端午节又称龙舟节，农历五月初五",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"中秋节",content:"中秋节",sortValue:225,description:"中秋节是传统团圆节日，农历八月十五",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"重阳节",content:"重阳节",sortValue:255,description:"重阳节又称老人节，农历九月初九",culturalTheme:"中国传统文化",category:"传统节日"},{id:`item-${this.nextItemId++}`,name:"造纸术",content:"造纸术",sortValue:105,description:"造纸术由东汉蔡伦改进，约公元105年",culturalTheme:"中国传统文化",category:"古代发明"},{id:`item-${this.nextItemId++}`,name:"印刷术",content:"印刷术",sortValue:868,description:"雕版印刷术发明于唐朝，约公元868年",culturalTheme:"中国传统文化",category:"古代发明"},{id:`item-${this.nextItemId++}`,name:"火药",content:"火药",sortValue:904,description:"火药发明于唐朝末年，约公元904年",culturalTheme:"中国传统文化",category:"古代发明"},{id:`item-${this.nextItemId++}`,name:"指南针",content:"指南针",sortValue:1044,description:"指南针发明于北宋，约公元1044年",culturalTheme:"中国传统文化",category:"古代发明"}]}initQuestions(){this.questions=[{id:`question-${this.nextQuestionId++}`,title:"天津地标建筑时间排序",description:"请按照建造时间的先后顺序排列以下天津地标建筑",items:this.sortItems.filter(s=>s.category==="天津建筑"),sortType:"asc",explanation:"天津地标建筑的建造时间顺序反映了天津城市发展的历程，从古代的鼓楼到现代的摩天大楼，见证了天津的繁荣发展。",culturalTheme:"天津地方文化",category:"天津建筑"},{id:`question-${this.nextQuestionId++}`,title:"中国传统节日时间排序",description:"请按照农历时间的先后顺序排列以下中国传统节日",items:this.sortItems.filter(s=>s.category==="传统节日"),sortType:"asc",explanation:"中国传统节日按照农历时间顺序排列，反映了中国传统文化中对自然节律的观察和尊重。",culturalTheme:"中国传统文化",category:"传统节日"},{id:`question-${this.nextQuestionId++}`,title:"中国古代四大发明时间排序",description:"请按照发明时间的先后顺序排列以下中国古代四大发明",items:this.sortItems.filter(s=>s.category==="古代发明"),sortType:"asc",explanation:"中国古代四大发明的出现时间顺序，展示了中国古代科技发展的脉络和成就。",culturalTheme:"中国传统文化",category:"古代发明"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津建筑时间线",description:"了解天津地标建筑的建造时间顺序",questions:[this.questions[0]],gridSize:{rows:4,cols:4},difficulty:"easy",reward:"解锁天津建筑素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20landmark%20buildings%20skyline"},{id:`level-${this.nextLevelId++}`,name:"中国传统节日",description:"了解中国传统节日的时间顺序",questions:[this.questions[1]],gridSize:{rows:4,cols:4},difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁中国传统节日素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20traditional%20festivals%20collection"},{id:`level-${this.nextLevelId++}`,name:"中国古代发明",description:"了解中国古代四大发明的时间顺序",questions:[this.questions[2]],gridSize:{rows:4,cols:4},difficulty:"hard",unlockCondition:{type:"level",value:2},reward:"解锁中国古代发明素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20ancient%20inventions"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getQuestions(){return[...this.questions]}getQuestionById(s){return this.questions.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},unlockedHints:3,bestTimes:{},lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const l={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,l),l}checkSort(s,t){if(t.length!==s.items.length)return!1;for(let a=0;a<t.length-1;a++){const l=t[a],n=t[a+1];if(s.sortType==="asc"){if(l.sortValue>n.sortValue)return!1}else if(l.sortValue<n.sortValue)return!1}return!0}calculateQuestionScore(s,t,a){let n=0;return t&&(n=100,a&&a<30?n+=20:a&&a<60&&(n+=10)),n}calculateLevelScore(s,t,a,l){const n=s/t,h=Math.round(100*n),w={easy:.3,medium:.5,hard:.8}[l]||.5,i=t*60,z=Math.max(0,i-a)*w,p={easy:1,medium:1.2,hard:1.5}[l]||1;return Math.round((h+z)*p)}completeLevel(s,t,a,l){const n=this.getGameProgress(s),h={...n.bestTimes};(!h[t]||l<h[t])&&(h[t]=l);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:h,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const l=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?l.completedLevels.length>=n.value:n.type==="score"?l.totalScore>=n.value:!1}}const ge=new Oe,Fe=({isOpen:d,onClose:s})=>{const{isDark:t}=ce(),{user:a}=r.useContext(pe),[l,n]=r.useState("menu"),[h,w]=r.useState([]),[i,z]=r.useState(null),[p,C]=r.useState(0),[g,L]=r.useState(null),[u,U]=r.useState([]),[k,P]=r.useState([]),[R,G]=r.useState(!1),[D,q]=r.useState(!1),[S,B]=r.useState(0),[_,W]=r.useState(null),[F,A]=r.useState(null),[K,X]=r.useState(null),[ae,J]=r.useState(!1),[Z,ee]=r.useState(!0),[o,m]=r.useState(0),[b,T]=r.useState(0);r.useEffect(()=>{if(d){ee(!0);try{const v=ge.getLevels();if(w(v),a){const Q=ge.getGameProgress(a.id);W(Q)}}catch(v){console.error("加载游戏数据失败:",v)}finally{ee(!1)}}},[d,a]),r.useEffect(()=>{i&&(C(0),L(i.questions[0]),U(i.questions[0].items),P([]),J(!1),q(!1),B(0),n("playing"),A(new Date),X(null),m(0),T(0),G(!1))},[i]),r.useEffect(()=>{i&&i.questions[p]&&(L(i.questions[p]),U(i.questions[p].items),P([]),J(!1),q(!1),G(!1))},[i,p]),r.useEffect(()=>{let v;return F&&l==="playing"&&(v=setInterval(()=>{const O=Math.round((new Date().getTime()-F.getTime())/1e3);m(O)},1e3)),()=>clearInterval(v)},[F,l]),r.useEffect(()=>{i&&l==="playing"&&S>=i.questions.length&&y()},[S,i,l]);const Y=r.useCallback(v=>{if(!a){$.error("请先登录！");return}ge.isLevelUnlocked(a.id,v.id)?z(v):$.error("该关卡尚未解锁！")},[a]),j=r.useCallback((v,Q)=>{v.dataTransfer.setData("itemId",Q.id)},[]),M=r.useCallback(v=>{v.dataTransfer.clearData("itemId")},[]),x=r.useCallback(v=>{v.preventDefault()},[]),I=r.useCallback(v=>{v.preventDefault()},[]),E=r.useCallback((v,Q)=>{v.preventDefault();const O=v.dataTransfer.getData("itemId");if(!O)return;const je=u.find(de=>de.id===O);je&&(Q!==void 0?(U(de=>de.filter(be=>be.id!==O)),P(de=>{const be=[...de];return be.splice(Q,0,je),be})):(P(de=>de.filter(be=>be.id!==O)),U(de=>[...de,je])))},[u]),c=r.useCallback(v=>{u.includes(v)?(U(Q=>Q.filter(O=>O.id!==v.id)),P(Q=>[...Q,v])):(P(Q=>Q.filter(O=>O.id!==v.id)),U(Q=>[...Q,v]))},[u]),N=r.useCallback(()=>{if(!g||k.length!==g.items.length){$.error("请将所有项排序完成！");return}G(!0);const v=ge.checkSort(g,k);q(v),v?(B(Q=>Q+1),$.success("排序正确！"),setTimeout(()=>{p<((i==null?void 0:i.questions.length)||0)-1?C(Q=>Q+1):y(),G(!1)},1500)):($.error("排序错误，请重新尝试！"),G(!1))},[g,k,p,i]),y=r.useCallback(()=>{if(!a||!i)return;const Q=F?Math.round((new Date().getTime()-F.getTime())/1e3):0;X(Q);const O=ge.calculateLevelScore(S,i.questions.length,Q,i.difficulty),je=ge.completeLevel(a.id,i.id,O,Q);W(je),n("completed"),$.success(`关卡完成！得分：${O}`)},[a,i,S,F]),V=r.useCallback(()=>{if(!a||!_||!g)return;if(ge.useHint(a.id)){J(!0),T(O=>O+1);const Q=ge.getGameProgress(a.id);W(Q),$.success("已显示提示")}else $.error("提示已用完")},[a,_,g]),se=r.useCallback(()=>{n("menu"),z(null),L(null),C(0),U([]),P([]),q(!1),B(0),A(null),X(null),J(!1),G(!1),m(0),T(0)},[]),ye=r.useCallback(()=>{i&&(C(0),L(i.questions[0]),U(i.questions[0].items),P([]),J(!1),q(!1),B(0),n("playing"),A(new Date),X(null),m(0),T(0),G(!1))},[i]),oe=r.useCallback(v=>{const Q=Math.floor(v/60),O=v%60;return`${Q.toString().padStart(2,"0")}:${O.toString().padStart(2,"0")}`},[]);return d?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:v=>v.target===v.currentTarget&&s(),children:e.jsxs(f.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化元素排序游戏"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[Z&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(te,{mode:"wait",children:l==="menu"&&!Z&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化元素排序游戏"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"按照时间顺序或逻辑顺序排列文化元素，了解天津地方文化和中国传统文化"})]}),_&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:_.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:_.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:h.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:_.unlockedHints})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(v=>{const Q=(_==null?void 0:_.completedLevels.includes(v.id))||!1,O=!a||ge.isLevelUnlocked(a.id,v.id);return e.jsxs(f.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${O?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:O?{y:-4}:{},onClick:()=>O&&Y(v),children:[v.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(ie,{src:v.imageUrl,alt:v.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),Q&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!O&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:v.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:v.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:v.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[v.questions.length," 题"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:v.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[v.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",oe(v.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",v.reward]})]})]},v.id)})})]},"menu")}),e.jsx(te,{mode:"wait",children:l==="playing"&&i&&g&&!Z&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-wrap justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 md:mb-0",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"时间"}),e.jsx("span",{className:"font-medium",children:oe(o)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"进度"}),e.jsxs("span",{className:"font-medium",children:[p+1," / ",i.questions.length]})]}),e.jsx("button",{onClick:se,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:V,disabled:!_||_.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(_==null?void 0:_.unlockedHints)||0,")"]})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h4",{className:"text-lg font-medium mb-2",children:g.title}),e.jsx("p",{className:`mb-4 ${t?"text-gray-300":"text-gray-700"}`,children:g.description}),ae&&e.jsx("div",{className:`p-3 rounded-lg mb-4 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mt-1 mr-2"}),e.jsxs("p",{className:`text-sm ${t?"text-yellow-200":"text-yellow-800"}`,children:["提示：请按照",g.sortType==="asc"?"升序":"降序","排列"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-md font-medium mb-3",children:"待排序项"}),e.jsx("div",{className:`min-h-[200px] p-4 rounded-lg border-2 border-dashed ${t?"border-gray-600 bg-gray-800":"border-gray-300 bg-gray-50"} transition-all hover:border-blue-500`,onDragOver:I,onDragEnter:x,onDrop:v=>E(v),children:u.length===0?e.jsx("p",{className:`text-center py-8 ${t?"text-gray-500":"text-gray-400"}`,children:"所有项已排序"}):e.jsx("div",{className:"space-y-3",children:u.map(v=>e.jsxs("div",{className:`p-3 rounded-lg cursor-move transition-all ${t?"bg-gray-700 hover:bg-gray-600":"bg-white hover:bg-gray-50"} border ${t?"border-gray-600":"border-gray-200"} hover:shadow-md`,draggable:!0,onClick:()=>c(v),onDragStart:Q=>j(Q,v),onDragEnd:M,children:[e.jsx("h6",{className:"font-medium",children:v.name}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-gray-400":"text-gray-500"}`,children:v.content})]},v.id))})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-md font-medium mb-3",children:"已排序项"}),e.jsx("div",{className:`min-h-[200px] p-4 rounded-lg border-2 border-dashed ${t?"border-gray-600 bg-gray-800":"border-gray-300 bg-gray-50"} transition-all hover:border-blue-500`,children:k.length===0?e.jsx("p",{className:`text-center py-8 ${t?"text-gray-500":"text-gray-400"}`,children:"拖拽或点击项到此处进行排序"}):e.jsx("div",{className:"space-y-3",children:k.map((v,Q)=>e.jsx("div",{className:`p-3 rounded-lg cursor-move transition-all ${t?"bg-gray-700 hover:bg-gray-600":"bg-white hover:bg-gray-50"} border ${t?"border-gray-600":"border-gray-200"} hover:shadow-md`,draggable:!0,onDragStart:O=>j(O,v),onDragEnd:M,onDragOver:I,onDragEnter:x,onDrop:O=>E(O,Q),onClick:()=>c(v),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium",children:v.name}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-gray-400":"text-gray-500"}`,children:v.content})]}),e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${t?"bg-gray-600":"bg-gray-200"}`,children:Q+1})]})},v.id))})})]})]}),R&&D&&e.jsx("div",{className:`p-3 rounded-lg ${t?"bg-green-900 bg-opacity-30":"bg-green-100"} border ${t?"border-green-700":"border-green-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mt-1 mr-2"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-1",children:"回答正确！"}),e.jsx("p",{className:`text-sm ${t?"text-green-200":"text-green-800"}`,children:g.explanation})]})]})}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{onClick:N,disabled:R||k.length!==g.items.length,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:R?"检查中...":"提交排序"})})]})]},"playing")}),e.jsx(te,{mode:"wait",children:l==="completed"&&i&&_&&!Z&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:_.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:oe(K||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总题数"}),e.jsx("p",{className:"text-xl font-bold",children:i.questions.length})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[e.jsx("button",{onClick:ye,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:se,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class Ve{constructor(){H(this,"riddles",[]);H(this,"levels",[]);H(this,"gameProgress",new Map);H(this,"nextRiddleId",1);H(this,"nextLevelId",1);this.initRiddles(),this.initLevels()}initRiddles(){this.riddles=[{id:`riddle-${this.nextRiddleId++}`,title:"天津特产",content:"形如元宝，皮薄馅大，咬一口汤汁四溢，天津名吃人人夸。",hints:["这是天津的传统名吃","它的名字和狗有关","它是一种包子"],answer:"狗不理包子",explanation:'狗不理包子是天津的传统名吃，因其创始人高贵友乳名"狗子"而得名，以皮薄馅大、汤汁鲜美著称。',culturalTheme:"天津地方文化",category:"天津美食",difficulty:"easy"},{id:`riddle-${this.nextRiddleId++}`,title:"天津地标",content:"一座铁桥横跨海河，百年历史见证天津变迁。",hints:["这是天津的标志性桥梁","它的名字与一个国家有关","它建于1907年"],answer:"解放桥",explanation:"解放桥原名万国桥，是天津的标志性桥梁，横跨海河，建于1907年，见证了天津的百年变迁。",culturalTheme:"天津地方文化",category:"天津建筑",difficulty:"easy"},{id:`riddle-${this.nextRiddleId++}`,title:"天津民俗",content:"正月十五闹花灯，天津特色民俗活动。",hints:["这是天津的传统民俗活动","它在元宵节举行","活动地点在天津的一个著名古文化街"],answer:"杨柳青灯会",explanation:"杨柳青灯会是天津的传统民俗活动，每年元宵节在杨柳青古镇举行，展示精美的花灯和传统文化。",culturalTheme:"天津地方文化",category:"天津民俗",difficulty:"medium"},{id:`riddle-${this.nextRiddleId++}`,title:"传统节日",content:"嫦娥奔月的故事与之相关，家家户户吃月饼。",hints:["这是中国的传统节日","它在农历八月十五","与月亮有关"],answer:"中秋节",explanation:"中秋节是中国的传统节日，每年农历八月十五，人们会赏月、吃月饼，嫦娥奔月是与中秋节相关的传说故事。",culturalTheme:"中国传统文化",category:"传统节日",difficulty:"easy"},{id:`riddle-${this.nextRiddleId++}`,title:"传统艺术",content:"一支毛笔，一张宣纸，挥洒自如，中国特色绘画。",hints:["这是中国的传统绘画形式","使用水墨作为主要颜料","强调意境和神韵"],answer:"国画",explanation:"国画是中国的传统绘画形式，使用毛笔、宣纸和水墨等工具，强调意境和神韵，是中国传统文化的重要组成部分。",culturalTheme:"中国传统文化",category:"传统艺术",difficulty:"easy"},{id:`riddle-${this.nextRiddleId++}`,title:"历史人物",content:'儒家学派创始人，主张"仁"和"礼"。',hints:["他是中国古代思想家","他的弟子记录了他的言行",'他被尊称为"圣人"'],answer:"孔子",explanation:'孔子是儒家学派的创始人，主张"仁"和"礼"，是中国古代伟大的思想家、教育家，被尊称为"圣人"。',culturalTheme:"中国传统文化",category:"历史人物",difficulty:"medium"},{id:`riddle-${this.nextRiddleId++}`,title:"传统工艺",content:"以泥为原料，塑造栩栩如生的人物形象。",hints:["这是中国的传统民间工艺",'天津有著名的"泥人张"',"使用泥土作为主要材料"],answer:"泥人",explanation:'泥人是中国的传统民间工艺，以泥土为原料，塑造栩栩如生的人物形象，天津的"泥人张"是其中的代表。',culturalTheme:"中国传统文化",category:"传统工艺",difficulty:"medium"},{id:`riddle-${this.nextRiddleId++}`,title:"传统节日",content:"屈原投江的故事与之相关，人们赛龙舟、吃粽子。",hints:["这是中国的传统节日","它在农历五月初五","与一位爱国诗人有关"],answer:"端午节",explanation:"端午节是中国的传统节日，每年农历五月初五，人们会赛龙舟、吃粽子，以纪念爱国诗人屈原。",culturalTheme:"中国传统文化",category:"传统节日",difficulty:"easy"},{id:`riddle-${this.nextRiddleId++}`,title:"天津历史",content:'天津古代的名称，意为"天子经过的渡口"。',hints:["这是天津的古称","与明朝皇帝朱棣有关","意为天子经过的渡口"],answer:"天津卫",explanation:'天津卫是天津的古称，意为"天子经过的渡口"，明朝永乐二年（1404年），朱棣为纪念自己在此渡过大运河南下争夺皇位，赐名"天津"。',culturalTheme:"天津地方文化",category:"天津历史",difficulty:"hard"},{id:`riddle-${this.nextRiddleId++}`,title:"传统哲学",content:"老子的代表作，蕴含深刻的道家思想。",hints:["这是中国古代哲学著作","作者是老子","全书共81章"],answer:"道德经",explanation:"《道德经》是老子的代表作，蕴含深刻的道家思想，全书共81章，是中国古代哲学的重要经典。",culturalTheme:"中国传统文化",category:"传统哲学",difficulty:"hard"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津文化入门",description:"了解天津的基本文化常识",riddles:this.riddles.filter(s=>s.culturalTheme==="天津地方文化"&&s.difficulty==="easy"),gridSize:{rows:4,cols:4},difficulty:"easy",reward:"解锁天津文化素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20cultural%20heritage"},{id:`level-${this.nextLevelId++}`,name:"中国传统文化基础",description:"了解中国传统文化的基本常识",riddles:this.riddles.filter(s=>s.culturalTheme==="中国传统文化"&&s.difficulty==="easy"),gridSize:{rows:4,cols:4},difficulty:"easy",reward:"解锁中国传统文化素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20traditional%20culture%20collection"},{id:`level-${this.nextLevelId++}`,name:"天津文化进阶",description:"深入了解天津的文化底蕴",riddles:this.riddles.filter(s=>s.culturalTheme==="天津地方文化"&&s.difficulty==="medium"),gridSize:{rows:4,cols:4},difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁天津文化高级素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20traditional%20culture"},{id:`level-${this.nextLevelId++}`,name:"中国传统文化进阶",description:"深入了解中国传统文化的丰富内涵",riddles:this.riddles.filter(s=>s.culturalTheme==="中国传统文化"&&s.difficulty==="medium"),gridSize:{rows:4,cols:4},difficulty:"medium",unlockCondition:{type:"level",value:2},reward:"解锁中国传统文化高级素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20traditional%20art"},{id:`level-${this.nextLevelId++}`,name:"文化知识挑战",description:"综合挑战天津文化和中国传统文化知识",riddles:this.riddles.filter(s=>s.difficulty==="hard"),gridSize:{rows:4,cols:4},difficulty:"hard",unlockCondition:{type:"level",value:4},reward:"解锁高级文化素材包",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20knowledge%20challenge"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getRiddles(){return[...this.riddles]}getRiddleById(s){return this.riddles.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},unlockedHints:3,bestTimes:{},lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const l={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,l),l}checkAnswer(s,t){const a=t.trim().toLowerCase(),l=s.answer.trim().toLowerCase();return a===l}calculateRiddleScore(s,t,a,l){const n={easy:50,medium:100,hard:150}[s.difficulty];let h=0;return t&&(h=n,a&&a<10?h+=20:a&&a<30&&(h+=10),l&&(h=Math.max(0,h-l*10))),h}calculateLevelScore(s,t,a,l,n){const h=s/t,w=Math.round(100*h),i={easy:.3,medium:.5,hard:.8}[l]||.5,z=t*60,p=Math.max(0,z-a)*i,C={easy:1,medium:1.2,hard:1.5}[l]||1,g=n*5;return Math.round((w+p-g)*C)}completeLevel(s,t,a,l){const n=this.getGameProgress(s),h={...n.bestTimes};(!h[t]||l<h[t])&&(h[t]=l);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:h,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const l=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?l.completedLevels.length>=n.value:n.type==="score"?l.totalScore>=n.value:!1}}const le=new Ve,Ye=({isOpen:d,onClose:s})=>{const{isDark:t}=ce(),{user:a}=r.useContext(pe),[l,n]=r.useState("menu"),[h,w]=r.useState([]),[i,z]=r.useState(null),[p,C]=r.useState(0),[g,L]=r.useState(null),[u,U]=r.useState(""),[k,P]=r.useState(!1),[R,G]=r.useState(!1),[D,q]=r.useState(0),[S,B]=r.useState(null),[_,W]=r.useState(null),[F,A]=r.useState(null),[K,X]=r.useState(0),[ae,J]=r.useState(!1),[Z,ee]=r.useState(!0),[o,m]=r.useState(0),[b,T]=r.useState(0);r.useEffect(()=>{if(d){ee(!0);try{const y=le.getLevels();if(w(y),a){const V=le.getGameProgress(a.id);B(V)}}catch(y){console.error("加载游戏数据失败:",y)}finally{ee(!1)}}},[d,a]),r.useEffect(()=>{i&&(C(0),L(i.riddles[0]),U(""),P(!1),G(!1),q(0),n("playing"),W(new Date),A(null),X(0),J(!1),m(0),T(0))},[i]),r.useEffect(()=>{i&&i.riddles[p]&&(L(i.riddles[p]),U(""),P(!1),G(!1),X(0),J(!1))},[i,p]),r.useEffect(()=>{let y;return _&&l==="playing"&&(y=setInterval(()=>{const se=Math.round((new Date().getTime()-_.getTime())/1e3);m(se)},1e3)),()=>clearInterval(y)},[_,l]),r.useEffect(()=>{i&&l==="playing"&&D>=i.riddles.length&&M()},[D,i,l]);const Y=r.useCallback(y=>{if(!a){$.error("请先登录！");return}le.isLevelUnlocked(a.id,y.id)?z(y):$.error("该关卡尚未解锁！")},[a]),j=r.useCallback(()=>{if(!g||u.trim()===""){$.error("请输入答案！");return}P(!0);const y=le.checkAnswer(g,u);G(y),y?(q(V=>V+1),$.success("回答正确！"),setTimeout(()=>{p<((i==null?void 0:i.riddles.length)||0)-1?C(V=>V+1):M(),P(!1)},1500)):($.error("回答错误，请重新尝试！"),P(!1))},[g,u,p,i]),M=r.useCallback(()=>{if(!a||!i)return;const V=_?Math.round((new Date().getTime()-_.getTime())/1e3):0;A(V);const se=le.calculateLevelScore(D,i.riddles.length,V,i.difficulty,b),ye=le.completeLevel(a.id,i.id,se,V);B(ye),n("completed"),$.success(`关卡完成！得分：${se}`)},[a,i,D,_,b]),x=r.useCallback(()=>{if(!a||!S||!g)return;if(K>=g.hints.length){$.error("提示已用完");return}if(le.useHint(a.id)){J(!0),T(se=>se+1);const V=le.getGameProgress(a.id);B(V),$.success("已显示提示")}else $.error("提示已用完")},[a,S,g,K]),I=r.useCallback(()=>{if(!a||!g||K>=g.hints.length-1)return;if(le.useHint(a.id)){X(se=>se+1),T(se=>se+1);const V=le.getGameProgress(a.id);B(V),$.success("已显示下一个提示")}else $.error("提示已用完")},[a,g,K]),E=r.useCallback(()=>{n("menu"),z(null),L(null),C(0),U(""),G(!1),q(0),W(null),A(null),X(0),J(!1),P(!1),m(0),T(0)},[]),c=r.useCallback(()=>{i&&(C(0),L(i.riddles[0]),U(""),G(!1),q(0),n("playing"),W(new Date),A(null),X(0),J(!1),m(0),T(0),P(!1))},[i]),N=r.useCallback(y=>{const V=Math.floor(y/60),se=y%60;return`${V.toString().padStart(2,"0")}:${se.toString().padStart(2,"0")}`},[]);return d?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:y=>y.target===y.currentTarget&&s(),children:e.jsxs(f.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-2xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化猜谜游戏"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[Z&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(te,{mode:"wait",children:l==="menu"&&!Z&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化猜谜游戏"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"根据提示猜文化元素、成语或历史人物，了解天津地方文化和中国传统文化"})]}),S&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:S.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:S.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:h.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:S.unlockedHints})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(y=>{const V=(S==null?void 0:S.completedLevels.includes(y.id))||!1,se=!a||le.isLevelUnlocked(a.id,y.id);return e.jsxs(f.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${se?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:se?{y:-4}:{},onClick:()=>se&&Y(y),children:[y.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(ie,{src:y.imageUrl,alt:y.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),V&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!se&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:y.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:y.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:y.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[y.riddles.length," 题"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:y.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[y.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",N(y.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",y.reward]})]})]},y.id)})})]},"menu")}),e.jsx(te,{mode:"wait",children:l==="playing"&&i&&g&&!Z&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-wrap justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium mb-2 md:mb-0",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"时间"}),e.jsx("span",{className:"font-medium",children:N(o)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"} min-w-[120px]`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"进度"}),e.jsxs("span",{className:"font-medium",children:[p+1," / ",i.riddles.length]})]}),e.jsx("button",{onClick:E,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("h4",{className:"text-lg font-medium mb-2",children:["第 ",p+1," 题：",g.title]}),e.jsx("p",{className:`mb-6 text-lg ${t?"text-gray-300":"text-gray-700"}`,children:g.content}),ae&&g.hints[K]&&e.jsx("div",{className:`p-3 rounded-lg mb-4 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mr-2"}),e.jsxs("span",{className:`font-medium ${t?"text-yellow-200":"text-yellow-800"}`,children:["提示 ",K+1,"/",g.hints.length]})]}),e.jsx("p",{className:`text-sm ${t?"text-yellow-200":"text-yellow-800"} mb-2`,children:g.hints[K]}),K<g.hints.length-1&&e.jsx("button",{onClick:I,className:`text-xs self-start px-2 py-1 rounded-lg ${t?"bg-yellow-800 hover:bg-yellow-700 text-yellow-200":"bg-yellow-200 hover:bg-yellow-300 text-yellow-800"}`,children:"获取下一个提示"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",placeholder:"请输入答案...",value:u,onChange:y=>U(y.target.value),onKeyPress:y=>y.key==="Enter"&&j(),className:`flex-1 px-4 py-3 rounded-lg ${t?"bg-gray-800 border-gray-700 text-white":"bg-white border-gray-300 text-gray-900"} border focus:outline-none focus:ring-2 focus:ring-blue-500`,disabled:k}),e.jsx("button",{onClick:j,disabled:k||u.trim()==="",className:`px-4 py-3 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:k?"检查中...":"提交"})]}),e.jsx("div",{className:"mt-2 text-right",children:e.jsxs("button",{onClick:x,disabled:ae&&K>=g.hints.length-1,className:`text-sm px-3 py-1 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"获取提示 (",(S==null?void 0:S.unlockedHints)||0,")"]})})]}),k&&R&&e.jsx("div",{className:`p-3 rounded-lg ${t?"bg-green-900 bg-opacity-30":"bg-green-100"} border ${t?"border-green-700":"border-green-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mt-1 mr-2"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-1",children:"回答正确！"}),e.jsx("p",{className:`text-sm ${t?"text-green-200":"text-green-800"}`,children:g.explanation})]})]})})]})]},"playing")}),e.jsx(te,{mode:"wait",children:l==="completed"&&i&&S&&!Z&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:S.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:N(F||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsxs("p",{className:"text-xl font-bold",children:[Math.round(D/i.riddles.length*100),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总题数"}),e.jsx("p",{className:"text-xl font-bold",children:i.riddles.length})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[e.jsx("button",{onClick:c,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:E,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class Xe{constructor(){H(this,"words",[]);H(this,"levels",[]);H(this,"gameProgress",new Map);H(this,"nextWordId",1);H(this,"nextLevelId",1);this.initWords(),this.initLevels()}initWords(){this.words=[{id:`word-${this.nextWordId++}`,word:"天津",pinyin:"tiān jīn",meaning:"中国四大直辖市之一，位于华北平原东北部",culturalTheme:"天津地方文化",category:"地理"},{id:`word-${this.nextWordId++}`,word:"津门",pinyin:"jīn mén",meaning:"天津的别称",culturalTheme:"天津地方文化",category:"地理"},{id:`word-${this.nextWordId++}`,word:"门脸",pinyin:"mén liǎn",meaning:"天津方言，指店铺的门面",culturalTheme:"天津地方文化",category:"方言"},{id:`word-${this.nextWordId++}`,word:"脸谱",pinyin:"liǎn pǔ",meaning:"戏曲演员面部化妆的谱式",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"谱曲",pinyin:"pǔ qǔ",meaning:"为歌词配上曲子",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"曲艺",pinyin:"qǔ yì",meaning:"中国传统的说唱艺术",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"艺术",pinyin:"yì shù",meaning:"用形象来反映现实但比现实有典型性的社会意识形态",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"术语",pinyin:"shù yǔ",meaning:"各门学科中用以表示严格规定的意义的专门用语",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"语文",pinyin:"yǔ wén",meaning:"语言和文学的简称",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"文学",pinyin:"wén xué",meaning:"以语言文字为工具形象化地反映客观现实的艺术",culturalTheme:"中国传统文化",category:"传统文学"},{id:`word-${this.nextWordId++}`,word:"学问",pinyin:"xué wèn",meaning:"系统的知识",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"问题",pinyin:"wèn tí",meaning:"要求回答或解释的题目",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"题材",pinyin:"tí cái",meaning:"构成文学和艺术作品的材料",culturalTheme:"中国传统文化",category:"传统文学"},{id:`word-${this.nextWordId++}`,word:"才子",pinyin:"cái zǐ",meaning:"指有才华的男子",culturalTheme:"中国传统文化",category:"历史人物"},{id:`word-${this.nextWordId++}`,word:"子孙",pinyin:"zǐ sūn",meaning:"儿子和孙子，泛指后代",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"孙女",pinyin:"sūn nǚ",meaning:"儿子的女儿",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"女儿",pinyin:"nǚ ér",meaning:"女孩子",culturalTheme:"中国传统文化",category:"文化常识"},{id:`word-${this.nextWordId++}`,word:"儿歌",pinyin:"ér gē",meaning:"为儿童创作的歌曲",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"歌唱",pinyin:"gē chàng",meaning:"用唱歌、朗诵等形式颂扬",culturalTheme:"中国传统文化",category:"传统艺术"},{id:`word-${this.nextWordId++}`,word:"唱戏",pinyin:"chàng xì",meaning:"表演戏曲",culturalTheme:"中国传统文化",category:"传统艺术"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"文化入门接龙",description:"了解基本的文化词汇，进行简单的接龙游戏",words:this.words.slice(0,10),difficulty:"easy",reward:"解锁文化词汇素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20word%20chain%20game"},{id:`level-${this.nextLevelId++}`,name:"天津文化接龙",description:"学习天津文化相关词汇，进行接龙游戏",words:this.words.slice(0,5).concat(this.words.slice(15,20)),difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁天津文化词汇素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20cultural%20word%20chain%20game"},{id:`level-${this.nextLevelId++}`,name:"文化词汇挑战",description:"挑战更复杂的文化词汇接龙",words:this.words,difficulty:"hard",unlockCondition:{type:"level",value:2},timeLimit:300,reward:"解锁高级文化词汇素材包",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20word%20chain%20challenge"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getWords(){return[...this.words]}getWordById(s){return this.words.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},bestTimes:{},unlockedHints:3,lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const l={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,l),l}checkWordChain(s,t){return!s||!t?!1:s.slice(-1)===t.slice(0,1)}isWordInLevel(s,t){return t.words.some(a=>a.word===s)}calculateLevelScore(s,t,a){const l=s*10,n={easy:.3,medium:.5,hard:.8}[a]||.5,h=s*20,w=Math.max(0,h-t)*n,i={easy:1,medium:1.2,hard:1.5}[a]||1;return Math.round((l+w)*i)}completeLevel(s,t,a,l){const n=this.getGameProgress(s),h={...n.bestTimes};(!h[t]||l<h[t])&&(h[t]=l);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:h,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const l=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?l.completedLevels.length>=n.value:n.type==="score"?l.totalScore>=n.value:!1}}const ne=new Xe,Je=({isOpen:d,onClose:s})=>{const{isDark:t}=ce(),{user:a}=r.useContext(pe),[l,n]=r.useState("menu"),[h,w]=r.useState([]),[i,z]=r.useState(null),[p,C]=r.useState([]),[g,L]=r.useState(""),[u,U]=r.useState(""),[k,P]=r.useState(!1),[R,G]=r.useState(""),[D,q]=r.useState(null),[S,B]=r.useState(null),[_,W]=r.useState(null),[F,A]=r.useState(!0),[K,X]=r.useState(0);r.useEffect(()=>{if(d){A(!0);try{const j=ne.getLevels();if(w(j),a){const M=ne.getGameProgress(a.id);q(M)}}catch(j){console.error("加载游戏数据失败:",j)}finally{A(!1)}}},[d,a]),r.useEffect(()=>{if(i){const j=i.words[Math.floor(Math.random()*i.words.length)].word;C([j]),U(j),L(""),P(!1),G(""),n("playing"),B(new Date),W(null),X(0)}},[i]),r.useEffect(()=>{let j;return S&&l==="playing"&&(j=setInterval(()=>{const x=Math.round((new Date().getTime()-S.getTime())/1e3);X(x)},1e3)),()=>clearInterval(j)},[S,l]);const ae=r.useCallback(j=>{if(!a){$.error("请先登录！");return}ne.isLevelUnlocked(a.id,j.id)?z(j):$.error("该关卡尚未解锁！")},[a]),J=r.useCallback(j=>{L(j.target.value)},[]),Z=r.useCallback(()=>{if(!i||!g.trim()||!u)return;const j=g.trim();if(!ne.isWordInLevel(j,i)){$.error("该词汇不在关卡词汇列表中！");return}if(!ne.checkWordChain(u,j)){$.error("词汇接龙无效，请确保前一个词的最后一个字作为下一个词的第一个字！");return}if(p.includes(j)){$.error("该词汇已经使用过，请换一个！");return}const M=[...p,j];C(M),U(j),L(""),P(!1),G(""),M.length>=i.words.length/2&&m(),$.success("词汇接龙成功！")},[i,g,u,p]),ee=r.useCallback(j=>{j.key==="Enter"&&Z()},[Z]),o=r.useCallback(()=>{if(!a||!D||!i||!u)return;if(ne.useHint(a.id)){const M=i.words.filter(I=>!p.includes(I.word)).filter(I=>I.word.startsWith(u.slice(-1)));if(M.length>0){const I=M[Math.floor(Math.random()*M.length)].word;G(I),P(!0)}const x=ne.getGameProgress(a.id);q(x),$.success("已显示提示")}else $.error("提示已用完")},[a,D,i,u,p]),m=r.useCallback(()=>{if(!a||!i)return;const M=S?Math.round((new Date().getTime()-S.getTime())/1e3):0;W(M);const x=ne.calculateLevelScore(p.length,M,i.difficulty),I=ne.completeLevel(a.id,i.id,x,M);q(I),n("completed"),$.success(`关卡完成！得分：${x}`)},[a,i,p,S]),b=r.useCallback(()=>{n("menu"),z(null),C([]),U(""),L(""),P(!1),G(""),B(null),W(null),X(0)},[]),T=r.useCallback(()=>{if(!i)return;const j=i.words[Math.floor(Math.random()*i.words.length)].word;C([j]),U(j),L(""),P(!1),G(""),n("playing"),B(new Date),W(null),X(0)},[i]),Y=r.useCallback(j=>{if(!j)return"00:00";const M=Math.floor(j/60),x=j%60;return`${M.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`},[]);return d?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:j=>j.target===j.currentTarget&&s(),children:e.jsxs(f.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-2xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化词汇接龙"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[F&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(te,{mode:"wait",children:l==="menu"&&!F&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化词汇接龙"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"根据文化主题进行词汇接龙，前一个词的最后一个字作为下一个词的第一个字"})]}),D&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:D.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:D.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:D.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:h.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(j=>{const M=(D==null?void 0:D.completedLevels.includes(j.id))||!1,x=!a||ne.isLevelUnlocked(a.id,j.id);return e.jsxs(f.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${x?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:x?{y:-4}:{},onClick:()=>x&&ae(j),children:[j.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(ie,{src:j.imageUrl,alt:j.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),M&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!x&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:j.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:j.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:j.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[j.words.length," 词汇"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:j.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[j.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",Y(j.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",j.reward]})]})]},j.id)})})]},"menu")}),e.jsx(te,{mode:"wait",children:l==="playing"&&i&&!F&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:b,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:o,disabled:!D||D.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(D==null?void 0:D.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"接龙长度"}),e.jsx("span",{className:"font-medium",children:p.length})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已用时间"}),e.jsx("span",{className:"font-medium",children:Y(K)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"剩余词汇"}),e.jsx("span",{className:"font-medium",children:i.words.length-p.length})]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg mb-4 ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h4",{className:"text-lg font-medium mb-3",children:"词汇链"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:p.map((j,M)=>e.jsx(f.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3,delay:M*.1},className:`px-3 py-2 rounded-full ${t?"bg-blue-600":"bg-blue-500"} text-white text-sm font-medium`,children:j},M))}),k&&R&&e.jsx("div",{className:`p-3 rounded-lg mb-4 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mt-1 mr-2"}),e.jsxs("p",{className:`text-sm ${t?"text-yellow-200":"text-yellow-800"}`,children:["提示：可以接「",R,"」"]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:g,onChange:J,onKeyPress:ee,placeholder:`请输入以「${u.slice(-1)}」开头的词汇`,className:`flex-grow p-3 rounded-lg ${t?"bg-gray-800 border-gray-700 text-white":"bg-white border-gray-300 text-gray-900"} border focus:outline-none focus:ring-2 focus:ring-blue-500`,disabled:!u}),e.jsx("button",{onClick:Z,disabled:!g.trim(),className:`px-4 py-3 rounded-lg transition-colors ${t?"bg-green-600 hover:bg-green-700":"bg-green-500 hover:bg-green-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:"提交"})]})]})]},"playing")}),e.jsx(te,{mode:"wait",children:l==="completed"&&i&&D&&!F&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:D.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:Y(_||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"接龙长度"}),e.jsx("p",{className:"text-xl font-bold",children:p.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:T,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:b,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class Ke{constructor(){H(this,"levels",[]);H(this,"gameProgress",new Map);H(this,"nextLevelId",1);H(this,"nextDifferenceId",1);this.initLevels()}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津古文化街",description:"找出两张天津古文化街图片的不同之处",originalImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20ancient%20culture%20street%20with%20traditional%20Chinese%20architecture",modifiedImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20ancient%20culture%20street%20with%20traditional%20Chinese%20architecture%20and%20a%20red%20lantern%20missing",differences:[{id:`diff-${this.nextDifferenceId++}`,position:{x:25,y:30,width:10,height:15},description:"缺少了一个红色灯笼",hint:"在左侧建筑的屋檐下"},{id:`diff-${this.nextDifferenceId++}`,position:{x:75,y:45,width:8,height:12},description:"人物穿着不同",hint:"在右侧街道上"},{id:`diff-${this.nextDifferenceId++}`,position:{x:45,y:60,width:12,height:10},description:"店铺招牌文字不同",hint:"在中间店铺的招牌上"}],difficulty:"easy",reward:"解锁天津古文化街素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20ancient%20culture%20street%20spot%20the%20difference%20game"},{id:`level-${this.nextLevelId++}`,name:"中国传统建筑",description:"找出两张中国传统建筑图片的不同之处",originalImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Traditional%20Chinese%20architecture%20with%20a%20temple",modifiedImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Traditional%20Chinese%20architecture%20with%20a%20temple%20and%20different%20roof%20design",differences:[{id:`diff-${this.nextDifferenceId++}`,position:{x:45,y:20,width:15,height:15},description:"屋顶设计不同",hint:"在寺庙的屋顶上"},{id:`diff-${this.nextDifferenceId++}`,position:{x:30,y:50,width:10,height:12},description:"缺少了一个石狮子",hint:"在寺庙的入口处"},{id:`diff-${this.nextDifferenceId++}`,position:{x:65,y:35,width:8,height:10},description:"窗户设计不同",hint:"在右侧建筑的墙上"},{id:`diff-${this.nextDifferenceId++}`,position:{x:75,y:60,width:12,height:15},description:"树木数量不同",hint:"在右侧背景中"}],difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁中国传统建筑素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20traditional%20architecture%20spot%20the%20difference%20game"},{id:`level-${this.nextLevelId++}`,name:"天津民俗文化",description:"找出两张天津民俗文化图片的不同之处",originalImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20folk%20culture%20performance",modifiedImageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20folk%20culture%20performance%20with%20different%20costumes%20and%20props",differences:[{id:`diff-${this.nextDifferenceId++}`,position:{x:20,y:40,width:12,height:18},description:"表演者服装不同",hint:"在左侧表演者身上"},{id:`diff-${this.nextDifferenceId++}`,position:{x:50,y:55,width:10,height:15},description:"道具不同",hint:"在中间表演者手中"},{id:`diff-${this.nextDifferenceId++}`,position:{x:70,y:30,width:15,height:12},description:"背景装饰不同",hint:"在右侧背景中"},{id:`diff-${this.nextDifferenceId++}`,position:{x:35,y:25,width:8,height:10},description:"头饰不同",hint:"在左侧表演者头上"},{id:`diff-${this.nextDifferenceId++}`,position:{x:60,y:65,width:12,height:10},description:"地面图案不同",hint:"在右侧地面上"}],difficulty:"hard",unlockCondition:{type:"level",value:2},timeLimit:300,reward:"解锁天津民俗文化素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20folk%20culture%20spot%20the%20difference%20game"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},bestTimes:{},unlockedHints:3,lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const l={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,l),l}isDifferenceFound(s,t,a=5){const{x:l,y:n}=t.position,{x:h,y:w}=s;return Math.sqrt(Math.pow(h-l,2)+Math.pow(w-n,2))<=a}calculateLevelScore(s,t,a,l){const n=s/t,h=Math.round(100*n),w={easy:.3,medium:.5,hard:.8}[l]||.5,i=t*30,z=Math.max(0,i-a)*w,p={easy:1,medium:1.2,hard:1.5}[l]||1;return Math.round((h+z)*p)}completeLevel(s,t,a,l){const n=this.getGameProgress(s),h={...n.bestTimes};(!h[t]||l<h[t])&&(h[t]=l);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:h,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const l=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?l.completedLevels.length>=n.value:n.type==="score"?l.totalScore>=n.value:!1}}const xe=new Ke,Ze=({isOpen:d,onClose:s})=>{const{isDark:t}=ce(),{user:a}=r.useContext(pe),[l,n]=r.useState("menu"),[h,w]=r.useState([]),[i,z]=r.useState(null),[p,C]=r.useState(new Set),[g,L]=r.useState(null),[u,U]=r.useState(null),[k,P]=r.useState(null),[R,G]=r.useState(!0),[D,q]=r.useState(0),[S,B]=r.useState(!1),[_,W]=r.useState(null),F=r.useRef(null);r.useEffect(()=>{if(d){G(!0);try{const o=xe.getLevels();if(w(o),a){const m=xe.getGameProgress(a.id);L(m)}}catch(o){console.error("加载游戏数据失败:",o)}finally{G(!1)}}},[d,a]),r.useEffect(()=>{i&&(C(new Set),B(!1),W(null),n("playing"),U(new Date),P(null),q(0))},[i]),r.useEffect(()=>{let o;return u&&l==="playing"&&(o=setInterval(()=>{const b=Math.round((new Date().getTime()-u.getTime())/1e3);q(b)},1e3)),()=>clearInterval(o)},[u,l]);const A=r.useCallback(o=>{if(!a){$.error("请先登录！");return}xe.isLevelUnlocked(a.id,o.id)?z(o):$.error("该关卡尚未解锁！")},[a]),K=r.useCallback(o=>{var M;if(!i||l!=="playing")return;const b=o.currentTarget.getBoundingClientRect();if(!((M=F.current)==null?void 0:M.getBoundingClientRect()))return;const Y=(o.clientX-b.left)/b.width*100,j=(o.clientY-b.top)/b.height*100;for(const x of i.differences)if(!p.has(x.id)&&xe.isDifferenceFound({x:Y,y:j},x)){C(I=>{const E=new Set(I);return E.add(x.id),E}),$.success(`找到差异点：${x.description}`),p.size+1===i.differences.length&&ae();break}},[i,l,p]),X=r.useCallback(()=>{if(!a||!g||!i)return;if(xe.useHint(a.id)){const m=i.differences.filter(T=>!p.has(T.id));m.length>0&&(W(m[0]),B(!0),setTimeout(()=>{B(!1),W(null)},3e3));const b=xe.getGameProgress(a.id);L(b),$.success("已显示提示，请注意观察提示区域")}else $.error("提示已用完")},[a,g,i,p]),ae=r.useCallback(()=>{if(!a||!i)return;const m=u?Math.round((new Date().getTime()-u.getTime())/1e3):0;P(m);const b=xe.calculateLevelScore(p.size,i.differences.length,m,i.difficulty),T=xe.completeLevel(a.id,i.id,b,m);L(T),n("completed"),$.success(`关卡完成！得分：${b}`)},[a,i,p,u]),J=r.useCallback(()=>{n("menu"),z(null),C(new Set),U(null),P(null),q(0),B(!1),W(null)},[]),Z=r.useCallback(()=>{i&&(C(new Set),B(!1),W(null),n("playing"),U(new Date),P(null),q(0))},[i]),ee=r.useCallback(o=>{if(!o)return"00:00";const m=Math.floor(o/60),b=o%60;return`${m.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`},[]);return d?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:o=>o.target===o.currentTarget&&s(),children:e.jsxs(f.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化图片找茬"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[R&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(te,{mode:"wait",children:l==="menu"&&!R&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化图片找茬"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"找出两张文化图片的不同之处，了解更多天津地方文化和中国传统文化"})]}),g&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:g.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:g.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:g.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:h.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(o=>{const m=(g==null?void 0:g.completedLevels.includes(o.id))||!1,b=!a||xe.isLevelUnlocked(a.id,o.id);return e.jsxs(f.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${b?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:b?{y:-4}:{},onClick:()=>b&&A(o),children:[o.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(ie,{src:o.imageUrl,alt:o.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),m&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!b&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:o.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:o.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:o.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[o.differences.length," 处差异"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:o.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[o.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",ee(o.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",o.reward]})]})]},o.id)})})]},"menu")}),e.jsx(te,{mode:"wait",children:l==="playing"&&i&&!R&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:J,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:X,disabled:!g||g.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(g==null?void 0:g.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已找到差异"}),e.jsxs("span",{className:"font-medium",children:[p.size," / ",i.differences.length]})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已用时间"}),e.jsx("span",{className:"font-medium",children:ee(D)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"剩余差异"}),e.jsx("span",{className:"font-medium",children:i.differences.length-p.size})]})]})]}),e.jsxs("div",{ref:F,className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("h4",{className:"text-center font-medium mb-2",children:"原始图片"}),e.jsxs("div",{className:`relative overflow-hidden rounded-lg border ${t?"border-gray-700":"border-gray-200"}`,children:[e.jsx(ie,{src:i.originalImageUrl,alt:"原始图片",className:"w-full h-auto cursor-pointer transition-transform hover:scale-105",onClick:K,priority:!0,fit:"contain"}),i.differences.map(o=>p.has(o.id)?e.jsx(f.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:30},className:"absolute border-2 border-green-500 bg-green-500 bg-opacity-20 rounded-lg",style:{left:`${o.position.x-o.position.width/2}%`,top:`${o.position.y-o.position.height/2}%`,width:`${o.position.width}%`,height:`${o.position.height}%`},children:e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-0.5 rounded-full",children:e.jsx("i",{className:"fas fa-check"})})},o.id):null)]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("h4",{className:"text-center font-medium mb-2",children:"修改后的图片"}),e.jsxs("div",{className:`relative overflow-hidden rounded-lg border ${t?"border-gray-700":"border-gray-200"}`,children:[e.jsx(ie,{src:i.modifiedImageUrl,alt:"修改后的图片",className:"w-full h-auto cursor-pointer transition-transform hover:scale-105",onClick:K,priority:!0,fit:"contain"}),i.differences.map(o=>p.has(o.id)?e.jsx(f.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:30},className:"absolute border-2 border-green-500 bg-green-500 bg-opacity-20 rounded-lg",style:{left:`${o.position.x-o.position.width/2}%`,top:`${o.position.y-o.position.height/2}%`,width:`${o.position.width}%`,height:`${o.position.height}%`},children:e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-0.5 rounded-full",children:e.jsx("i",{className:"fas fa-check"})})},o.id):S&&_&&o.id===_.id?e.jsx(f.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:300,damping:30},className:"absolute border-2 border-yellow-500 bg-yellow-500 bg-opacity-20 rounded-lg animate-pulse",style:{left:`${o.position.x-o.position.width/2}%`,top:`${o.position.y-o.position.height/2}%`,width:`${o.position.width}%`,height:`${o.position.height}%`},children:e.jsx("div",{className:"absolute -top-2 -right-2 bg-yellow-500 text-white text-xs px-2 py-0.5 rounded-full",children:e.jsx("i",{className:"fas fa-lightbulb"})})},o.id):null)]})]})]})]},"playing")}),e.jsx(te,{mode:"wait",children:l==="completed"&&i&&g&&!R&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:g.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:ee(k||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"找到差异"}),e.jsxs("p",{className:"text-xl font-bold",children:[i.differences.length," / ",i.differences.length]})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:Z,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:J,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class et{constructor(){H(this,"events",[]);H(this,"levels",[]);H(this,"gameProgress",new Map);H(this,"nextEventId",1);H(this,"nextLevelId",1);this.initEvents(),this.initLevels()}initEvents(){this.events=[{id:`event-${this.nextEventId++}`,title:"天津开埠",year:1860,description:"天津成为中国北方最早开放的通商口岸之一，设立了英、法、美等九国租界，对天津的经济、文化产生了深远影响。",category:"天津历史",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20treaty%20port%20in%201860"},{id:`event-${this.nextEventId++}`,title:"天津卫设立",year:1404,description:'明成祖朱棣下令设立天津卫，意为"天子经过的渡口"，天津正式建城。',category:"天津历史",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20wei%20establishment%20in%201404"},{id:`event-${this.nextEventId++}`,title:"天津大学成立",year:1895,description:"天津大学前身北洋大学成立，是中国第一所现代大学。",category:"天津教育",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20University%20founded%20in%201895"},{id:`event-${this.nextEventId++}`,title:"杨柳青年画兴起",year:1726,description:"杨柳青年画在天津杨柳青镇兴起，成为中国著名的民间木版年画之一。",category:"天津民间艺术",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Yangliuqing%20New%20Year%20paintings"},{id:`event-${this.nextEventId++}`,title:"泥人张彩塑诞生",year:1844,description:"天津泥人张彩塑艺术由张明山创立，成为中国著名的民间泥塑艺术。",category:"天津民间艺术",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Niren%20Zhang%20clay%20sculptures"},{id:`event-${this.nextEventId++}`,title:"四大发明完成",year:1300,description:"中国古代四大发明（造纸术、印刷术、火药、指南针）在宋元时期基本完成，对世界文明发展产生了深远影响。",category:"中国科技",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Four%20Great%20Inventions%20of%20ancient%20China"},{id:`event-${this.nextEventId++}`,title:"孔子诞生",year:-551,description:"儒家学派创始人孔子诞生，其思想对中国乃至东亚文化产生了深远影响。",category:"中国哲学",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Confucius%20birth"},{id:`event-${this.nextEventId++}`,title:"京剧形成",year:1790,description:"京剧在乾隆年间形成，融合了徽剧、汉剧等多种戏曲元素，成为中国的国粹。",category:"中国传统艺术",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Beijing%20Opera%20formation"},{id:`event-${this.nextEventId++}`,title:"敦煌莫高窟开凿",year:366,description:"敦煌莫高窟开始开凿，历经多个朝代的修建，成为世界上现存规模最大、内容最丰富的佛教艺术地。",category:"中国佛教艺术",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Dunhuang%20Mogao%20Caves"},{id:`event-${this.nextEventId++}`,title:"《红楼梦》成书",year:1791,description:"中国古典四大名著之一《红楼梦》正式出版，成为中国文学史上的巅峰之作。",category:"中国文学",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Dream%20of%20the%20Red%20Chamber"},{id:`event-${this.nextEventId++}`,title:"兵马俑发现",year:1974,description:'秦始皇兵马俑在陕西西安被发现，被誉为"世界第八大奇迹"。',category:"中国考古",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Terracotta%20Army%20discovery"},{id:`event-${this.nextEventId++}`,title:"指南针应用于航海",year:1100,description:"指南针开始广泛应用于航海，促进了中国古代航海事业的发展和海上丝绸之路的繁荣。",category:"中国科技",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Compass%20used%20in%20navigation"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津文化时间轴",description:"了解天津历史上的重要文化事件，按照时间顺序排列",events:this.events.slice(0,5),difficulty:"easy",reward:"解锁天津文化时间轴素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20cultural%20timeline%20game"},{id:`level-${this.nextLevelId++}`,name:"中国传统文化时间轴",description:"了解中国历史上的重要文化事件，按照时间顺序排列",events:this.events.slice(5,10),difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁中国传统文化时间轴素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20timeline%20game"},{id:`level-${this.nextLevelId++}`,name:"文化事件大挑战",description:"挑战更复杂的文化事件时间排序，涵盖天津和中国传统文化",events:this.events,difficulty:"hard",unlockCondition:{type:"level",value:2},timeLimit:300,reward:"解锁高级文化时间轴素材包",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Cultural%20events%20timeline%20challenge"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getEvents(){return[...this.events]}getEventById(s){return this.events.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},bestTimes:{},unlockedHints:3,lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const l={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,l),l}checkTimelineOrder(s,t){for(let a=0;a<s.length;a++)if(s[a].id!==t[a].id)return!1;return!0}calculateLevelScore(s,t,a){if(!s)return 0;const l=100,n={easy:.3,medium:.5,hard:.8}[a]||.5,w=Math.max(0,30-t)*n,i={easy:1,medium:1.2,hard:1.5}[a]||1;return Math.round((l+w)*i)}completeLevel(s,t,a,l){const n=this.getGameProgress(s),h={...n.bestTimes};(!h[t]||l<h[t])&&(h[t]=l);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:h,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const l=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?l.completedLevels.length>=n.value:n.type==="score"?l.totalScore>=n.value:!1}}const he=new et,tt=({isOpen:d,onClose:s})=>{const{isDark:t}=ce(),{user:a}=r.useContext(pe),[l,n]=r.useState("menu"),[h,w]=r.useState([]),[i,z]=r.useState(null),[p,C]=r.useState([]),[g,L]=r.useState([]),[u,U]=r.useState(null),[k,P]=r.useState(null),[R,G]=r.useState(null),[D,q]=r.useState(!0),[S,B]=r.useState(0),[_,W]=r.useState(!1),[F,A]=r.useState(null);r.useEffect(()=>{if(d){q(!0);try{const x=he.getLevels();if(w(x),a){const I=he.getGameProgress(a.id);U(I)}}catch(x){console.error("加载游戏数据失败:",x)}finally{q(!1)}}},[d,a]),r.useEffect(()=>{if(i){const x=[...i.events].sort(()=>Math.random()-.5);C(x),L([]),n("playing"),P(new Date),G(null),B(0),W(!1),A(null)}},[i]),r.useEffect(()=>{let x;return k&&l==="playing"&&(x=setInterval(()=>{const E=Math.round((new Date().getTime()-k.getTime())/1e3);B(E)},1e3)),()=>clearInterval(x)},[k,l]);const K=r.useCallback(x=>{if(!a){$.error("请先登录！");return}he.isLevelUnlocked(a.id,x.id)?z(x):$.error("该关卡尚未解锁！")},[a]),X=r.useCallback((x,I)=>{A(I),"dataTransfer"in x&&(x.dataTransfer.effectAllowed="move")},[]),ae=r.useCallback(()=>{A(null)},[]),J=r.useCallback(x=>{x.preventDefault(),x.dataTransfer.dropEffect="move"},[]),Z=r.useCallback((x,I)=>{if(x.preventDefault(),!F)return;const E=p.filter(N=>N.id!==F.id),c=[...g];c.splice(I,0,F),C(E),L(c),A(null),E.length===0&&m()},[F,p,g]),ee=r.useCallback(x=>{if(x.preventDefault(),!F)return;const I=p.filter(c=>c.id!==F.id),E=[...g,F];C(I),L(E),A(null),I.length===0&&m()},[F,p,g]),o=r.useCallback(x=>{const I=g.filter(c=>c.id!==x.id),E=[...p,x];L(I),C(E)},[g,p]),m=r.useCallback(()=>{if(!i)return;const x=[...i.events].sort((E,c)=>E.year-c.year);he.checkTimelineOrder(g,x)?T():$.error("时间顺序不正确，请重新排列！")},[i,g]),b=r.useCallback(()=>{if(!a||!u||!i)return;if(he.useHint(a.id)){const E=[...i.events].sort((N,y)=>N.year-y.year)[g.length];if(E){const N=p.filter(V=>V.id!==E.id),y=[...g,E];C(N),L(y),$.success(`提示：下一个事件是「${E.title}」`)}const c=he.getGameProgress(a.id);U(c)}else $.error("提示已用完")},[a,u,i,p,g]),T=r.useCallback(()=>{if(!a||!i)return;const I=k?Math.round((new Date().getTime()-k.getTime())/1e3):0;G(I);const E=he.calculateLevelScore(!0,I,i.difficulty),c=he.completeLevel(a.id,i.id,E,I);U(c),n("completed"),$.success(`关卡完成！得分：${E}`)},[a,i,k]),Y=r.useCallback(()=>{n("menu"),z(null),C([]),L([]),P(null),G(null),B(0),W(!1),A(null)},[]),j=r.useCallback(()=>{if(!i)return;const x=[...i.events].sort(()=>Math.random()-.5);C(x),L([]),n("playing"),P(new Date),G(null),B(0),W(!1),A(null)},[i]),M=r.useCallback(x=>{if(!x)return"00:00";const I=Math.floor(x/60),E=x%60;return`${I.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}`},[]);return d?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:x=>x.target===x.currentTarget&&s(),children:e.jsxs(f.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化时间轴"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[D&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(te,{mode:"wait",children:l==="menu"&&!D&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化时间轴"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"将文化事件按照时间顺序排列，了解天津地方文化和中国传统文化的发展脉络"})]}),u&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:u.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:u.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:u.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:h.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(x=>{const I=(u==null?void 0:u.completedLevels.includes(x.id))||!1,E=!a||he.isLevelUnlocked(a.id,x.id);return e.jsxs(f.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${E?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:E?{y:-4}:{},onClick:()=>E&&K(x),children:[x.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(ie,{src:x.imageUrl,alt:x.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),I&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!E&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:x.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:x.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:x.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[x.events.length," 个事件"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:x.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[x.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",M(x.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",x.reward]})]})]},x.id)})})]},"menu")}),e.jsx(te,{mode:"wait",children:l==="playing"&&i&&!D&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Y,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:b,disabled:!u||u.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(u==null?void 0:u.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已排序事件"}),e.jsxs("span",{className:"font-medium",children:[g.length," / ",i.events.length]})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已用时间"}),e.jsx("span",{className:"font-medium",children:M(S)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"剩余事件"}),e.jsx("span",{className:"font-medium",children:i.events.length-g.length})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium mb-3",children:"待排序事件"}),e.jsx("div",{className:`p-4 rounded-lg border ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} min-h-[300px]`,children:p.length===0?e.jsx("p",{className:`text-center py-8 ${t?"text-gray-400":"text-gray-500"}`,children:"所有事件已排序完成！"}):e.jsx("div",{className:"space-y-3",children:p.map(x=>e.jsxs(f.div,{draggable:!0,onDragStart:I=>X(I,x),onDragEnd:ae,className:`p-3 rounded-lg cursor-move ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-50 hover:bg-gray-100"} border ${t?"border-gray-600":"border-gray-200"} transition-all shadow-sm hover:shadow-md`,whileHover:{scale:1.02},whileDrag:{opacity:.7},children:[e.jsx("h5",{className:"font-medium",children:x.title}),e.jsx("p",{className:`text-sm mt-1 ${t?"text-gray-400":"text-gray-600"}`,children:x.description})]},x.id))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium mb-3",children:"已排序事件"}),e.jsx("div",{className:`p-4 rounded-lg border ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} min-h-[300px]`,onDragOver:J,onDrop:ee,children:g.length===0?e.jsx("p",{className:`text-center py-8 ${t?"text-gray-400":"text-gray-500"}`,children:"将事件从左侧拖拽到这里进行排序"}):e.jsx("div",{className:"space-y-3",children:g.map((x,I)=>e.jsxs("div",{className:`p-3 rounded-lg ${t?"bg-blue-900 bg-opacity-50":"bg-blue-50"} border ${t?"border-blue-700":"border-blue-200"} relative`,onDragOver:J,onDrop:E=>Z(E,I),children:[e.jsx("button",{onClick:()=>o(x),className:`absolute top-2 right-2 p-1 rounded-full ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white text-xs transition-colors`,"aria-label":"移除",children:e.jsx("i",{className:"fas fa-times"})}),e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${t?"bg-blue-600":"bg-blue-500"} rounded-l-lg`}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:`inline-block px-2 py-0.5 rounded-full text-xs font-medium mb-1 ${t?"bg-blue-700 text-blue-200":"bg-blue-100 text-blue-800"}`,children:x.year>0?`${x.year}年`:`${Math.abs(x.year)} BCE`}),e.jsx("h5",{className:"font-medium",children:x.title}),e.jsx("p",{className:`text-sm mt-1 ${t?"text-gray-400":"text-gray-600"}`,children:x.description})]})]},x.id))})})]})]}),p.length===0&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{onClick:m,className:`px-6 py-3 rounded-lg text-lg font-medium transition-all ${t?"bg-green-600 hover:bg-green-700":"bg-green-500 hover:bg-green-600"} text-white shadow-md hover:shadow-lg`,children:"检查排序顺序"})})]},"playing")}),e.jsx(te,{mode:"wait",children:l==="completed"&&i&&u&&!D&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:u.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:M(R||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"事件数量"}),e.jsx("p",{className:"text-xl font-bold",children:i.events.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:j,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:Y,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null};class st{constructor(){H(this,"pairs",[]);H(this,"levels",[]);H(this,"gameProgress",new Map);H(this,"nextItemId",1);H(this,"nextPairId",1);H(this,"nextLevelId",1);this.initPairs(),this.initLevels()}initPairs(){const s=[{id:`item-${this.nextItemId++}`,text:"狗不理包子",category:"天津美食",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Goubuli%20baozi%20Tianjin%20food"},{id:`item-${this.nextItemId++}`,text:"天津传统名吃，以皮薄馅大、味道鲜美著称",category:"天津美食",culturalTheme:"天津地方文化"},{id:`item-${this.nextItemId++}`,text:"杨柳青年画",category:"天津民间艺术",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Yangliuqing%20New%20Year%20paintings"},{id:`item-${this.nextItemId++}`,text:"天津传统木版年画，以色彩鲜艳、内容丰富著称",category:"天津民间艺术",culturalTheme:"天津地方文化"},{id:`item-${this.nextItemId++}`,text:"泥人张彩塑",category:"天津民间艺术",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Niren%20Zhang%20clay%20sculptures"},{id:`item-${this.nextItemId++}`,text:"天津传统泥塑艺术，以造型生动、工艺精湛著称",category:"天津民间艺术",culturalTheme:"天津地方文化"},{id:`item-${this.nextItemId++}`,text:"天津之眼",category:"天津地标",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Tianjin%20Eye%20ferris%20wheel"},{id:`item-${this.nextItemId++}`,text:"天津标志性建筑，世界上唯一建在桥上的摩天轮",category:"天津地标",culturalTheme:"天津地方文化"},{id:`item-${this.nextItemId++}`,text:"春节",category:"传统节日",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Chinese%20Spring%20Festival%20celebration"},{id:`item-${this.nextItemId++}`,text:'中国最重要的传统节日，俗称"过年"',category:"传统节日",culturalTheme:"中国传统文化"},{id:`item-${this.nextItemId++}`,text:"孔子",category:"历史人物",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Confucius%20ancient%20Chinese%20philosopher"},{id:`item-${this.nextItemId++}`,text:"儒家学派创始人，中国古代伟大的思想家和教育家",category:"历史人物",culturalTheme:"中国传统文化"},{id:`item-${this.nextItemId++}`,text:"造纸术",category:"中国科技",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Papermaking%20ancient%20Chinese%20invention"},{id:`item-${this.nextItemId++}`,text:"中国古代四大发明之一，促进了文化传播",category:"中国科技",culturalTheme:"中国传统文化"},{id:`item-${this.nextItemId++}`,text:"京剧",category:"传统艺术",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Beijing%20Opera%20performance"},{id:`item-${this.nextItemId++}`,text:"中国国粹，融合了唱、念、做、打等多种艺术形式",category:"传统艺术",culturalTheme:"中国传统文化"},{id:`item-${this.nextItemId++}`,text:"中秋节",category:"传统节日",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Mid-Autumn%20Festival%20with%20mooncakes"},{id:`item-${this.nextItemId++}`,text:"中国传统节日，赏月、吃月饼是主要习俗",category:"传统节日",culturalTheme:"中国传统文化"}];this.pairs=[{id:`pair-${this.nextPairId++}`,item1:s[0],item2:s[1],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[2],item2:s[3],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[4],item2:s[5],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[6],item2:s[7],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[8],item2:s[9],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[10],item2:s[11],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[12],item2:s[13],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[14],item2:s[15],relationship:"是"},{id:`pair-${this.nextPairId++}`,item1:s[16],item2:s[17],relationship:"是"}]}initLevels(){this.levels=[{id:`level-${this.nextLevelId++}`,name:"天津文化配对",description:"了解天津文化元素及其特点，将相关元素进行配对",pairs:this.pairs.slice(0,4),difficulty:"easy",reward:"解锁天津文化配对素材包",culturalTheme:"天津地方文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Tianjin%20cultural%20pair%20matching%20game"},{id:`level-${this.nextLevelId++}`,name:"中国传统文化配对",description:"了解中国传统文化元素及其特点，将相关元素进行配对",pairs:this.pairs.slice(4,9),difficulty:"medium",unlockCondition:{type:"level",value:1},reward:"解锁中国传统文化配对素材包",culturalTheme:"中国传统文化",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Chinese%20cultural%20pair%20matching%20game"},{id:`level-${this.nextLevelId++}`,name:"文化配对大挑战",description:"挑战更复杂的文化元素配对，涵盖天津和中国传统文化",pairs:this.pairs,difficulty:"hard",unlockCondition:{type:"level",value:2},timeLimit:300,reward:"解锁高级文化配对素材包",culturalTheme:"综合文化知识",imageUrl:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x1024&prompt=Cultural%20pair%20matching%20challenge"}]}getLevels(){return[...this.levels]}getLevelById(s){return this.levels.find(t=>t.id===s)}getPairs(){return[...this.pairs]}getPairById(s){return this.pairs.find(t=>t.id===s)}getGameProgress(s){if(!this.gameProgress.has(s)){const t={userId:s,completedLevels:[],totalScore:0,levelScores:{},bestTimes:{},unlockedHints:3,lastPlayed:new Date};this.gameProgress.set(s,t)}return this.gameProgress.get(s)}updateGameProgress(s,t){const l={...this.getGameProgress(s),...t,lastPlayed:new Date};return this.gameProgress.set(s,l),l}checkPairMatch(s,t,a){return a.some(l=>l.item1.id===s&&l.item2.id===t||l.item1.id===t&&l.item2.id===s)}calculateLevelScore(s,t,a,l){const n=s/t,h=Math.round(100*n),w={easy:.3,medium:.5,hard:.8}[l]||.5,i=t*30,z=Math.max(0,i-a)*w,p={easy:1,medium:1.2,hard:1.5}[l]||1;return Math.round((h+z)*p)}completeLevel(s,t,a,l){const n=this.getGameProgress(s),h={...n.bestTimes};(!h[t]||l<h[t])&&(h[t]=l);const w={...n,completedLevels:[...new Set([...n.completedLevels,t])],totalScore:n.totalScore+a,levelScores:{...n.levelScores,[t]:a},bestTimes:h,lastPlayed:new Date};return this.gameProgress.set(s,w),w}useHint(s){const t=this.getGameProgress(s);return t.unlockedHints>0?(this.updateGameProgress(s,{unlockedHints:t.unlockedHints-1}),!0):!1}unlockHint(s){const t=this.getGameProgress(s);this.updateGameProgress(s,{unlockedHints:t.unlockedHints+1})}isLevelUnlocked(s,t){const a=this.getLevelById(t);if(!a||!a.unlockCondition)return!0;const l=this.getGameProgress(s),{unlockCondition:n}=a;return n.type==="level"?l.completedLevels.length>=n.value:n.type==="score"?l.totalScore>=n.value:!1}}const ue=new st,at=({isOpen:d,onClose:s})=>{const{isDark:t}=ce(),{user:a}=r.useContext(pe),[l,n]=r.useState("menu"),[h,w]=r.useState([]),[i,z]=r.useState(null),[p,C]=r.useState([]),[g,L]=r.useState([]),[u,U]=r.useState(new Set),[k,P]=r.useState(null),[R,G]=r.useState(null),[D,q]=r.useState(null),[S,B]=r.useState(!0),[_,W]=r.useState(0),[F,A]=r.useState(!1);r.useEffect(()=>{if(d){B(!0);try{const m=ue.getLevels();if(w(m),a){const b=ue.getGameProgress(a.id);P(b)}}catch(m){console.error("加载游戏数据失败:",m)}finally{B(!1)}}},[d,a]),r.useEffect(()=>{if(i){const b=i.pairs.flatMap(T=>[T.item1,T.item2]).sort(()=>Math.random()-.5);C(b),L([]),U(new Set),n("playing"),G(new Date),q(null),W(0),A(!1)}},[i]),r.useEffect(()=>{let m;return R&&l==="playing"&&(m=setInterval(()=>{const T=Math.round((new Date().getTime()-R.getTime())/1e3);W(T)},1e3)),()=>clearInterval(m)},[R,l]);const K=r.useCallback(m=>{if(!a){$.error("请先登录！");return}ue.isLevelUnlocked(a.id,m.id)?z(m):$.error("该关卡尚未解锁！")},[a]),X=r.useCallback(m=>{if(!(l!=="playing"||!i)&&!u.has(m))if(g.length===2)L([m]);else if(g.includes(m))L([]);else{const b=[...g,m];if(L(b),b.length===2){const[T,Y]=b;ue.checkPairMatch(T,Y,i.pairs)?(U(j=>{const M=new Set(j);return M.add(T),M.add(Y),M}),L([]),$.success("配对成功！"),u.size+2===p.length&&J()):setTimeout(()=>{L([]),$.error("配对错误，请重新尝试！")},500)}}},[l,i,g,u,p.length]),ae=r.useCallback(()=>{if(!a||!k||!i)return;if(ue.useHint(a.id)){const b=i.pairs.filter(Y=>!u.has(Y.item1.id)&&!u.has(Y.item2.id));if(b.length>0){const Y=b[0];A(!0),setTimeout(()=>{A(!1)},2e3),$.success(`提示：「${Y.item1.text}」和「${Y.item2.text}」是一对`)}const T=ue.getGameProgress(a.id);P(T)}else $.error("提示已用完")},[a,k,i,u]),J=r.useCallback(()=>{if(!a||!i)return;const b=R?Math.round((new Date().getTime()-R.getTime())/1e3):0;q(b);const T=ue.calculateLevelScore(u.size/2,i.pairs.length,b,i.difficulty),Y=ue.completeLevel(a.id,i.id,T,b);P(Y),n("completed"),$.success(`关卡完成！得分：${T}`)},[a,i,u.size,R]),Z=r.useCallback(()=>{n("menu"),z(null),C([]),L([]),U(new Set),G(null),q(null),W(0),A(!1)},[]),ee=r.useCallback(()=>{if(!i)return;const b=i.pairs.flatMap(T=>[T.item1,T.item2]).sort(()=>Math.random()-.5);C(b),L([]),U(new Set),n("playing"),G(new Date),q(null),W(0),A(!1)},[i]),o=r.useCallback(m=>{if(!m)return"00:00";const b=Math.floor(m/60),T=m%60;return`${b.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`},[]);return d?e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:m=>m.target===m.currentTarget&&s(),children:e.jsxs(f.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{x:100,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:`w-full max-w-4xl max-h-[90vh] rounded-xl overflow-hidden shadow-2xl ${t?"bg-gray-800":"bg-white"} text-${t?"white":"gray-900"} flex flex-col`,onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:`sticky top-0 z-10 p-4 border-b ${t?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"} flex justify-between items-center`,children:[e.jsx("h3",{className:"text-xl font-bold",children:"文化配对游戏"}),e.jsx("button",{onClick:s,className:`p-3 rounded-full text-xl ${t?"bg-red-600 hover:bg-red-700":"bg-red-500 hover:bg-red-600"} text-white transition-all shadow-md hover:shadow-lg`,"aria-label":"关闭",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-grow max-h-[calc(90vh-80px)]",children:[S&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mb-4"}),e.jsx("p",{className:"text-lg",children:"加载游戏数据..."})]}),e.jsx(te,{mode:"wait",children:l==="menu"&&!S&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"欢迎来到文化配对游戏"}),e.jsx("p",{className:`${t?"text-gray-400":"text-gray-600"}`,children:"将相关的文化元素进行配对，了解天津地方文化和中国传统文化的丰富内涵"})]}),k&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"游戏进度"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"已完成关卡"}),e.jsx("p",{className:"text-xl font-bold",children:k.completedLevels.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"总得分"}),e.jsx("p",{className:"text-xl font-bold",children:k.totalScore})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"可用提示"}),e.jsx("p",{className:"text-xl font-bold",children:k.unlockedHints})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"关卡总数"}),e.jsx("p",{className:"text-xl font-bold",children:h.length})]})]})]}),e.jsx("h3",{className:"text-lg font-medium mb-4",children:"选择关卡"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map(m=>{const b=(k==null?void 0:k.completedLevels.includes(m.id))||!1,T=!a||ue.isLevelUnlocked(a.id,m.id);return e.jsxs(f.div,{className:`p-4 rounded-lg border cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${T?"hover:shadow-md":"opacity-50 cursor-not-allowed"}`,whileHover:T?{y:-4}:{},onClick:()=>T&&K(m),children:[m.imageUrl&&e.jsxs("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:[e.jsx(ie,{src:m.imageUrl,alt:m.name,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"}),b&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"已完成"}),!T&&e.jsx("div",{className:"absolute top-2 right-2 bg-gray-600 text-white text-xs px-2 py-1 rounded-full",children:"未解锁"})]}),e.jsx("h4",{className:"font-medium mb-1",children:m.name}),e.jsx("p",{className:`text-sm mb-2 ${t?"text-gray-400":"text-gray-600"}`,children:m.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:m.difficulty.toUpperCase()}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:[m.pairs.length," 对配对"]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-gray-700":"bg-gray-100"}`,children:m.culturalTheme})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[m.timeLimit&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["限时: ",o(m.timeLimit)]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full ${t?"bg-yellow-900 bg-opacity-30 text-yellow-200":"bg-yellow-100 text-yellow-800"}`,children:["奖励: ",m.reward]})]})]},m.id)})})]},"menu")}),e.jsx(te,{mode:"wait",children:l==="playing"&&i&&!S&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Z,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"返回菜单"}),e.jsxs("button",{onClick:ae,disabled:!k||k.unlockedHints<=0,className:`px-3 py-1 rounded-lg text-sm transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fas fa-lightbulb mr-1"}),"提示 (",(k==null?void 0:k.unlockedHints)||0,")"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已匹配对数"}),e.jsxs("span",{className:"font-medium",children:[u.size/2," / ",i.pairs.length]})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"已用时间"}),e.jsx("span",{className:"font-medium",children:o(_)})]}),e.jsxs("div",{className:`p-2 rounded-lg ${t?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx("span",{className:"text-xs block mb-1",children:"剩余配对"}),e.jsx("span",{className:"font-medium",children:i.pairs.length-u.size/2})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:p.map(m=>{const b=g.includes(m.id),T=u.has(m.id),Y=F&&i.pairs.some(j=>(j.item1.id===m.id||j.item2.id===m.id)&&!u.has(m.id));return e.jsxs(f.div,{className:`p-4 rounded-lg cursor-pointer transition-all ${t?"border-gray-700":"border-gray-200"} ${b?t?"border-blue-500 bg-blue-900 bg-opacity-30":"border-blue-500 bg-blue-50":T?t?"border-green-500 bg-green-900 bg-opacity-30":"border-green-500 bg-green-50":Y?t?"border-yellow-500 bg-yellow-900 bg-opacity-30":"border-yellow-500 bg-yellow-50":t?"bg-gray-700 hover:bg-gray-600":"bg-white hover:bg-gray-50"} shadow-sm hover:shadow-md`,whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>X(m.id),children:[m.imageUrl&&e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-3",children:e.jsx(ie,{src:m.imageUrl,alt:m.text,className:"w-full h-full object-cover transition-transform hover:scale-105",ratio:"landscape",fit:"cover"})}),e.jsx("h5",{className:"font-medium",children:m.text}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-gray-400":"text-gray-600"}`,children:m.category})]},m.id)})})]},"playing")}),e.jsx(te,{mode:"wait",children:l==="completed"&&i&&k&&!S&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"text-center",children:[e.jsx(f.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:"mb-6",children:e.jsx("i",{className:"fas fa-trophy text-6xl text-yellow-500"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"恭喜完成关卡！"}),e.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["你成功完成了「",i.name,"」关卡"]}),e.jsx("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"最终得分"}),e.jsx("p",{className:"text-xl font-bold",children:k.levelScores[i.id]||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"完成时间"}),e.jsx("p",{className:"text-xl font-bold",children:o(D||0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"配对对数"}),e.jsxs("p",{className:"text-xl font-bold",children:[i.pairs.length," / ",i.pairs.length]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"正确率"}),e.jsx("p",{className:"text-xl font-bold",children:"100%"})]})]})}),e.jsxs("div",{className:`p-4 rounded-lg mb-6 ${t?"bg-yellow-900 bg-opacity-30":"bg-yellow-100"} border ${t?"border-yellow-700":"border-yellow-200"}`,children:[e.jsx("h3",{className:"font-medium mb-2",children:"获得奖励"}),e.jsx("p",{className:t?"text-yellow-200":"text-yellow-800",children:i.reward})]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:ee,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"}`,children:"重新挑战"}),e.jsx("button",{onClick:Z,className:`px-4 py-2 rounded-lg transition-colors ${t?"bg-blue-600 hover:bg-blue-700":"bg-blue-500 hover:bg-blue-600"} text-white`,children:"返回关卡选择"})]})]},"completed")})]})]})}):null},nt=()=>{const{isDark:d}=ce(),[s,t]=r.useState(!1),[a,l]=r.useState(!1),[n,h]=r.useState(!1),[w,i]=r.useState(!1),[z,p]=r.useState(!1),[C,g]=r.useState(!1),[L,u]=r.useState(!1),[U,k]=r.useState(!1),[P,R]=r.useState(!1),[G,D]=r.useState(!1);return e.jsx("div",{className:`min-h-screen ${d?"bg-gray-900 text-white":"bg-white text-gray-900"}`,children:s?e.jsx(Ie,{isOpen:s,onClose:()=>t(!1)}):a?e.jsx(Ge,{isOpen:a,onClose:()=>l(!1)}):n?e.jsx(Le,{isOpen:n,onClose:()=>h(!1)}):w?e.jsx(Qe,{isOpen:w,onClose:()=>i(!1)}):z?e.jsx(Fe,{isOpen:z,onClose:()=>p(!1)}):C?e.jsx(Ye,{isOpen:C,onClose:()=>g(!1)}):L?e.jsx(Je,{isOpen:L,onClose:()=>u(!1)}):U?e.jsx(Ze,{isOpen:U,onClose:()=>k(!1)}):P?e.jsx(tt,{isOpen:P,onClose:()=>R(!1)}):G?e.jsx(at,{isOpen:G,onClose:()=>D(!1)}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(Te,{title:"文化知识游戏",subtitle:"通过游戏学习天津地方文化和中国传统文化",theme:"indigo",stats:[{label:"游戏类型",value:"多样化"},{label:"难度级别",value:"分关卡"},{label:"学习方式",value:"互动式"},{label:"挑战模式",value:"计时赛"}],pattern:!0,size:"lg"}),e.jsxs(f.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},className:"mt-8 grid md:grid-cols-2 gap-8 mb-12",children:[e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Cultural%20quiz%20game%20interface%20with%20traditional%20Chinese%20elements",alt:"文化知识挑战",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化知识挑战"}),e.jsx("p",{className:`mb-4 ${d?"text-gray-300":"text-gray-700"}`,children:"测试你对天津地方文化和中国传统文化的了解，包含多种题型和难度级别。"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种题型：单选题、多选题、判断题"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"关卡制：包含3个不同难度的关卡"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的答题时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"提示系统：提供提示帮助你解题"})]})]}),e.jsxs("button",{onClick:()=>t(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-question-circle mr-2"}),"开始挑战"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Memory%20card%20game%20with%20Chinese%20cultural%20elements%20flip%20cards",alt:"文化记忆游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化记忆游戏"}),e.jsx("p",{className:`mb-4 ${d?"text-gray-300":"text-gray-700"}`,children:"翻牌匹配相同的文化元素，挑战你的记忆力和文化知识，包含多种难度级别。"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种难度：4x4、6x6、8x8网格"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"精美的卡片设计：包含文化元素图片和介绍"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"进度保存：记录你的游戏成就"})]})]}),e.jsxs("button",{onClick:()=>l(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-purple-600 hover:bg-purple-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-gamepad mr-2"}),"开始游戏"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Matching%20game%20with%20Chinese%20cultural%20elements%20cards",alt:"文化元素连连看",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化元素连连看"}),e.jsx("p",{className:`mb-4 ${d?"text-gray-300":"text-gray-700"}`,children:"通过匹配相同的文化元素卡片，了解中国传统文化和天津地方特色，赢取丰厚奖励！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种关卡：从简单到困难，逐步挑战"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"丰富的文化元素：包含天津地方特色和中国传统文化"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间，挑战最佳成绩"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"提示系统：遇到困难时可使用提示功能"})]})]}),e.jsxs("button",{onClick:()=>h(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-gamepad mr-2"}),"开始游戏"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Puzzle%20game%20with%20Chinese%20cultural%20elements%20in%20Tianjin",alt:"文化拼图游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化拼图游戏"}),e.jsx("p",{className:`mb-4 ${d?"text-gray-300":"text-gray-700"}`,children:"拼合文化图片碎片，了解天津地方文化和中国传统文化，挑战你的观察力和动手能力！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种难度：4x4、5x5、6x6 不同规格的拼图"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"丰富的文化图片：包含天津地标、民俗文化和非遗技艺"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间和移动次数"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"提示功能：遇到困难时可使用提示和查看答案"})]})]}),e.jsxs("button",{onClick:()=>i(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-purple-600 hover:bg-purple-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-gamepad mr-2"}),"开始游戏"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Sorting%20game%20with%20Chinese%20cultural%20elements%20timeline",alt:"文化元素排序游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化元素排序游戏"}),e.jsx("p",{className:`mb-4 ${d?"text-gray-300":"text-gray-700"}`,children:"按照时间顺序或逻辑顺序排列文化元素，了解天津地方文化和中国传统文化的发展脉络！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种排序类型：时间顺序、逻辑顺序"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"拖拽排序：支持直观的拖拽操作"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供文化元素的详细介绍"})]})]}),e.jsxs("button",{onClick:()=>p(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-green-600 hover:bg-green-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-sort mr-2"}),"开始排序"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Riddle%20game%20with%20Chinese%20cultural%20elements%20lanterns",alt:"文化猜谜游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化猜谜游戏"}),e.jsx("p",{className:`mb-4 ${d?"text-gray-300":"text-gray-700"}`,children:"根据提示猜文化元素、成语或历史人物，了解天津地方文化和中国传统文化的丰富内涵！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种猜谜类型：文化元素、成语、历史人物"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"递进式提示：提供多级提示帮助解题"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供谜底的文化背景介绍"})]})]}),e.jsxs("button",{onClick:()=>g(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-orange-600 hover:bg-orange-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-lightbulb mr-2"}),"开始猜谜"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Word%20chain%20game%20with%20Chinese%20cultural%20elements",alt:"文化词汇接龙游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化词汇接龙游戏"}),e.jsx("p",{className:`mb-4 ${d?"text-gray-300":"text-gray-700"}`,children:"从给定的文化词汇开始，按照规则接龙，挑战你的词汇量和文化知识！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"丰富的文化词汇：涵盖天津地方文化和中国传统文化"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"拖拽式操作：直观的拖拽排序玩法"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"提示功能：遇到困难时可使用提示"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供词汇的文化背景介绍"})]})]}),e.jsxs("button",{onClick:()=>u(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-cyan-600 hover:bg-cyan-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-link mr-2"}),"开始接龙"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Spot%20the%20difference%20game%20with%20Chinese%20cultural%20images",alt:"文化图片找茬游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化图片找茬游戏"}),e.jsx("p",{className:`mb-4 ${d?"text-gray-300":"text-gray-700"}`,children:"对比两张文化主题图片，找出所有不同之处，考验你的观察力和文化敏感度！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"精美的文化图片：包含天津地方文化和中国传统文化元素"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"自动识别差异：点击图片即可标记差异"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供差异处的文化背景介绍"})]})]}),e.jsxs("button",{onClick:()=>k(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-pink-600 hover:bg-pink-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-search mr-2"}),"开始找茬"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Timeline%20game%20with%20Chinese%20historical%20events",alt:"文化时间轴游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化时间轴游戏"}),e.jsx("p",{className:`mb-4 ${d?"text-gray-300":"text-gray-700"}`,children:"将历史文化事件按照时间顺序排列，了解天津和中国传统文化的发展脉络！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"丰富的历史事件：涵盖不同时期的文化发展"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"拖拽式操作：直观的时间轴排序玩法"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供事件的历史背景介绍"})]})]}),e.jsxs("button",{onClick:()=>R(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-amber-600 hover:bg-amber-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-history mr-2"}),"开始排序"]})]}),e.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} hover:shadow-xl transition-shadow`,children:[e.jsx("div",{className:"relative aspect-video overflow-hidden rounded-lg mb-4",children:e.jsx("img",{src:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1024x768&prompt=Pair%20matching%20game%20with%20Chinese%20cultural%20elements",alt:"文化配对游戏",className:"w-full h-full object-cover transition-transform hover:scale-105"})}),e.jsx("h2",{className:"text-2xl font-bold mb-3",children:"文化配对游戏"}),e.jsx("p",{className:`mb-4 ${d?"text-gray-300":"text-gray-700"}`,children:"翻转卡片，找到匹配的文化元素对，挑战你的记忆力和文化知识！"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"精美的卡片设计：包含文化元素图片和介绍"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"多种难度：不同数量的卡片组合"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"计时挑战：记录你的完成时间"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"}),e.jsx("span",{children:"详细解析：提供配对元素的文化背景介绍"})]})]}),e.jsxs("button",{onClick:()=>D(!0),className:"w-full px-6 py-3 text-lg font-bold rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white transition-colors duration-300 shadow-md hover:shadow-xl",children:[e.jsx("i",{className:"fas fa-puzzle-piece mr-2"}),"开始配对"]})]})]}),e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:`p-6 rounded-xl shadow-lg ${d?"bg-gray-800":"bg-white"} mb-12`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"游戏特色"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center text-center p-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 text-red-600 flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-book-open text-2xl"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"文化学习"}),e.jsx("p",{className:d?"text-gray-300":"text-gray-700",children:"通过游戏了解天津地方文化和中国传统文化的丰富内涵"})]}),e.jsxs("div",{className:"flex flex-col items-center text-center p-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-user-friends text-2xl"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"互动体验"}),e.jsx("p",{className:d?"text-gray-300":"text-gray-700",children:"丰富的互动设计，让学习变得更加有趣和生动"})]}),e.jsxs("div",{className:"flex flex-col items-center text-center p-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 text-green-600 flex items-center justify-center mb-4",children:e.jsx("i",{className:"fas fa-trophy text-2xl"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"挑战成就"}),e.jsx("p",{className:d?"text-gray-300":"text-gray-700",children:"完成关卡获得奖励，解锁新的游戏内容和成就"})]})]})]})]})})};export{nt as default};
