import{u as k,r as o,j as e}from"./index-DW-f9EnK.js";function C(){const{isDark:a}=k(),[c,j]=o.useState(""),[i,h]=o.useState(()=>{try{const r=localStorage.getItem("LAB_RECENT");if(r){const s=JSON.parse(r);if(Array.isArray(s)&&s.every(t=>typeof t=="string"))return s}}catch(r){console.error("Failed to parse LAB_RECENT from localStorage:",r),localStorage.removeItem("LAB_RECENT")}return[]});o.useEffect(()=>{try{localStorage.setItem("LAB_RECENT",JSON.stringify(i.slice(0,10)))}catch(r){console.error("Failed to save LAB_RECENT to localStorage:",r)}},[i]);const[g,d]=o.useState(()=>{try{const r=localStorage.getItem("LAB_OPENED_LOG");if(r){const s=JSON.parse(r);if(Array.isArray(s)&&s.every(t=>typeof t=="object"&&typeof t.url=="string"&&typeof t.source=="string"&&typeof t.openedAt=="number"))return s}}catch(r){console.error("Failed to parse LAB_OPENED_LOG from localStorage:",r),localStorage.removeItem("LAB_OPENED_LOG")}return[]});o.useEffect(()=>{try{localStorage.setItem("LAB_OPENED_LOG",JSON.stringify(g.slice(0,50)))}catch(r){console.error("Failed to save LAB_OPENED_LOG to localStorage:",r)}},[g]);const[u,w]=o.useState(!0),v=r=>{if(/^https?:\/\//i.test(r))return r;const s=`${window.location.origin}`,[t,l]=r.split("?"),x=new URLSearchParams(l||"");if(!u)return`${s}${t}${x.toString()?`?${x.toString()}`:""}`;const p=i.find(m=>{try{return new URL(m).pathname===t}catch{return!1}}),b=new URLSearchParams((()=>{if(!p)return"";try{return new URL(p).search}catch{return""}})());x.forEach((m,N)=>b.set(N,m));const f=b.toString();return`${s}${t}${f?`?${f}`:""}`},n=(r,s="custom")=>{try{const t=v(r);window.open(t,"_blank","noopener,noreferrer"),h(l=>[t,...l.filter(x=>x!==t)].slice(0,10)),d(l=>[{url:t,source:s,openedAt:Date.now()},...l].slice(0,50))}catch{alert("打开新窗口失败，请检查URL")}},y=(r,s="batch")=>{r.forEach((t,l)=>{setTimeout(()=>n(t,s),l*50)})};return e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-window-restore text-red-600"}),"新窗口实验室"]}),e.jsx("p",{className:`${a?"text-gray-400":"text-gray-600"} mt-2`,children:"一键在新窗口中打开平台核心页面，便于多任务并行与对比查看。"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:[e.jsxs("button",{onClick:()=>n("/create","quick:create"),className:`w-full px-4 py-3 rounded-xl flex items-center justify-center gap-2 ring-1 ${a?"ring-gray-700 bg-gray-800 hover:bg-gray-700":"ring-gray-200 bg-white hover:bg-gray-50"} transition`,children:[e.jsx("i",{className:"fas fa-tools"}),"在新窗口打开：创作中心"]}),e.jsxs("button",{onClick:()=>n("/explore","quick:explore"),className:`w-full px-4 py-3 rounded-xl flex items-center justify-center gap-2 ring-1 ${a?"ring-gray-700 bg-gray-800 hover:bg-gray-700":"ring-gray-200 bg-white hover:bg-gray-50"} transition`,children:[e.jsx("i",{className:"fas fa-compass"}),"在新窗口打开：探索作品"]}),e.jsxs("button",{onClick:()=>n("/square","quick:square"),className:`w-full px-4 py-3 rounded-xl flex items-center justify-center gap-2 ring-1 ${a?"ring-gray-700 bg-gray-800 hover:bg-gray-700":"ring-gray-200 bg-white hover:bg-gray-50"} transition`,children:[e.jsx("i",{className:"fas fa-th-large"}),"在新窗口打开：共创广场"]}),e.jsxs("button",{onClick:()=>n("/knowledge","quick:knowledge"),className:`w-full px-4 py-3 rounded-xl flex items-center justify-center gap-2 ring-1 ${a?"ring-gray-700 bg-gray-800 hover:bg-gray-700":"ring-gray-200 bg-white hover:bg-gray-50"} transition`,children:[e.jsx("i",{className:"fas fa-book"}),"在新窗口打开：文化知识库"]}),e.jsxs("button",{onClick:()=>n("/neo","quick:neo"),className:`w-full px-4 py-3 rounded-xl flex items-center justify-center gap-2 ring-1 ${a?"ring-gray-700 bg-gray-800 hover:bg-gray-700":"ring-gray-200 bg-white hover:bg-gray-50"} transition`,children:[e.jsx("i",{className:"fas fa-bolt"}),"在新窗口打开：灵感引擎"]}),e.jsxs("button",{onClick:()=>n("/tools","quick:tools"),className:`w-full px-4 py-3 rounded-xl flex items-center justify-center gap-2 ring-1 ${a?"ring-gray-700 bg-gray-800 hover:bg-gray-700":"ring-gray-200 bg-white hover:bg-gray-50"} transition`,children:[e.jsx("i",{className:"fas fa-magic"}),"在新窗口打开：创作工具集"]})]}),e.jsxs("div",{className:`rounded-2xl p-4 ring-1 ${a?"ring-gray-700 bg-gray-900":"ring-gray-200 bg-white"}`,children:[e.jsx("h2",{className:"font-bold mb-3",children:"自定义链接"}),e.jsx("div",{className:"mb-2 flex items-center gap-2",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:r=>w(r.target.checked)}),"携带最近上下文参数（同一路由合并最近查询条件）"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:c,onChange:r=>j(r.target.value),onKeyDown:r=>{r.key==="Enter"&&c.trim()&&n(c.trim())},placeholder:"例如 /create 或 https://example.com",className:`flex-1 px-3 py-2 rounded-xl ring-1 ${a?"bg-gray-800 ring-gray-700 text-white":"bg-white ring-gray-300 text-gray-900"}`}),e.jsx("button",{onClick:()=>{c.trim()&&n(c.trim())},className:"px-4 py-2 rounded-xl bg-red-600 hover:bg-red-700 text-white",children:"在新窗口打开"})]}),e.jsx("p",{className:`${a?"text-gray-400":"text-gray-600"} text-sm mt-2`,children:"支持站内路径与外部地址；为安全起见，已启用 `noopener,noreferrer`。"}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>y(["/explore","/create"],"batch:explore+create"),className:`px-3 py-2 rounded-xl text-sm ring-1 ${a?"ring-gray-700 bg-gray-800 hover:bg-gray-700":"ring-gray-200 bg-white hover:bg-gray-50"}`,children:"对比打开：探索 + 创作"}),e.jsx("button",{onClick:()=>y(["/square","/knowledge"],"batch:square+knowledge"),className:`px-3 py-2 rounded-xl text-sm ring-1 ${a?"ring-gray-700 bg-gray-800 hover:bg-gray-700":"ring-gray-200 bg-white hover:bg-gray-50"}`,children:"对比打开：广场 + 知识库"}),e.jsx("button",{onClick:()=>y(g.map(r=>r.url),"batch:reopen-all"),className:`px-3 py-2 rounded-xl text-sm ring-1 ${a?"ring-gray-700 bg-gray-800 hover:bg-gray-700":"ring-gray-200 bg-white hover:bg-gray-50"}`,children:"批量重开：全部历史"}),e.jsx("button",{onClick:()=>d([]),className:"px-3 py-2 rounded-xl text-sm bg-red-600 hover:bg-red-700 text-white",children:"清空窗口清单"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-medium mb-2",children:"最近打开"}),i.length===0?e.jsx("p",{className:`${a?"text-gray-400":"text-gray-600"} text-sm`,children:"暂无记录"}):e.jsx("ul",{className:"space-y-2",children:i.map(r=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`truncate mr-3 ${a?"text-gray-300":"text-gray-700"}`,children:r}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(r),className:"px-2 py-1 rounded-md bg-red-600 hover:bg-red-700 text-white text-xs",children:"打开"}),e.jsx("button",{onClick:()=>h(s=>s.filter(t=>t!==r)),className:`px-2 py-1 rounded-md text-xs ${a?"bg-gray-800 hover:bg-gray-700 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-900"}`,children:"删除"})]})]},r))}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-medium mb-2",children:"窗口管理清单"}),g.length===0?e.jsx("p",{className:`${a?"text-gray-400":"text-gray-600"} text-sm`,children:"暂无记录"}):e.jsx("ul",{className:"space-y-2",children:g.map((r,s)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1 mr-3",children:[e.jsx("div",{className:`${a?"text-gray-300":"text-gray-700"} truncate`,children:r.url}),e.jsxs("div",{className:"text-gray-500 text-xs",children:["来源：",r.source," · 时间：",new Date(r.openedAt).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(r.url,"reopen:item"),className:"px-2 py-1 rounded-md bg-red-600 hover:bg-red-700 text-white text-xs",children:"重开"}),e.jsx("button",{onClick:()=>d(t=>t.filter(l=>!(l.url===r.url&&l.openedAt===r.openedAt))),className:`px-2 py-1 rounded-md text-xs ${a?"bg-gray-800 hover:bg-gray-700 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-900"}`,children:"删除"})]})]},`${r.url}-${r.openedAt}-${s}`))})]})]})]})]})}export{C as default};
