import{u as $,r as i,e as n,j as e,m as c,R as b,P as C,b as I,C as N,E as v,K as w,I as R,D as O,X as D,Y as L,J as M,x as A}from"./index-DW-f9EnK.js";const d=["#f87171","#60a5fa","#34d399","#f59e0b","#a78bfa"],F=({refreshInterval:x=3e4,recentCount:m=100})=>{const{isDark:a}=$(),[l,h]=i.useState(n.getErrorStats(m)),[g,f]=i.useState(!1),[S,K]=i.useState(null),[t,k]=i.useState(null),[E,o]=i.useState(!1);i.useEffect(()=>{const s=setInterval(()=>{y()},x);return()=>clearInterval(s)},[x]);const y=()=>{f(!0),setTimeout(()=>{h(n.getErrorStats(m)),f(!1)},500)},T=()=>{window.confirm("确定要清除所有错误日志吗？")&&(n.clearErrors(),h(n.getErrorStats()))},p=Object.keys(l.byType).map(s=>({name:s,value:l.byType[s]})),u=Object.keys(l.byType).map((s,r)=>({name:s.length>15?s.substring(0,15)+"...":s,count:l.byType[s],fullName:s,color:d[r%d.length]}));return e.jsxs("div",{className:`p-6 rounded-2xl ${a?"bg-gray-800":"bg-white"} shadow-md`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center",children:[e.jsx("i",{className:"fas fa-chart-line text-red-600 mr-2"}),"错误监控仪表盘"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:y,disabled:g,className:`px-3 py-1.5 rounded-lg text-sm flex items-center ${a?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"} transition-colors`,children:g?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-1"}),"刷新中"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-sync-alt mr-1"}),"刷新"]})}),e.jsxs("button",{onClick:T,className:`px-3 py-1.5 rounded-lg text-sm text-red-600 flex items-center ${a?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"} transition-colors`,children:[e.jsx("i",{className:"fas fa-trash-alt mr-1"}),"清除日志"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[{title:"总错误数",value:l.total,icon:"exclamation-circle",color:"red"},{title:"错误类型",value:Object.keys(l.byType).length,icon:"bug",color:"blue"},{title:"今日新增",value:Math.floor(Math.random()*l.total)+1,icon:"plus-circle",color:"green"},{title:"活跃用户影响",value:Math.floor(Math.random()*100)+1,icon:"users",color:"purple"}].map((s,r)=>e.jsx(c.div,{className:`p-4 rounded-xl ${a?"bg-gray-700":"bg-gray-50"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1*r},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm mb-1 ${a?"text-gray-400":"text-gray-600"}`,children:s.title}),e.jsx("h3",{className:"text-xl font-bold",children:s.value})]}),e.jsx("div",{className:`p-2 rounded-full bg-${s.color}-100 text-${s.color}-600`,children:e.jsx("i",{className:`fas fa-${s.icon} text-lg`})})]})},r))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs(c.div,{className:`p-6 rounded-xl ${a?"bg-gray-700":"bg-gray-50"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[e.jsx("h4",{className:"font-medium mb-4",children:"错误类型分布"}),e.jsx("div",{className:"h-64",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(C,{children:[e.jsx(I,{data:p,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",nameKey:"name",label:({name:s,percent:r})=>`${s} ${(r*100).toFixed(0)}%`,children:p.map((s,r)=>e.jsx(N,{fill:d[r%d.length]},`cell-${r}`))}),e.jsx(v,{formatter:(s,r)=>[`${s} 次`,w[r]||r],contentStyle:{backgroundColor:a?"#1f2937":"#ffffff",borderColor:a?"#374151":"#e5e7eb",borderRadius:"0.5rem",color:a?"#ffffff":"#000000"}})]})})})]}),e.jsxs(c.div,{className:`lg:col-span-2 p-6 rounded-xl ${a?"bg-gray-700":"bg-gray-50"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:[e.jsx("h4",{className:"font-medium mb-4",children:"错误类型统计"}),e.jsx("div",{className:"h-64",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(R,{data:u,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:a?"#374151":"#e5e7eb"}),e.jsx(D,{dataKey:"name",tick:{fill:a?"#9ca3af":"#4b5563"},axisLine:{stroke:a?"#374151":"#e5e7eb"},angle:-45,textAnchor:"end",height:80}),e.jsx(L,{tick:{fill:a?"#9ca3af":"#4b5563"},axisLine:{stroke:a?"#374151":"#e5e7eb"}}),e.jsx(v,{formatter:(s,r,j)=>[`${s} 次`,w[j.payload.fullName]||j.payload.fullName],contentStyle:{backgroundColor:a?"#1f2937":"#ffffff",borderColor:a?"#374151":"#e5e7eb",borderRadius:"0.5rem",color:a?"#ffffff":"#000000"}}),e.jsx(M,{dataKey:"count",name:"错误次数",radius:[4,4,0,0],children:u.map((s,r)=>e.jsx(N,{fill:s.color},`cell-${r}`))})]})})})]})]}),e.jsxs(c.div,{className:`p-6 rounded-xl ${a?"bg-gray-700":"bg-gray-50"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:[e.jsxs("h4",{className:"font-medium mb-4",children:["最近错误记录（共 ",l.total," 条）"]}),e.jsx("div",{className:`overflow-x-auto rounded-xl border ${a?"border-gray-600":"border-gray-200"}`,children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:`${a?"bg-gray-600":"bg-gray-100"}`,children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"错误ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"类型"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"消息"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"时间"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"浏览器"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"URL"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-600",children:l.recent.map(s=>e.jsxs("tr",{className:`hover:bg-gray-600/50 cursor-pointer ${S===s.errorType?"bg-blue-900/20":""}`,onClick:()=>{k(s),o(!0)},children:[e.jsxs("td",{className:"px-4 py-3 text-sm",children:[s.errorId.substring(0,8),"..."]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.errorType.includes("NETWORK")?"bg-red-100 text-red-600":s.errorType.includes("PERMISSION")?"bg-yellow-100 text-yellow-600":s.errorType.includes("MODEL")?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}`,children:s.errorType})}),e.jsx("td",{className:"px-4 py-3 text-sm max-w-xs truncate",children:s.message}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(s.timestamp).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[s.deviceInfo.browser," v",s.deviceInfo.browserVersion]}),e.jsx("td",{className:"px-4 py-3 text-sm max-w-xs truncate",children:s.url})]},s.errorId))})]})}),l.recent.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"fas fa-check-circle text-green-500 text-2xl mb-2"}),e.jsx("p",{children:"暂无错误记录"})]})]}),e.jsx(A,{children:E&&t&&e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>o(!1),children:e.jsxs(c.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.95},className:`w-full max-w-4xl rounded-2xl overflow-y-auto max-h-[90vh] ${a?"bg-gray-800":"bg-white"} shadow-2xl`,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-750",children:[e.jsx("h4",{className:"text-xl font-bold",children:"错误详情"}),e.jsx("button",{onClick:()=>o(!1),className:"p-2 rounded-full hover:bg-gray-700 transition-colors",children:e.jsx("i",{className:"fas fa-times text-gray-400 hover:text-white"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"错误ID:"}),e.jsx("span",{className:"text-sm font-mono",children:t.errorId})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"错误类型:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.errorType.includes("NETWORK")?"bg-red-100 text-red-600":t.errorType.includes("PERMISSION")?"bg-yellow-100 text-yellow-600":t.errorType.includes("MODEL")?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}`,children:t.errorType})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"发生时间:"}),e.jsx("span",{className:"text-sm",children:new Date(t.timestamp).toLocaleString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"URL:"}),e.jsx("span",{className:"text-sm truncate max-w-xs",children:t.url})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"浏览器:"}),e.jsxs("span",{className:"text-sm",children:[t.deviceInfo.browser," v",t.deviceInfo.browserVersion]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"操作系统:"}),e.jsx("span",{className:"text-sm",children:t.deviceInfo.os})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"设备类型:"}),e.jsx("span",{className:"text-sm",children:t.deviceInfo.device})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-500 mb-2",children:"错误消息:"}),e.jsx("div",{className:"p-3 rounded-lg bg-gray-700 text-sm",children:t.message})]}),t.stackTrace&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-500 mb-2",children:"堆栈跟踪:"}),e.jsx("div",{className:"p-3 rounded-lg bg-gray-900 font-mono text-xs text-gray-300 overflow-x-auto max-h-48",children:e.jsx("pre",{children:t.stackTrace})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-500 mb-2",children:"用户代理:"}),e.jsx("div",{className:"p-3 rounded-lg bg-gray-700 text-xs overflow-x-auto",children:t.userAgent})]}),t.context&&Object.keys(t.context).length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-500 mb-2",children:"上下文信息:"}),e.jsx("div",{className:"p-3 rounded-lg bg-gray-700 text-sm font-mono overflow-x-auto",children:e.jsx("pre",{children:JSON.stringify(t.context,null,2)})})]})]})]})})})]})};export{F as default};
