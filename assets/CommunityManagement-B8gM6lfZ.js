import{r as p,j as e,m as K,T as te,t as r}from"./index-DW-f9EnK.js";const ne=({isDark:s,userCommunities:m,onUserCommunitiesChange:j,joinedCommunities:F,onJoinedCommunitiesChange:A,adminStore:g,onAdminStoreChange:w,memberStore:d,onMemberStoreChange:f,announceStore:N,onAnnounceStoreChange:E,privacyStore:x,onPrivacyStoreChange:v,currentEmail:u,communityTab:T,onCommunityTabChange:O})=>{const[_,z]=p.useState(""),[B,P]=p.useState(""),[R,H]=p.useState(""),[o,$]=p.useState(null),[n,L]=p.useState(null),[q,b]=p.useState(""),[C,Q]=p.useState(null),h=t=>{var l;return((l=g[t])==null?void 0:l.includes(u))||!1},V=()=>{const t=_.trim(),l=B.trim(),a=R.split(",").map(y=>y.trim()).filter(Boolean);if(!t){r.warning("请输入社群名称");return}if(!l){r.warning("请输入社群简介");return}const i=`uc-${Date.now()}`;j([{id:i,name:t,description:l,cover:"https://trae-api-sg.mchost.guru/api/ide/v1/text_to_image?image_size=1920x1080&prompt=User%20community%20banner%20minimal%20style",tags:a,members:1},...m]),A([...F,i]),u&&(w({...g,[i]:[u]}),f({...d,[i]:[u]})),v({...x,[i]:"public"}),z(""),P(""),H(""),O("user"),r.success("已创建社群")},W=t=>{if(!window.confirm("确定要删除这个社群吗？此操作不可恢复。"))return;j(m.filter(y=>y.id!==t)),A(F.filter(y=>y!==t));const a={...g},i={...d},c={...N},M={...x};delete a[t],delete i[t],delete c[t],delete M[t],w(a),f(i),E(c),v(M),r.success("社群已删除")},X=t=>{$({id:t.id,name:t.name,desc:t.description,tags:t.tags.join(",")})},Y=()=>{$(null)},Z=()=>{if(!o)return;const t=o.name.trim(),l=o.desc.trim(),a=o.tags.split(",").map(c=>c.trim()).filter(Boolean);if(!t||!l){r.warning("名称与简介不能为空");return}const i=m.map(c=>c.id===o.id?{...c,name:t,description:l,tags:a}:c);j(i),r.success("已保存社群信息"),$(null)},I=t=>{L(t),b("")},G=()=>{L(null),b("")},J=()=>{if(!n)return;if(!h(n)){r.warning("仅管理员可添加成员");return}const t=q.trim().toLowerCase();if(!t||!t.includes("@")){r.warning("请输入有效邮箱");return}const l={...d,[n]:Array.from(new Set([...d[n]||[],t]))};f(l),b(""),r.success("已添加成员")},U=t=>{if(!n)return;if(!h(n)){r.warning("仅管理员可移除成员");return}const l={...d,[n]:(d[n]||[]).filter(a=>a!==t)};f(l),r.success("已移除成员")},k=t=>{if(!n)return;if(!h(n)){r.warning("仅管理员可设置公告");return}const l={...N,[n]:t};E(l),r.success("公告已更新")},S=()=>{if(!n)return;if(!h(n)){r.warning("仅管理员可切换隐私");return}const t=x[n]||"public",l={...x,[n]:t==="public"?"private":"public"};v(l),r.success(`社群已切换为${t==="public"?"私密":"公开"}模式`)},D=t=>{if(!n)return;if(!h(n)){r.warning("仅管理员可更改角色");return}const l=g[n]||[],a=l.includes(t)?l.filter(c=>c!==t):[...l,t],i={...g,[n]:a};w(i),r.success("管理员角色已更新")},ee=t=>{Q(C===t?null:t)};return e.jsxs(e.Fragment,{children:[T==="user"&&e.jsxs("div",{className:`${s?"bg-gray-700":"bg-white/70"} p-4 rounded-xl mb-4 ring-1 ${s?"ring-gray-700":"ring-rose-200"}`,children:[e.jsx("div",{className:"text-sm opacity-70 mb-2",children:"创建新社群"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("input",{value:_,onChange:t=>z(t.target.value),placeholder:"社群名称",className:`${s?"bg-gray-800 text-white ring-1 ring-gray-700":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${s?"focus:ring-purple-500":"focus:ring-pink-300"}`}),e.jsx("input",{value:B,onChange:t=>P(t.target.value),placeholder:"社群简介",className:`${s?"bg-gray-800 text-white ring-1 ring-gray-700":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${s?"focus:ring-purple-500":"focus:ring-pink-300"}`}),e.jsx("input",{value:R,onChange:t=>H(t.target.value),placeholder:"标签（逗号分隔）",className:`${s?"bg-gray-800 text-white ring-1 ring-gray-700":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${s?"focus:ring-purple-500":"focus:ring-pink-300"}`})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{onClick:V,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-red-600 to-pink-600 text-white transition-colors hover:opacity-90",children:"创建"})})]}),T==="user"&&e.jsx(e.Fragment,{children:m.length===0?e.jsx("div",{className:`text-sm ${s?"text-gray-400":"text-gray-600"}`,children:"暂无自建社群，快来创建吧～"}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(t=>{var l;return e.jsxs(K.div,{className:`${s?"bg-gray-800":"bg-white/80"} ring-1 ${s?"ring-gray-700":"ring-rose-200"} rounded-xl overflow-hidden shadow-sm`,whileHover:{y:-4},children:[e.jsx(te,{src:t.cover,alt:t.name,className:"w-full aspect-[4/3] object-cover"}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"font-medium mb-1 flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:t.name}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full ${s?"bg-gray-700 text-gray-300":"bg-rose-100 text-rose-700"} ring-1 ${s?"ring-gray-700":"ring-rose-200"}`,children:"个人"})]}),e.jsx("div",{className:`text-sm mb-2 ${s?"text-gray-300":"text-gray-700"} line-clamp-2`,children:t.description}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:t.tags.slice(0,3).map((a,i)=>e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${s?"bg-gray-700 text-gray-200":"bg-gray-100 text-gray-700"}`,children:["#",a]},i))}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"text-xs opacity-70 flex items-center gap-1 cursor-pointer",onClick:()=>ee(t.id),children:[e.jsxs("span",{children:["成员 ",((l=d[t.id])==null?void 0:l.length)||1," 人"]}),e.jsx("span",{children:C===t.id?"▼":"▶"})]}),C===t.id&&e.jsx("div",{className:"mt-2 space-y-1 text-xs max-h-[120px] overflow-y-auto",children:[u,...d[t.id]||[]].map((a,i)=>{var c;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:a}),e.jsx("span",{className:`px-1.5 py-0.5 rounded ${s?"bg-gray-700":"bg-gray-100"}`,children:(c=g[t.id])!=null&&c.includes(a)?"管理员":"成员"})]},i)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`text-xs ${s?"text-gray-400":"text-gray-600"}`,children:x[t.id]==="private"?"私密":"公开"}),e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:(o==null?void 0:o.id)===t.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Z,className:`text-xs px-2 py-0.5 rounded-full ${s?"bg-green-600 text-white":"bg-green-500 text-white"}`,children:"保存"}),e.jsx("button",{onClick:Y,className:`text-xs px-2 py-0.5 rounded-full ${s?"bg-gray-700 text-white":"bg-gray-200 text-gray-800"}`,children:"取消"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>X(t),className:`text-xs px-2 py-0.5 rounded-full ${s?"bg-gray-700 text-white":"bg-gray-200 text-gray-800"}`,children:"编辑"}),e.jsx("button",{onClick:()=>I(t.id),className:`text-xs px-2 py-0.5 rounded-full ${s?"bg-blue-600 text-white":"bg-blue-500 text-white"}`,children:"管理"}),e.jsx("button",{onClick:()=>W(t.id),className:`text-xs px-2 py-0.5 rounded-full ${s?"bg-red-600 text-white":"bg-red-500 text-white"}`,children:"删除"})]})})]})]})]},t.id)})})}),n&&e.jsx("div",{className:`fixed inset-0 z-50 ${s?"bg-black/70":"bg-black/50"} backdrop-blur-sm flex items-center justify-center p-4`,children:e.jsxs(K.div,{className:`${s?"bg-gray-800":"bg-white"} rounded-2xl shadow-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto`,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"社群管理"}),e.jsx("button",{onClick:G,className:`${s?"text-gray-400 hover:text-white":"text-gray-600 hover:text-gray-900"} text-xl`,children:"×"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium mb-3",children:"成员管理"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("input",{value:q,onChange:t=>b(t.target.value),placeholder:"添加成员邮箱",className:`flex-1 ${s?"bg-gray-700 text-white ring-1 ring-gray-600":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${s?"focus:ring-purple-500":"focus:ring-pink-300"}`}),e.jsx("button",{onClick:J,className:`${s?"bg-blue-600 text-white":"bg-blue-500 text-white"} px-3 py-2 rounded-lg text-sm`,children:"添加"})]}),e.jsx("div",{className:"space-y-2",children:[u,...d[n]||[]].map((t,l)=>{var a,i;return e.jsxs("div",{className:`flex items-center justify-between p-2 rounded-lg ${s?"bg-gray-700":"bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm",children:t}),((a=g[n])==null?void 0:a.includes(t))&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${s?"bg-purple-600 text-white":"bg-purple-500 text-white"}`,children:"管理员"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t!==u&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>D(t),className:`text-xs px-2 py-1 rounded-full ${s?"bg-gray-600 text-white":"bg-gray-200 text-gray-800"}`,children:(i=g[n])!=null&&i.includes(t)?"移除管理员":"设为管理员"}),e.jsx("button",{onClick:()=>U(t),className:`text-xs px-2 py-1 rounded-full ${s?"bg-red-600 text-white":"bg-red-500 text-white"}`,children:"移除"})]})})]},l)})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium mb-3",children:"社群设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm",children:"隐私设置"}),e.jsx("button",{onClick:S,className:`text-xs px-3 py-1 rounded-full ${x[n]==="private"?s?"bg-gray-600 text-white":"bg-gray-200 text-gray-800":s?"bg-blue-600 text-white":"bg-blue-500 text-white"}`,children:x[n]==="private"?"私密":"公开"})]}),e.jsx("div",{className:`text-xs ${s?"text-gray-400":"text-gray-600"}`,children:x[n]==="private"?"仅邀请成员可加入":"所有人可加入"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm mb-2",children:"社群公告"}),e.jsx("textarea",{value:N[n]||"",onChange:t=>k(t.target.value),placeholder:"输入社群公告",className:`w-full h-20 ${s?"bg-gray-700 text-white ring-1 ring-gray-600":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${s?"focus:ring-purple-500":"focus:ring-pink-300"}`})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:G,className:`px-4 py-2 rounded-lg ${s?"bg-gray-700 text-white":"bg-gray-200 text-gray-800"} transition-colors hover:opacity-90`,children:"关闭"})})]})})]})};export{ne as default};
