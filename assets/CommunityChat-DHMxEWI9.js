import{r as d,j as t,m as W,bF as X,t as S}from"./index-DW-f9EnK.js";const C=({isDark:s,joinedCommunities:E,recommendedCommunities:y,userCommunities:p,activeChatCommunityId:x,onActiveChatCommunityChange:A,pinnedJoined:f,onTogglePinJoined:P,mutedCommunities:J,onToggleMuteCommunity:M,communityMessages:c,onCommunityMessagesChange:b,mockCreators:j})=>{const[m,q]=d.useState(""),[N,v]=d.useState(""),[T,_]=d.useState(!1),[o,w]=d.useState(null),[Y,Z]=d.useState(""),F=["ğŸ‘","â¤ï¸","ğŸ˜‚","ğŸ‰","ğŸ˜®","ğŸ˜¢","ğŸ˜¡","ğŸ¤”","ğŸ‘€","ğŸ‘"],z=d.useMemo(()=>[...y,...p].filter(r=>E.includes(r.id)),[E,p,y]),O=d.useMemo(()=>{const e=m.trim().toLowerCase(),r=z.filter(n=>e?`${n.name} ${n.description} ${n.tags.join(" ")}`.toLowerCase().includes(e):!0),a=r.filter(n=>f.includes(n.id)),l=r.filter(n=>!f.includes(n.id));return[...a,...l]},[z,m,f]),L=(e,r)=>{const a=r.trim();if(!a)return;const l=j.find(g=>g.online)||j[0],n={id:`cm-${Date.now()}`,user:l.name,text:a,avatar:l.avatar,createdAt:Date.now(),replyTo:o?{id:o.id,user:o.user,text:o.text}:void 0,reactions:{}},h={...c,[e]:[n,...c[e]||[]]};b(h),localStorage.setItem("jmzf_community_messages",JSON.stringify(h)),S.success("å·²å‘é€åˆ°è¯¥ç¤¾ç¾¤"),v(""),w(null)},K=(e,r,a)=>{const n=(j.find(g=>g.online)||j[0]).name,h={...c,[e]:(c[e]||[]).map(g=>{if(g.id!==r)return g;const u={...g.reactions||{}},$=u[a]||[];return $.includes(n)?(u[a]=$.filter(V=>V!==n),u[a].length===0&&delete u[a]):u[a]=[...$,n],{...g,reactions:u}})};b(h),localStorage.setItem("jmzf_community_messages",JSON.stringify(h))},B=e=>{w(e)},G=()=>{w(null)},H=e=>{v(r=>r+e),_(!1)},Q=(e,r)=>{const a={...c,[e]:(c[e]||[]).filter(l=>l.id!==r)};b(a),localStorage.setItem("jmzf_community_messages",JSON.stringify(a)),S.success("æ¶ˆæ¯å·²åˆ é™¤")},U=(e,r)=>{const a={...c,[e]:(c[e]||[]).map(l=>l.id===r?{...l,pinned:!l.pinned}:l)};b(a),localStorage.setItem("jmzf_community_messages",JSON.stringify(a)),S.success("ç½®é¡¶çŠ¶æ€å·²æ›´æ–°")},i=d.useMemo(()=>x&&[...y,...p].find(r=>r.id===x)||null,[x,y,p]),R=d.useMemo(()=>x?c[x]||[]:[],[x,c]);return t.jsxs(W.section,{className:`mb-6 ${s?"bg-gray-800":"bg-white"} rounded-2xl shadow-md p-4`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"font-medium",children:"ç¤¾ç¾¤åˆ—è¡¨ä¸èŠå¤©"}),t.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s?"bg-gray-700 text-gray-200":"bg-gray-100 text-gray-700"}`,children:"å¿«é€Ÿäº¤æµ"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"lg:col-span-1",children:[t.jsx("div",{className:"flex items-center gap-2 mb-2",children:t.jsx("input",{value:m,onChange:e=>q(e.target.value),placeholder:"æœç´¢å·²åŠ å…¥ç¤¾ç¾¤...",className:`${s?"bg-gray-800 text-white ring-1 ring-gray-700":"bg-white text-gray-900 ring-1 ring-gray-300"} px-3 py-2 rounded-lg flex-1 focus:outline-none focus:ring-2 ${s?"focus:ring-purple-500":"focus:ring-pink-300"}`})}),t.jsx("ul",{className:"space-y-2 max-h-[38vh] overflow-y-auto sm:max-h-[50vh]",children:O.length===0?t.jsx("li",{className:"text-sm opacity-60",children:"æš‚æ— å·²åŠ å…¥ç¤¾ç¾¤"}):O.map(e=>t.jsx("li",{children:t.jsxs("button",{onClick:()=>A(e.id),className:`w-full text-left p-2 rounded-lg text-sm ring-1 transition-colors ${x===e.id?"bg-indigo-600 text-white ring-indigo-600":s?"bg-gray-700 text-white ring-gray-700":"bg-gray-100 text-gray-900 ring-gray-200"}`,children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("div",{className:"font-medium truncate mr-2",children:e.name})}),t.jsx("div",{className:"text-xs opacity-70 mt-1 text-gray-300",children:e.tags.slice(0,2).join(" Â· ")})]})},`chatlist-top-${e.id}`))})]}),t.jsx("div",{className:"lg:col-span-2",children:i?t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"font-medium",children:i.name}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>P(i.id),className:`${s?"bg-gray-700 text-white":"bg-gray-200 text-gray-800"} text-xs px-3 py-1 rounded-full transition-colors`,children:f.includes(i.id)?"å–æ¶ˆç½®é¡¶":"ç½®é¡¶"}),t.jsx("button",{onClick:()=>M(i.id),className:`${s?"bg-gray-700 text-white":"bg-gray-200 text-gray-800"} text-xs px-3 py-1 rounded-full transition-colors`,children:J.includes(i.id)?"å–æ¶ˆé™éŸ³":"é™éŸ³"})]})]}),t.jsx("div",{className:"space-y-3 mb-4 max-h-[40vh] sm:max-h-[50vh] overflow-y-auto pr-1",children:R.length===0?t.jsx("div",{className:"text-sm opacity-60 text-center py-4",children:"æš‚æ— æ¶ˆæ¯ï¼Œå¿«æ¥å‘ç¬¬ä¸€æ¡æ¶ˆæ¯å§ï¼"}):R.map(e=>t.jsx("div",{className:`p-3 rounded-xl ${s?"bg-gray-700":"bg-gray-100"}`,children:t.jsxs("div",{className:"flex items-start",children:[t.jsx(X,{src:e.avatar,alt:e.user,size:"sm",className:"mr-3"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[e.replyTo&&t.jsxs("div",{className:`mb-2 p-2 rounded-lg text-xs ${s?"bg-gray-800 text-gray-300":"bg-gray-200 text-gray-700"}`,children:[t.jsxs("div",{className:"font-medium",children:["å›å¤ ",e.replyTo.user,":"]}),t.jsx("div",{className:"text-xs opacity-80 line-clamp-2",children:e.replyTo.text})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("div",{className:"text-sm font-medium truncate",children:e.user})}),t.jsx("div",{className:"text-xs text-gray-400",children:e.createdAt?new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]}),t.jsx("div",{className:`text-sm ${s?"text-gray-200":"text-gray-800"} mb-2 break-words`,children:e.text}),e.reactions&&Object.keys(e.reactions).length>0&&t.jsx("div",{className:"flex items-center gap-1 mb-2 flex-wrap",children:Object.entries(e.reactions).map(([r,a])=>t.jsxs("button",{onClick:()=>e.id&&K(i.id,e.id,r),className:`flex items-center gap-1 px-2 py-0.5 rounded-full text-xs ${s?"bg-gray-800 text-white hover:bg-gray-700":"bg-white text-gray-800 hover:bg-gray-200"} ring-1 ${s?"ring-gray-700":"ring-gray-300"} transition-colors`,children:[t.jsx("span",{children:r}),t.jsx("span",{children:a.length})]},r))}),t.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[t.jsx("button",{onClick:()=>e.id&&B(e),className:`${s?"bg-gray-800 text-white":"bg-white text-gray-800"} px-2 py-0.5 rounded-lg text-xs ring-1 ${s?"ring-gray-700":"ring-gray-300"} transition-colors`,children:"å›å¤"}),t.jsx("button",{onClick:()=>e.id&&U(i.id,e.id),className:`${s?"bg-gray-800 text-white":"bg-white text-gray-800"} px-2 py-0.5 rounded-lg text-xs ring-1 ${s?"ring-gray-700":"ring-gray-300"} transition-colors`,children:e.pinned?"å–æ¶ˆç½®é¡¶":"ç½®é¡¶"}),t.jsx("button",{onClick:()=>e.id&&Q(i.id,e.id),className:`${s?"bg-red-700 text-white":"bg-red-100 text-red-800"} px-2 py-0.5 rounded-lg text-xs transition-colors`,children:"åˆ é™¤"})]})]})]})},e.id))}),o&&t.jsxs("div",{className:`flex items-center gap-2 mb-2 p-2 rounded-lg ${s?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"}`,children:[t.jsxs("div",{className:"text-sm",children:["å›å¤ ",o.user,":"]}),t.jsx("button",{onClick:G,className:`text-xs px-2 py-0.5 rounded-full ${s?"bg-gray-800 text-white":"bg-white text-gray-800"}`,children:"å–æ¶ˆ"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{value:N,onChange:e=>v(e.target.value),onKeyPress:e=>e.key==="Enter"&&L(i.id,N),placeholder:o?`å›å¤ ${o.user}...`:"å‘è¡¨ä½ çš„çœ‹æ³•...",className:`w-full px-3 py-2 rounded-lg focus:outline-none focus:ring-2 ${s?"bg-gray-700 text-white ring-1 ring-gray-600 focus:ring-purple-500":"bg-white text-gray-900 ring-1 ring-gray-300 focus:ring-pink-300"}`}),t.jsxs("div",{className:"relative",children:[t.jsx("button",{onClick:()=>_(!T),className:`absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded-full ${s?"hover:bg-gray-600 text-white":"hover:bg-gray-200 text-gray-800"}`,children:"ğŸ˜Š"}),T&&t.jsx("div",{className:`absolute bottom-full right-0 mb-2 p-2 rounded-lg shadow-lg z-10 ${s?"bg-gray-800 ring-1 ring-gray-700":"bg-white ring-1 ring-gray-300"}`,children:t.jsx("div",{className:"grid grid-cols-5 gap-2",children:F.map(e=>t.jsx("button",{onClick:()=>H(e),className:`text-xl p-1 rounded-full ${s?"hover:bg-gray-700":"hover:bg-gray-200"}`,children:e},e))})})]})]}),t.jsx("button",{onClick:()=>L(i.id,N),className:"px-3 py-2 rounded-lg bg-gradient-to-r from-red-600 to-pink-600 text-white transition-colors hover:opacity-90",children:"å‘é€"})]})]}):t.jsx("div",{className:`flex items-center justify-center h-72 rounded-lg ${s?"bg-gray-700":"bg-gray-100"}`,children:t.jsx("div",{className:"text-sm opacity-60",children:"è¯·é€‰æ‹©ä¸€ä¸ªç¤¾ç¾¤å¼€å§‹èŠå¤©"})})})]})]})};export{C as default};
