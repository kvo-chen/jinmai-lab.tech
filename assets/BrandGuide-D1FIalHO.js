import{u as J,r as i,j as t,G as V,m as v,t as x}from"./index-DW-f9EnK.js";import{B as N}from"./brands-DuRnfe6a.js";import{i as D}from"./ipService-BJ5gZhtN.js";function X(){const{isDark:r}=J(),[s,R]=i.useState(N[0]),[w,A]=i.useState(""),[k,L]=i.useState("想怎么创新麻花？"),[p,$]=i.useState(""),[h,C]=i.useState(""),[y,j]=i.useState(""),[B,I]=i.useState([]),[d,T]=i.useState("all"),[g,E]=i.useState("recent"),[G,F]=i.useState(0);i.useEffect(()=>{try{const e=localStorage.getItem("BrandGuide.persist");if(e){const a=JSON.parse(e),l=N.find(n=>n.id===a.brandId);l&&R(l),typeof a.brandSearch=="string"&&A(a.brandSearch),typeof a.chat=="string"&&L(a.chat),typeof a.contact=="string"&&$(a.contact),typeof a.phone=="string"&&C(a.phone),typeof a.idea=="string"&&j(a.idea),["all","pending","negotiating","approved","rejected"].includes(a.statusFilter)&&T(a.statusFilter),["recent","old","status"].includes(a.sortKey)&&E(a.sortKey)}}catch{}},[]),i.useEffect(()=>{try{const e={brandId:s.id,brandSearch:w,chat:k,contact:p,phone:h,idea:y,statusFilter:d,sortKey:g};localStorage.setItem("BrandGuide.persist",JSON.stringify(e))}catch{}},[s.id,w,k,p,h,y,d,g]);const b=i.useMemo(()=>D.getAllPartnerships().filter(e=>e.brandName===s.name),[s,G]),S=i.useMemo(()=>{const e={pending:0,negotiating:0,approved:0,rejected:0};return b.forEach(a=>{e[a.status]=(e[a.status]||0)+1}),e},[b]),O=i.useMemo(()=>{let e=b;d!=="all"&&(e=e.filter(o=>o.status===d));const a=(o,m)=>new Date(m.updatedAt).getTime()-new Date(o.updatedAt).getTime(),l=(o,m)=>new Date(o.updatedAt).getTime()-new Date(m.updatedAt).getTime(),n={pending:0,negotiating:1,approved:2,rejected:3},u=g==="recent"?a:g==="old"?l:(o,m)=>n[o.status]-n[m.status];return[...e].sort(u)},[b,d,g]),H=()=>{const e=O,a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),l=URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download=`${s.name}-合作申请.json`,n.click(),URL.revokeObjectURL(l)},P=()=>{const e=["品牌","说明","状态","奖励","更新时间"],a=O.map(o=>[o.brandName,o.description.replace(/\n/g," "),o.status,o.reward,new Date(o.updatedAt).toLocaleString()]),l=[e,...a].map(o=>o.map(m=>'"'+String(m).replace(/"/g,'""')+'"').join(",")).join(`
`),n=new Blob([l],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(n),u=document.createElement("a");u.href=f,u.download=`${s.name}-合作申请.csv`,u.click(),URL.revokeObjectURL(f)},c=i.useMemo(()=>{const e=p.trim().length>0,a=h.trim(),l=/^1[3-9]\d{9}$/.test(a),n=a.length>=5&&!/\s/.test(a),f=l||n,u=y.trim().length>0;return{nameOk:e,phoneOk:f,ideaOk:u,nameMsg:e?"":"请输入联系人姓名",phoneMsg:f?"":"请输入有效的联系方式（手机或微信）",ideaMsg:u?"":`请输入合作想法（基于 ${s.name} ）`}},[p,h,y,s.name]),K=c.nameOk&&c.phoneOk&&c.ideaOk,M=(e,a)=>{D.updatePartnershipStatus(e,a)?(F(n=>n+1),x.success("状态已更新")):x.error("更新失败")},U=async()=>{const e=k.trim()||`围绕${s.name}做一次联名升级`,a=[`${s.name} × 校园潮流：${e}，推出限定周边礼盒`,`${s.name} 城市记忆计划：${e}，设计主题海报与KV`,`${s.name} 数字文创：${e}，发布数字藏品或表情包`];I(a)},z=()=>{if(!p.trim()){x.warning("请输入联系人姓名");return}const e=h.trim(),a=/^1[3-9]\d{9}$/.test(e),l=e.length>=5&&!/\s/.test(e);if(!a&&!l){x.warning("请输入有效的联系方式（手机或微信）");return}if(!y.trim()){x.warning("请输入合作想法");return}D.createPartnership({brandName:s.name,brandLogo:s.image,description:`${y}（联系人：${p}，电话：${h}）`,reward:"待协商",status:"pending",ipAssetId:"ip-001"}),$(""),C(""),j(""),F(n=>n+1),x.success("已提交合作申请，我们会尽快联系您")};return t.jsxs("main",{className:"container mx-auto px-4 py-8 scroll-smooth","aria-label":"主要内容",children:[t.jsx(V,{title:"品牌合作",subtitle:"面向老字号品牌的共创入口：选择品牌、生成灵感、提交合作与管理申请",theme:"red",stats:[{label:"当前品牌",value:s.name},{label:"申请数量",value:b.length.toString()},{label:"状态",value:d},{label:"排序",value:g==="recent"?"最新":g==="old"?"最早":"状态"}],badgeText:"Beta",pattern:!0,size:"lg"}),t.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs(v.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.25},className:`${r?"bg-gray-800/80 ring-1 ring-gray-700":"bg-white/90 ring-1 ring-gray-200"} rounded-2xl shadow-xl p-6 backdrop-blur lg:sticky lg:top-6`,id:"brand-section","aria-labelledby":"brand-section-title",children:[t.jsx("h2",{className:"text-base font-semibold mb-3",children:"选择老字号"}),t.jsx("label",{htmlFor:"brand-search",className:"sr-only",children:"搜索品牌名称"}),t.jsx("input",{value:w,onChange:e=>A(e.target.value),id:"brand-search",className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 mb-2`,placeholder:"搜索品牌名称"}),t.jsx("select",{value:s.id,onChange:e=>R(N.find(a=>a.id===e.target.value)||N[0]),className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2`,children:N.filter(e=>e.name.toLowerCase().includes(w.trim().toLowerCase())).map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))}),t.jsxs("div",{className:"mt-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:s.image,alt:s.name,className:"w-full h-40 object-cover rounded-xl",loading:"lazy",decoding:"async"}),t.jsx("div",{className:`absolute inset-x-0 bottom-0 px-3 py-2 text-xs ${r?"bg-black/40 text-gray-200":"bg-white/50 text-gray-800"} rounded-b-xl backdrop-blur-sm`,children:s.name})]}),t.jsx("p",{className:`${r?"text-gray-400":"text-gray-600"} mt-3 text-sm leading-relaxed`,children:s.story})]})]}),t.jsxs(v.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.25,delay:.05},className:`lg:col-span-2 ${r?"bg-gray-800/80 ring-1 ring-gray-700":"bg-white/90 ring-1 ring-gray-200"} rounded-2xl shadow-xl p-6 backdrop-blur`,id:"ai-section","aria-labelledby":"ai-section-title",children:[t.jsx("div",{className:"mb-3",children:"AI聊天引导"}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:["赛博朋克风","校园潮流联名","数字文创表情包"].map((e,a)=>t.jsx("button",{className:`${r?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-100 text-gray-900 hover:bg-gray-200"} text-xs px-3 py-1 rounded-full transition-colors`,onClick:()=>L(`把${s.name}做成${e}`),children:e},a))}),t.jsx("label",{htmlFor:"chat-input",className:"sr-only",children:"创作灵感输入框"}),t.jsx("textarea",{value:k,onChange:e=>L(e.target.value),onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&(e.preventDefault(),U())},id:"chat-input","aria-describedby":"chat-hint",className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full h-32 px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2`,autoCapitalize:"none",autoCorrect:"off",enterKeyHint:"send",inputMode:"text"}),t.jsx("div",{id:"chat-hint",className:"mt-3 text-sm opacity-70",children:"示例：把麻花做成赛博朋克风"}),t.jsx(v.button,{whileHover:{scale:1.03},onClick:U,className:"mt-4 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white px-4 py-2 rounded-lg shadow min-h-[44px]",children:"生成灵感"}),B.length>0&&t.jsx("ul",{className:"mt-4 space-y-2 text-sm","aria-live":"polite",children:B.map((e,a)=>t.jsxs("li",{className:`${r?"bg-gray-700":"bg-gray-100"} px-3 py-2 rounded-lg flex items-center justify-between hover:bg-opacity-90 transition-colors`,children:[t.jsx("span",{className:"mr-2",children:e}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"px-2 py-1 text-xs rounded bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>j(e),children:"填入合作想法"}),t.jsx("button",{className:`${r?"bg-gray-600 hover:bg-gray-500 text-white":"bg-gray-300 hover:bg-gray-400 text-gray-900"} px-2 py-1 text-xs rounded`,onClick:async()=>{try{await navigator.clipboard.writeText(e),x.success("已复制到剪贴板")}catch{x.error("复制失败")}},children:"复制"})]})]},a))})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6",children:[t.jsxs(v.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.25,delay:.1},className:`${r?"bg-gray-800/80 ring-1 ring-gray-700":"bg-white/90 ring-1 ring-gray-200"} rounded-2xl shadow-xl p-6 backdrop-blur`,id:"apply-section","aria-labelledby":"apply-section-title",children:[t.jsx("div",{className:"font-medium mb-3",children:"提交品牌合作申请"}),t.jsx("label",{htmlFor:"contact-input",className:"sr-only",children:"联系人姓名"}),t.jsx("input",{id:"contact-input",value:p,onChange:e=>$(e.target.value),className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 mb-1 min-h-[44px]`,placeholder:"联系人姓名",autoCapitalize:"none",autoCorrect:"off"}),!c.nameOk&&t.jsx("div",{className:"mb-2 text-xs text-red-600",children:c.nameMsg}),t.jsx("label",{htmlFor:"phone-input",className:"sr-only",children:"联系方式（手机/微信）"}),t.jsx("input",{id:"phone-input",value:h,onChange:e=>C(e.target.value),className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 mb-1 min-h-[44px]`,placeholder:"联系方式（手机/微信）",autoCapitalize:"none",autoCorrect:"off",inputMode:"text",enterKeyHint:"next"}),!c.phoneOk&&t.jsx("div",{className:"mb-2 text-xs text-red-600",children:c.phoneMsg}),t.jsx("label",{htmlFor:"idea-input",className:"sr-only",children:"合作想法"}),t.jsx("textarea",{id:"idea-input",value:y,onChange:e=>j(e.target.value),onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&K&&(e.preventDefault(),z())},className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} w-full h-24 px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 mb-2`,placeholder:`合作想法（基于 ${s.name} ）`,autoCapitalize:"none",autoCorrect:"off",enterKeyHint:"send"}),!c.ideaOk&&t.jsx("div",{className:"mb-3 text-xs text-red-600",children:c.ideaMsg}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:z,disabled:!K,"aria-disabled":!K,className:`bg-gradient-to-r from-red-600 to-pink-600 text-white px-4 py-2 rounded-lg shadow min-h-[44px] ${K?"hover:from-red-700 hover:to-pink-700":"opacity-50 cursor-not-allowed"}`,children:"提交申请"}),t.jsx("button",{onClick:()=>{$(""),C(""),j("")},className:`${r?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"} px-4 py-2 rounded-lg min-h-[44px]`,children:"清空表单"})]})]}),t.jsxs(v.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.25,delay:.15},className:`lg:col-span-2 ${r?"bg-gray-800/80 ring-1 ring-gray-700":"bg-white/90 ring-1 ring-gray-200"} rounded-2xl shadow-xl p-6 backdrop-blur`,id:"list-section","aria-labelledby":"list-section-title",children:[t.jsx("div",{className:"font-medium mb-3",children:"当前该品牌的合作申请"}),t.jsxs("div",{className:"mb-3 flex flex-wrap gap-2 items-center","aria-live":"polite",children:[t.jsx("button",{onClick:H,className:`${r?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"} px-3 py-2 rounded-lg transition-colors`,children:"导出JSON"}),t.jsx("button",{onClick:P,className:`${r?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"} px-3 py-2 rounded-lg transition-colors`,children:"导出CSV"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"all",label:"全部",count:b.length},{key:"pending",label:"待处理",count:S.pending},{key:"negotiating",label:"洽谈中",count:S.negotiating},{key:"approved",label:"已通过",count:S.approved},{key:"rejected",label:"已拒绝",count:S.rejected}].map(e=>t.jsxs("button",{onClick:()=>T(e.key),className:`px-3 py-1 rounded-full text-sm ring-1 ${d===e.key?"bg-blue-600 text-white ring-blue-600":r?"bg-gray-800 text-gray-300 ring-gray-700":"bg-white text-gray-900 ring-gray-200"}`,children:[e.label,t.jsx("span",{className:`ml-2 inline-block px-2 py-0.5 rounded-full text-xs ${d===e.key?"bg-white text-blue-600":r?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-600"}`,children:e.count})]},e.key))}),t.jsxs("select",{value:g,onChange:e=>E(e.target.value),className:`${r?"bg-gray-700 text-white focus:ring-offset-gray-800":"bg-gray-50 text-gray-900"} px-3 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2`,children:[t.jsx("option",{value:"recent",children:"按更新时间(新→旧)"}),t.jsx("option",{value:"old",children:"按更新时间(旧→新)"}),t.jsx("option",{value:"status",children:"按状态"})]})]}),O.length===0?t.jsx("div",{className:"text-sm opacity-70",children:"暂无申请，欢迎成为第一个合作发起者～"}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:`${r?"bg-gray-700":"bg-gray-100"}`,children:[t.jsx("th",{className:"text-left px-3 py-2",children:"品牌"}),t.jsx("th",{className:"text-left px-3 py-2",children:"说明"}),t.jsx("th",{className:"text-left px-3 py-2",children:"状态"}),t.jsx("th",{className:"text-left px-3 py-2",children:"奖励"}),t.jsx("th",{className:"text-left px-3 py-2",children:"更新时间"}),t.jsx("th",{className:"text-left px-3 py-2",children:"操作"})]})}),t.jsx("tbody",{children:O.map(e=>t.jsxs("tr",{className:`${r?"border-gray-700 hover:bg-gray-800/60":"border-gray-200 hover:bg-gray-50"} border-t transition-colors`,children:[t.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("img",{src:e.brandLogo,alt:e.brandName,className:"w-8 h-8 rounded",loading:"lazy",decoding:"async"}),t.jsx("span",{children:e.brandName})]})}),t.jsx("td",{className:"px-3 py-2",children:e.description}),t.jsx("td",{className:"px-3 py-2",children:e.status}),t.jsx("td",{className:"px-3 py-2",children:e.reward}),t.jsx("td",{className:"px-3 py-2",children:new Date(e.updatedAt).toLocaleString()}),t.jsx("td",{className:"px-3 py-2",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>M(e.id,"negotiating"),className:`${r?"bg-gray-700 text-white hover:bg-gray-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"} px-2 py-1 rounded transition-colors`,children:"标记洽谈"}),t.jsx("button",{onClick:()=>M(e.id,"approved"),className:"px-2 py-1 rounded bg-green-500 hover:bg-green-600 text-white transition-colors",children:"通过"}),t.jsx("button",{onClick:()=>M(e.id,"rejected"),className:"px-2 py-1 rounded bg-red-500 hover:bg-red-600 text-white transition-colors",children:"拒绝"})]})})]},e.id))})]})})]})]})]})}export{X as default};
