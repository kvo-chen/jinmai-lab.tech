import{z as se,r as E,j as t,u as ge,G as he,m as xe}from"./index-DW-f9EnK.js";const le=n=>{let b;const a=new Set,l=(N,P)=>{const C=typeof N=="function"?N(b):N;if(!Object.is(C,b)){const T=b;b=P??(typeof C!="object"||C===null)?C:Object.assign({},b,C),a.forEach(I=>I(b,T))}},h=()=>b,v={setState:l,getState:h,getInitialState:()=>L,subscribe:N=>(a.add(N),()=>a.delete(N))},L=b=n(l,h,v);return v},ue=(n=>n?le(n):le),ye=n=>n;function we(n,b=ye){const a=se.useSyncExternalStore(n.subscribe,se.useCallback(()=>b(n.getState()),[n,b]),se.useCallback(()=>b(n.getInitialState()),[n,b]));return se.useDebugValue(a),a}const de=n=>{const b=ue(n),a=l=>we(b,l);return Object.assign(a,b),a},be=(n=>n?de(n):de),pe=[{name:"é»˜è®¤ä¸»é¢˜",backgroundColor:"#f8fafc",gridColor:"#e2e8f0",regionFillOpacity:.3,poiIconSize:14,pathColor:"#3b82f6",textColor:"#1e293b"},{name:"æ·±è‰²ä¸»é¢˜",backgroundColor:"#0f172a",gridColor:"#334155",regionFillOpacity:.4,poiIconSize:14,pathColor:"#60a5fa",textColor:"#f1f5f9"},{name:"é«˜å¯¹æ¯”åº¦ä¸»é¢˜",backgroundColor:"#ffffff",gridColor:"#d1d5db",regionFillOpacity:.5,poiIconSize:16,pathColor:"#ef4444",textColor:"#000000"}],Z={initialCenter:{x:500,y:500},initialZoom:5,minZoom:1,maxZoom:10,themes:pe},K=be((n,b)=>({center:Z.initialCenter,zoom:Z.initialZoom,targetZoom:Z.initialZoom,targetCenter:Z.initialCenter,theme:Z.themes[0],themes:Z.themes,regions:[],pois:[],paths:[],isDragging:!1,dragStart:null,lastDragPosition:null,dragVelocity:{x:0,y:0},width:0,height:0,hoveredPOIId:null,setConfig:a=>{n(l=>{const h={};return a.initialCenter&&(a.initialCenter.x!==l.center.x||a.initialCenter.y!==l.center.y)&&(h.center=a.initialCenter),a.initialZoom!==void 0&&a.initialZoom!==l.zoom&&(h.zoom=a.initialZoom),Object.keys(h).length>0?h:l})},setSize:(a,l)=>{n({width:a,height:l})},setInitialData:a=>{console.log("setInitialData called with:",a),n({regions:a.regions||[],pois:a.pois||[],paths:a.paths||[]})},easeOutCubic:a=>1-Math.pow(1-a,3),setCenter:a=>{n({targetCenter:a});const l=performance.now(),h=b().center,j=Math.sqrt(Math.pow(a.x-h.x,2)+Math.pow(a.y-h.y,2)),i=Math.min(500,Math.max(100,j*.5)),v=()=>{const N=performance.now()-l,P=Math.min(N/i,1),C=b().easeOutCubic(P),T=a.x-h.x,I=a.y-h.y,O={x:h.x+T*C,y:h.y+I*C};n({center:O}),P<1&&requestAnimationFrame(v)};v()},updateCenter:a=>{n({center:a,targetCenter:a})},setZoom:a=>{const l=Math.max(Z.minZoom,Math.min(Z.maxZoom,a));n({targetZoom:l});const h=performance.now(),j=b().zoom,i=Math.abs(l-j),v=Math.min(400,Math.max(100,i*80)),L=()=>{const P=performance.now()-h,C=Math.min(P/v,1),T=b().easeOutCubic(C),I=l-j,O=j+I*T;n({zoom:O}),C<1&&requestAnimationFrame(L)};L()},updateZoom:a=>{const l=Math.max(Z.minZoom,Math.min(Z.maxZoom,a));n({zoom:l,targetZoom:l})},zoomIn:()=>{b().setZoom(b().targetZoom+1)},zoomOut:()=>{b().setZoom(b().targetZoom-1)},startDrag:a=>{n({isDragging:!0,dragStart:a,lastDragPosition:a,dragVelocity:{x:0,y:0}})},drag:a=>{var h,j;const l=b();if(l.isDragging&&l.dragStart){const i=a.x-l.dragStart.x,v=a.y-l.dragStart.y,L=a.x-(((h=l.lastDragPosition)==null?void 0:h.x)||a.x),N=a.y-(((j=l.lastDragPosition)==null?void 0:j.y)||a.y),P={x:l.center.x-i,y:l.center.y-v};n({center:P,targetCenter:P,dragStart:a,lastDragPosition:a,dragVelocity:{x:L,y:N}})}},endDrag:()=>{const l=b().dragVelocity||{x:0,y:0};if(Math.sqrt(l.x*l.x+l.y*l.y)>1){let N=.95;const P=()=>{const C=b(),T=C.dragVelocity||{x:0,y:0},I=Math.sqrt(T.x*T.x+T.y*T.y);if(I<.5){n({isDragging:!1,dragStart:null,dragVelocity:{x:0,y:0}});return}N=Math.max(.85,.95-.05*(I/100));const O=T.x*N,B=T.y*N,S={x:C.center.x-O,y:C.center.y-B};n({center:S,targetCenter:S,dragVelocity:{x:O,y:B}}),requestAnimationFrame(P)};P()}else n({isDragging:!1,dragStart:null,dragVelocity:{x:0,y:0}})},addRegion:a=>{if(!a||!a.id||!a.coordinates||!Array.isArray(a.coordinates)){console.warn("æ— æ•ˆçš„åŒºåŸŸæ•°æ®:",a);return}n(l=>({regions:[...l.regions,a]}))},removeRegion:a=>{n(l=>({regions:l.regions.filter(h=>h.id!==a)}))},clearRegions:()=>{n({regions:[]})},addPOI:a=>{if(!a||!a.id||!a.coordinate){console.warn("æ— æ•ˆçš„POIæ•°æ®:",a);return}n(l=>({pois:[...l.pois,a]}))},removePOI:a=>{n(l=>({pois:l.pois.filter(h=>h.id!==a)}))},clearPOIs:()=>{n({pois:[]})},addPath:a=>{if(!a||!a.id||!a.points||!Array.isArray(a.points)){console.warn("æ— æ•ˆçš„è·¯å¾„æ•°æ®:",a);return}n(l=>({paths:[...l.paths,a]}))},removePath:a=>{n(l=>({paths:l.paths.filter(h=>h.id!==a)}))},clearPaths:()=>{n({paths:[]})},setTheme:a=>n({theme:a}),updateTheme:a=>n({theme:a}),setHoveredPOI:a=>n({hoveredPOIId:a}),screenToWorld:a=>{const l=b(),h=Math.pow(2,l.zoom-1);return{x:l.center.x+(a.x-l.width/2)/h,y:l.center.y+(a.y-l.height/2)/h}},worldToScreen:a=>{const l=b(),h=Math.pow(2,l.zoom-1);return{x:l.width/2+(a.x-l.center.x)*h,y:l.height/2+(a.y-l.center.y)*h}},getViewport:()=>{const a=b(),l=Math.pow(2,a.zoom-1),h=a.width/l,j=a.height/l;return{x:a.center.x-h/2,y:a.center.y-j/2,width:h,height:j}}})),ve=({className:n=""})=>{const b=E.useRef(null),a=E.useRef(null),[l,h]=E.useState(!1),{center:j,zoom:i,theme:v,regions:L,pois:N,paths:P,worldToScreen:C,getViewport:T,setSize:I,hoveredPOIId:O}=K(),B=E.useCallback(()=>{let e=800,d=600;if(a.current){const x=a.current.getBoundingClientRect(),w=window.devicePixelRatio||1;e=x.width||800,d=x.height||600;const r=b.current;if(r){r.width=e*w,r.height=d*w,r.style.width=`${e}px`,r.style.height=`${d}px`;const s=r.getContext("2d");s&&(s.clearRect(0,0,r.width,r.height),s.scale(w,w)),h(!0)}}I(e,d)},[I]);E.useEffect(()=>(B(),window.addEventListener("resize",B),window.addEventListener("orientationchange",B),()=>{window.removeEventListener("resize",B),window.removeEventListener("orientationchange",B)}),[B]);const S=E.useMemo(()=>({viewport:T(),scale:Math.pow(2,i-1)}),[j,i,T]),D=(e,d,p,x,w)=>{try{e.strokeStyle=v.gridColor,e.lineWidth=.5;const s=50*Math.pow(.5,Math.floor(i/2)),c=s*p;e.fillStyle="rgba(255, 255, 255, 0.05)",e.fillRect(0,0,x,w);for(let g=-20;g<21;g++){const m=j.x+g*s,k=C({x:m,y:j.y}).x;e.beginPath(),e.moveTo(k,0),e.lineTo(k,w),e.stroke()}for(let g=-20;g<21;g++){const m=j.y+g*s,k=C({x:j.x,y:m}).y;e.beginPath(),e.moveTo(0,k),e.lineTo(x,k),e.stroke()}}catch(r){console.error("ç»˜åˆ¶ç½‘æ ¼çº¿æ—¶å‡ºé”™:",r)}},U=(e,d,p,x,w)=>{const r=d.filter(s=>{if(s.zoomLevel>p||s.coordinates.length<2)return!1;let c=Number.MAX_VALUE,g=Number.MAX_VALUE,m=Number.MIN_VALUE,k=Number.MIN_VALUE;for(const y of s.coordinates)c=Math.min(c,y.x),g=Math.min(g,y.y),m=Math.max(m,y.x),k=Math.max(k,y.y);return!(m<w.x||c>w.x+w.width||k<w.y||g>w.y+w.height)});r.length!==0&&r.forEach(s=>{try{e.beginPath();const c=x(s.coordinates[0]);if(isNaN(c.x)||isNaN(c.y))return;e.moveTo(c.x,c.y);let g=!0,m=c.x,k=c.x,y=c.y,f=c.y;for(let A=1;A<s.coordinates.length;A++){const M=x(s.coordinates[A]);if(isNaN(M.x)||isNaN(M.y)){g=!1;break}m=Math.min(m,M.x),k=Math.max(k,M.x),y=Math.min(y,M.y),f=Math.max(f,M.y),e.lineTo(M.x,M.y)}if(!g)return;if(e.closePath(),e.fillStyle=s.color,e.globalAlpha=v.regionFillOpacity,e.fill(),e.globalAlpha=1,e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.lineJoin="round",e.lineCap="round",e.stroke(),p>=5){const A=s.coordinates.reduce(($,F)=>$+F.x,0)/s.coordinates.length,M=s.coordinates.reduce(($,F)=>$+F.y,0)/s.coordinates.length,R=x({x:A,y:M});e.fillStyle=v.backgroundColor,e.shadowColor="rgba(0, 0, 0, 0.3)",e.shadowBlur=4,e.font="bold 14px sans-serif",e.textAlign="center",e.textBaseline="middle";const _=e.measureText(s.name).width,o=24,Y=8;e.fillRect(R.x-_/2-Y,R.y-o/2,_+Y*2,o),e.fillStyle=v.textColor,e.shadowBlur=0,e.fillText(s.name,R.x,R.y)}}catch(c){console.warn("ç»˜åˆ¶åŒºåŸŸæ—¶å‡ºé”™:",c,"åŒºåŸŸ:",s.id)}})},H=(e,d,p,x,w,r)=>{const s=d.filter(y=>{const f=y.coordinate;return f.x>=r.x-100&&f.x<=r.x+r.width+100&&f.y>=r.y-100&&f.y<=r.y+r.height+100});if(s.length===0)return;const c=i<7,g=Math.max(20,60-(i-1)*5),m=v.poiIconSize,k=Math.max(m,m*(1+(i-1)*.2));if(c){const y={};s.forEach(f=>{const A=Math.floor(f.coordinate.x/g),M=Math.floor(f.coordinate.y/g),R=`${A},${M}`;y[R]||(y[R]=[]),y[R].push(f)}),Object.values(y).forEach(f=>{try{const A=f.reduce((u,G)=>u+(G.importance||1),0),M=f.reduce((u,G)=>u+G.coordinate.x*(G.importance||1),0)/A,R=f.reduce((u,G)=>u+G.coordinate.y*(G.importance||1),0)/A,o=w({x:M,y:R});if(isNaN(o.x)||isNaN(o.y)||o.x<-100||o.x>p+100||o.y<-100||o.y>x+100)return;const Y=f.length,$=Math.max(m*1.5,m+Math.min(Y*.8,30));e.save(),e.shadowColor="rgba(0, 0, 0, 0.4)",e.shadowBlur=12,e.shadowOffsetX=0,e.shadowOffsetY=4;const F={};f.forEach(u=>{F[u.category]=(F[u.category]||0)+1});const X=Object.keys(F).reduce((u,G)=>F[u]>F[G]?u:G),oe={food:"#ef4444",retail:"#3b82f6",craft:"#8b5cf6",landmark:"#f59e0b",culture:"#10b981",default:"#6b7280"},q=oe[X]||oe.default,ae=e.createRadialGradient(o.x,o.y,0,o.x,o.y,$);ae.addColorStop(0,q),ae.addColorStop(1,q+"99"),e.fillStyle=ae,e.beginPath(),e.arc(o.x,o.y,$,0,Math.PI*2),e.fill(),e.strokeStyle="#ffffff",e.lineWidth=3,e.stroke();const ne=e.createRadialGradient(o.x,o.y,0,o.x,o.y,$*.6);if(ne.addColorStop(0,"rgba(255, 255, 255, 0.8)"),ne.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=ne,e.beginPath(),e.arc(o.x,o.y,$*.6,0,Math.PI*2),e.fill(),e.restore(),e.fillStyle="#ffffff",e.font=`bold ${Math.min($*.6,18)}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(Y.toString(),o.x,o.y),Y>1){e.save(),e.translate(o.x+$*.6,o.y-$*.6),e.scale(.5,.5),e.fillStyle="#ffffff",e.beginPath();const u=k*.8;e.fillStyle=q,e.beginPath(),e.arc(0,0,u,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.beginPath(),X==="food"?(e.arc(0,0,u*.7,0,Math.PI*2),e.fill(),e.fillStyle=q,e.fillRect(-u*.2,-u*.6,u*.4,u*1.2)):X==="retail"?(e.arc(0,0,u,0,Math.PI,!0),e.lineTo(-u,-u),e.lineTo(u,-u),e.closePath(),e.fill()):X==="craft"?(e.moveTo(-u,-u),e.lineTo(u,u),e.lineTo(u-u*.3,u),e.lineTo(-u+u*.3,-u),e.closePath(),e.fill()):X==="landmark"?(e.fillRect(-u,-u,u*2,u*2),e.fill(),e.fillStyle=q,e.fillRect(-u*.5,-u,u,u*2)):X==="culture"?(e.fillRect(-u,-u,u*2,u*1.8),e.fill(),e.fillStyle=q,e.fillRect(-u,-u*.3,u*2,u*.15)):(e.arc(0,0,u*.5,0,Math.PI*2),e.fill()),e.restore()}e.save(),e.globalAlpha=.3,e.fillStyle=q,e.beginPath(),e.arc(o.x,o.y,$*1.2,0,Math.PI*2),e.fill(),e.restore()}catch(A){console.warn("ç»˜åˆ¶èšç±»æ—¶å‡ºé”™:",A)}})}else s.forEach(y=>{try{const f=w(y.coordinate);if(isNaN(f.x)||isNaN(f.y)||f.x<-100||f.x>p+100||f.y<-100||f.y>x+100)return;const A=y.color||"#3b82f6",M=y.id===O,R=M?k*1.3:k;e.save(),e.shadowColor="rgba(0, 0, 0, 0.4)",e.shadowBlur=M?12:8,e.shadowOffsetX=0,e.shadowOffsetY=4;const _=e.createRadialGradient(f.x,f.y,0,f.x,f.y,R);_.addColorStop(0,A),_.addColorStop(1,A+"cc"),e.fillStyle=_,e.beginPath(),e.arc(f.x,f.y,R,0,Math.PI*2),e.fill(),e.strokeStyle="#ffffff",e.lineWidth=M?4:3,e.stroke(),e.restore(),e.fillStyle="#ffffff",e.save(),e.translate(f.x,f.y);const o=R*.7;if(e.beginPath(),y.category==="food"?(e.arc(0,0,o*.6,0,Math.PI*2),e.fill(),e.fillStyle=A,e.fillRect(-o*.2,-o*.8,o*.4,o*1.6),e.fillRect(-o*.6,-o*.2,o*1.2,o*.4)):y.category==="retail"?(e.moveTo(-o,-o),e.lineTo(-o,o*.8),e.arcTo(-o,o,0,o,o),e.arcTo(o,o,o,o*.8,o),e.lineTo(o,-o),e.lineTo(0,-o*1.5),e.closePath(),e.fill()):y.category==="craft"?(e.moveTo(-o*.3,-o),e.lineTo(o*.3,-o*.3),e.lineTo(o,0),e.lineTo(o*.3,o*.3),e.lineTo(-o*.3,o),e.lineTo(-o,0),e.closePath(),e.fill(),e.beginPath(),e.moveTo(o,0),e.lineTo(o*1.2,-o*.3),e.lineTo(o*1.2,o*.3),e.closePath(),e.fill()):y.category==="landmark"?(e.fillRect(-o,-o,o*2,o*2),e.beginPath(),e.moveTo(-o*1.2,-o),e.lineTo(0,-o*1.5),e.lineTo(o*1.2,-o),e.closePath(),e.fill(),e.fillRect(-o*.25,o*.3,o*.5,o*.7)):y.category==="culture"?(e.fillRect(-o,-o*.6,o*2,o*1.2),e.fillStyle=A,e.fillRect(-o*1.1,-o*.7,o*.2,o*1.4),e.fillStyle="#ffffff",e.fillRect(-o*.8,-o*.2,o*1.6,o*.1)):(e.arc(0,0,o*.8,0,Math.PI*2),e.fill(),e.fillStyle=A,e.arc(0,0,o*.3,0,Math.PI*2),e.fill()),e.restore(),M){e.fillStyle=v.backgroundColor,e.shadowColor="rgba(0, 0, 0, 0.3)",e.shadowBlur=8,e.shadowOffsetX=0,e.shadowOffsetY=2;const Y=y.name||"";e.font="bold 14px sans-serif";const $=e.measureText(Y).width,F=10,X=24;if(e.fillRect(f.x-$/2-F,f.y+R+10,$+F*2,X),e.fillStyle=v.textColor,e.textAlign="center",e.shadowBlur=0,e.fillText(Y,f.x,f.y+R+X/2+10),y.description){const oe=y.description.length>30?y.description.substring(0,30)+"...":y.description;e.font="12px sans-serif";const q=e.measureText(oe).width,ae=20;e.fillStyle=v.backgroundColor,e.shadowBlur=8,e.fillRect(f.x-q/2-F,f.y+R+X+14,q+F*2,ae),e.fillStyle=v.textColor,e.shadowBlur=0,e.fillText(oe,f.x,f.y+R+X+ae/2+14)}}else if(i>=6){e.fillStyle=v.backgroundColor,e.shadowColor="rgba(0, 0, 0, 0.3)",e.shadowBlur=6,e.shadowOffsetX=0,e.shadowOffsetY=2;const Y=y.name||"";e.font="bold 13px sans-serif";const $=e.measureText(Y).width,F=8,X=22;e.fillRect(f.x-$/2-F,f.y+R+8,$+F*2,X),e.fillStyle=v.textColor,e.textAlign="center",e.shadowBlur=0,e.fillText(Y,f.x,f.y+R+X/2+8)}}catch(f){console.warn("ç»˜åˆ¶POIæ—¶å‡ºé”™:",f,"POI:",y.id)}})},V=(e,d,p,x)=>{const w=d.filter(r=>{if(r.points.length<2)return!1;let s=Number.MAX_VALUE,c=Number.MAX_VALUE,g=Number.MIN_VALUE,m=Number.MIN_VALUE;for(const k of r.points){const y=k.coordinate;s=Math.min(s,y.x),c=Math.min(c,y.y),g=Math.max(g,y.x),m=Math.max(m,y.y)}return!(g<x.x||s>x.x+x.width||m<x.y||c>x.y+x.height)});w.length!==0&&w.forEach(r=>{try{e.beginPath();const s=p(r.points[0].coordinate);if(isNaN(s.x)||isNaN(s.y))return;e.moveTo(s.x,s.y);let c=!0;for(let g=1;g<r.points.length;g++){const m=p(r.points[g].coordinate);if(isNaN(m.x)||isNaN(m.y)){c=!1;break}e.lineTo(m.x,m.y)}if(!c)return;e.strokeStyle=r.color||"#3b82f6",e.lineWidth=r.width||3,e.lineCap="round",e.lineJoin="round",e.stroke(),i>=6&&r.points.forEach(g=>{try{if(g.isWaypoint){const m=p(g.coordinate);if(isNaN(m.x)||isNaN(m.y))return;e.fillStyle="#ffffff",e.beginPath(),e.arc(m.x,m.y,(r.width||3)+4,0,Math.PI*2),e.fill(),e.fillStyle=r.color||"#3b82f6",e.beginPath(),e.arc(m.x,m.y,(r.width||3)+2,0,Math.PI*2),e.fill()}}catch(m){console.warn("ç»˜åˆ¶è·¯å¾„ç‚¹æ—¶å‡ºé”™:",m)}})}catch(s){console.warn("ç»˜åˆ¶è·¯å¾„æ—¶å‡ºé”™:",s,"è·¯å¾„:",r.id)}})},[ee,Q]=E.useState({renderTime:0,fps:60,poiCount:0,regionCount:0,pathCount:0,visiblePoiCount:0}),re=E.useRef({frameCount:0,lastTime:performance.now(),currentFps:60}),te=E.useCallback((e,d)=>{const p=performance.now();try{e.fillStyle=v.backgroundColor,e.fillRect(0,0,d.width,d.height),i<=6&&D(e,S.viewport,S.scale,d.width,d.height),U(e,L,i,C,S.viewport),V(e,P,C,S.viewport),H(e,N,d.width,d.height,C,S.viewport);const w=performance.now()-p,r=re.current;r.frameCount++;const s=performance.now();s-r.lastTime>=1e3&&(r.currentFps=Math.round(r.frameCount*1e3/(s-r.lastTime)),r.frameCount=0,r.lastTime=s),Q(c=>({...c,renderTime:parseFloat(w.toFixed(2)),fps:r.currentFps,poiCount:N.length,regionCount:L.length,pathCount:P.length,visiblePoiCount:N.filter(g=>{const m=g.coordinate;return m.x>=S.viewport.x-100&&m.x<=S.viewport.x+S.viewport.width+100&&m.y>=S.viewport.y-100&&m.y<=S.viewport.y+S.viewport.height+100}).length}))}catch(x){console.error("åœ°å›¾ç»˜åˆ¶é”™è¯¯:",x)}},[v,L,i,P,N,C,S,O]),W=E.useRef({animationFrameId:0,lastRenderTime:0,pendingRender:!1,shouldRender:!1});return E.useEffect(()=>{W.current.shouldRender=!0},[j,i,v,L,P,N,O,S]),E.useEffect(()=>{if(!l)return;const e=16,d=b.current;if(!d)return;const p=d.getContext("2d");if(!p)return;const x=r=>{const s=W.current;if(r-s.lastRenderTime<e){s.shouldRender&&(s.animationFrameId=requestAnimationFrame(x));return}if(s.shouldRender)try{te(p,d),s.lastRenderTime=r,s.shouldRender=!1}catch(c){console.error("åœ°å›¾æ¸²æŸ“é”™è¯¯:",c)}s.shouldRender&&(s.animationFrameId=requestAnimationFrame(x))};W.current.animationFrameId=requestAnimationFrame(x);const w=()=>{W.current.shouldRender=!0,requestAnimationFrame(x)};return window.addEventListener("resize",w),()=>{cancelAnimationFrame(W.current.animationFrameId),window.removeEventListener("resize",w)}},[l,te,j,i,v,L,P,N,O,S]),t.jsx("div",{ref:a,className:`${n} relative w-full h-full`,children:t.jsx("canvas",{ref:b,className:"w-full h-full",style:{display:"block",cursor:"grab",userSelect:"none"}})})},Ce=({children:n,onPOIClick:b,onMapClick:a})=>{const{isDragging:l,startDrag:h,drag:j,endDrag:i,zoomIn:v,zoomOut:L,setZoom:N,screenToWorld:P,worldToScreen:C,pois:T,setHoveredPOI:I}=K(),[O,B]=E.useState(null),[S,D]=E.useState(null),U=r=>{if(r.button!==0)return;const s={x:r.clientX,y:r.clientY};h(s)},H=r=>{try{const c=K.getState(),g=c.zoom;if(g===void 0)return null;const m=Math.min(40,25+(g-1)*2),k=m*m,y=c.getViewport();if(!y)return null;const f=T.filter(A=>{const M=A.coordinate;return M.x>=y.x-m&&M.x<=y.x+y.width+m&&M.y>=y.y-m&&M.y<=y.y+y.height+m});for(const A of f){const M=C(A.coordinate),R=r.x-M.x,_=r.y-M.y;if(R*R+_*_<=k)return A}}catch(s){console.error("æ£€æŸ¥POIäº¤äº’æ—¶å‡ºé”™:",s)}return null},V=(r,s)=>{let c;return function(...m){const k=()=>{clearTimeout(c),r(...m)};clearTimeout(c),c=setTimeout(k,s)}},ee=se.useCallback(V(r=>{const s=H(r);I(s?s.id:null)},30),[H,I]),Q=r=>{const s={x:r.clientX,y:r.clientY};j(s);try{const g=r.currentTarget.getBoundingClientRect(),m=r.clientX-g.left,k=r.clientY-g.top;ee({x:m,y:k})}catch(c){console.error("å¤„ç†é¼ æ ‡æ‚¬åœäº‹ä»¶æ—¶å‡ºé”™:",c)}},re=()=>{i()},te=()=>{i(),I(null)},W=r=>{r.preventDefault();const s=.15,c=r.deltaY>0?-s:s,g=K.getState().zoom;if(g===void 0)return;const m=g+c;N(m)},e=r=>{try{const c=r.currentTarget.getBoundingClientRect(),g=r.clientX-c.left,m=r.clientY-c.top,k={x:g,y:m},y=P(k),f=H(k);if(f&&b){console.log("ç‚¹å‡»äº†POI:",f.id,f.name),b(f.id);return}a&&a(y)}catch(s){console.error("å¤„ç†åœ°å›¾ç‚¹å‡»äº‹ä»¶æ—¶å‡ºé”™:",s)}},d=r=>{if(r.preventDefault(),r.touches.length===1){const s=r.touches[0],c={x:s.clientX,y:s.clientY};B(c),h(c)}else if(r.touches.length===2){const s=r.touches[0],c=r.touches[1],g=Math.sqrt(Math.pow(c.clientX-s.clientX,2)+Math.pow(c.clientY-s.clientY,2));D(g)}},p=r=>{if(r.preventDefault(),r.touches.length===1){if(!O)return;const s=r.touches[0],c={x:s.clientX,y:s.clientY};j(c),B(c)}else if(r.touches.length===2){const s=r.touches[0],c=r.touches[1],g=Math.sqrt(Math.pow(c.clientX-s.clientX,2)+Math.pow(c.clientY-s.clientY,2));if(S){const m=g/S,k=K.getState().zoom,y=(m-1)*.5,f=k+y;N(f)}D(g)}},x=r=>{r.preventDefault(),B(null),D(null),i()},w=()=>{B(null),D(null),i()};return t.jsx("div",{style:{width:"100%",height:"100%",position:"relative",overflow:"hidden",cursor:l?"grabbing":"grab",touchAction:"none",background:"transparent"},onMouseDown:U,onMouseMove:Q,onMouseUp:re,onMouseLeave:te,onWheel:W,onClick:e,onContextMenu:r=>r.preventDefault(),onTouchStart:d,onTouchMove:p,onTouchEnd:x,onTouchCancel:w,children:n})},Ee=({className:n=""})=>{const{zoom:b,zoomIn:a,zoomOut:l,center:h,updateCenter:j,themes:i,setTheme:v,width:L,getViewport:N}=K(),P=Z.minZoom,C=Z.maxZoom;N();const O=1/Math.pow(2,b-1)/100,B=()=>{try{const D=K.getState().theme;if(!i||!D)return;const H=(i.findIndex(V=>V.name===D.name)+1)%i.length;v(i[H])}catch(D){console.error("åˆ‡æ¢ä¸»é¢˜æ—¶å‡ºé”™:",D)}},S=()=>{j({x:500,y:500})};return t.jsxs("div",{className:`absolute top-4 right-4 z-10 flex flex-col gap-2 ${n}`,children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[t.jsx("button",{className:"w-10 h-10 flex items-center justify-center text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-lg transition-colors",onClick:a,disabled:b>=C,"aria-label":"æ”¾å¤§åœ°å›¾",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),t.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700"}),t.jsx("div",{className:"w-10 h-10 flex items-center justify-center text-gray-600 dark:text-gray-400 text-sm font-medium",children:b}),t.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700"}),t.jsx("button",{className:"w-10 h-10 flex items-center justify-center text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-lg transition-colors",onClick:l,disabled:b<=P,"aria-label":"ç¼©å°åœ°å›¾",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})})]}),t.jsx("button",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 w-10 h-10 flex items-center justify-center text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:B,"aria-label":"åˆ‡æ¢åœ°å›¾ä¸»é¢˜",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})})}),t.jsx("button",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 w-10 h-10 flex items-center justify-center text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:S,"aria-label":"é‡ç½®åœ°å›¾è§†å›¾",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.33 5.88 3 6.27 3 6.695V18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z"})})}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 px-3 py-2 flex items-center gap-2",children:[t.jsx("div",{className:"h-4 border-r border-gray-300 dark:border-gray-600 w-1"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-12 h-1 bg-blue-500"}),t.jsx("div",{className:"w-6 h-1 border border-gray-300 dark:border-gray-600 bg-transparent"})]}),t.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 whitespace-nowrap",children:[(O*18).toFixed(1)," km"]})]})]})},je=({width:n,height:b,config:a={},initialRegions:l=[],initialPOIs:h=[],initialPaths:j=[],onPOIClick:i,onMapClick:v,className:L="",style:N})=>{const P=E.useRef(null),{setSize:C,setInitialData:T,updateZoom:I,updateCenter:O,updateTheme:B}=K();E.useEffect(()=>{try{console.log("VirtualMap: åˆå§‹åŒ–åœ°å›¾æ•°æ®",{regionsCount:l.length,poisCount:h.length,pathsCount:j.length}),T({regions:l,pois:h,paths:j})}catch(H){console.error("åˆå§‹åŒ–åœ°å›¾æ•°æ®æ—¶å‡ºé”™:",H)}},[l,h,j,T]);const S=()=>{if(!P.current)return;const V=P.current.getBoundingClientRect(),ee=V.width||800,Q=V.height||600;C(ee,Q)};E.useEffect(()=>(S(),window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S)}),[C]),E.useEffect(()=>{S()},[n,b,C]);const D=H=>{i&&i(H)},U=H=>{v&&v(H)};return t.jsxs("div",{ref:P,className:`relative w-full h-full ${L} overflow-hidden`,style:N,children:[t.jsx(Ce,{onPOIClick:D,onMapClick:U,children:t.jsx(ve,{className:"w-full h-full"})}),t.jsx(Ee,{})]})},ce={food:"ðŸœ",retail:"ðŸª",craft:"ðŸŽ¨",landmark:"ðŸ°",culture:"ðŸ“š"},me={food:"bg-yellow-500",retail:"bg-blue-500",craft:"bg-purple-500",landmark:"bg-red-500",culture:"bg-green-500"},z={1:[117.1881,39.1252],2:[117.2315,39.0923],3:[117.1598,39.1445],4:[117.1955,39.1278],5:[117.0538,39.1402],6:[117.1995,39.1408],7:[117.1468,39.1425],8:[117.2293,39.0948]},ie={categories:{food:{name:"é¤é¥®ç¾Žé£Ÿ",icon:"ðŸœ",color:"bg-yellow-500"},retail:{name:"é›¶å”®ç™¾è´§",icon:"ðŸª",color:"bg-blue-500"},craft:{name:"æ‰‹å·¥è‰º",icon:"ðŸŽ¨",color:"bg-purple-500"},landmark:{name:"åœ°æ ‡å»ºç­‘",icon:"ðŸ°",color:"bg-red-500"},culture:{name:"æ–‡åŒ–è‰ºæœ¯",icon:"ðŸ“š",color:"bg-green-500"}},poi:[{id:1,name:"ç‹—ä¸ç†åŒ…å­",category:"food",description:"å¤©æ´¥è‘—åçš„ä¼ ç»Ÿå°åƒï¼Œä»¥çš®è–„é¦…å¤§ã€é²œé¦™å¯å£è‘—ç§°ï¼Œæœ‰ç€æ‚ ä¹…çš„åŽ†å²å’Œæ–‡åŒ–åº•è•´ã€‚ç‹—ä¸ç†åŒ…å­çš„åˆ¶ä½œæŠ€è‰ºè¢«åˆ—å…¥å›½å®¶çº§éžç‰©è´¨æ–‡åŒ–é—äº§åå½•ã€‚",address:"å¤©æ´¥å¸‚å’Œå¹³åŒºå±±ä¸œè·¯77å·",position:{x:45,y:55,lng:z[1][0],lat:z[1][1]},year:1858,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eç‹—ä¸ç†åŒ…å­%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eå¤©æ´¥ä¸‰ç»ä¹‹ä¸€%3C/text%3E%3C/svg%3E","data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eç‹—ä¸ç†åŒ…å­%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eä¼ ç»Ÿå°åƒ%3C/text%3E%3C/svg%3E","data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eç‹—ä¸ç†åŒ…å­%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eç™¾å¹´è€åº—%3C/text%3E%3C/svg%3E"],openingHours:"08:00-22:00",phone:"022-27306590",importance:5,tags:["å¤©æ´¥ä¸‰ç»","ä¼ ç»Ÿå°åƒ","ç™¾å¹´è€åº—"],featuredProducts:["çŒªè‚‰åŒ…å­","ä¸‰é²œåŒ…å­","èŸ¹é»„åŒ…å­","é‡ŽèœåŒ…å­"],honors:["å›½å®¶çº§éžç‰©è´¨æ–‡åŒ–é—äº§","ä¸­åŽè€å­—å·","å¤©æ´¥åå°åƒ"],historicalSignificance:"ç‹—ä¸ç†åŒ…å­å§‹åˆ›äºŽ1858å¹´ï¼Œç”±é«˜è´µå‹åˆ›ç«‹ï¼Œæ˜¯å¤©æ´¥ä¼ ç»Ÿé¥®é£Ÿæ–‡åŒ–çš„é‡è¦ä»£è¡¨ï¼Œè§è¯äº†å¤©æ´¥è¿‘ä»£å•†ä¸šçš„å‘å±•åŽ†ç¨‹ã€‚",culturalHeritageLevel:"å›½å®¶çº§",relatedPois:[2,3]},{id:2,name:"åå…«è¡—éº»èŠ±",category:"food",description:"å¤©æ´¥ä¼ ç»Ÿåç‚¹ï¼Œä»¥é…¥è„†é¦™ç”œã€ä¹…æ”¾ä¸ç»µè€Œé—»åï¼Œæ˜¯å¤©æ´¥ä¸‰ç»ä¹‹ä¸€ã€‚",address:"å¤©æ´¥å¸‚æ²³è¥¿åŒºå¤§æ²½å—è·¯566å·",position:{x:50,y:60,lng:z[2][0],lat:z[2][1]},year:1912,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eåå…«è¡—éº»èŠ±%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eå¤©æ´¥ä¸‰ç»ä¹‹ä¸€%3C/text%3E%3C/svg%3E","data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eåå…«è¡—éº»èŠ±%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eä¼ ç»Ÿåç‚¹%3C/text%3E%3C/svg%3E"],openingHours:"09:00-21:00",phone:"022-28326900",importance:4,tags:["å¤©æ´¥ä¸‰ç»","ä¼ ç»Ÿåç‚¹","ç™¾å¹´è€åº—"],relatedPois:[1,3]},{id:3,name:"è€³æœµçœ¼ç‚¸ç³•",category:"food",description:"å¤©æ´¥ä¼ ç»Ÿé£Žå‘³å°åƒï¼Œä»¥çš®é…¥è„†ã€é¦…é¦™ç”œã€ä¸è…»å£è€Œè‘—ç§°ï¼Œæ˜¯å¤©æ´¥ä¸‰ç»ä¹‹ä¸€ã€‚",address:"å¤©æ´¥å¸‚çº¢æ¡¥åŒºåŒ—é—¨å¤–å¤§è¡—12å·",position:{x:48,y:52,lng:z[3][0],lat:z[3][1]},year:1900,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eè€³æœµçœ¼ç‚¸ç³•%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eå¤©æ´¥ä¸‰ç»ä¹‹ä¸€%3C/text%3E%3C/svg%3E","data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eè€³æœµçœ¼ç‚¸ç³•%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eä¼ ç»Ÿå°åƒ%3C/text%3E%3C/svg%3E"],openingHours:"08:30-20:30",phone:"022-27275033",importance:4,tags:["å¤©æ´¥ä¸‰ç»","ä¼ ç»Ÿå°åƒ","ç™¾å¹´è€åº—"],relatedPois:[1,2]},{id:4,name:"åŠä¸šåœº",category:"retail",description:"å¤©æ´¥è‘—åçš„ç™¾å¹´è€å•†åœºï¼Œæ˜¯å¤©æ´¥å•†ä¸šçš„æ ‡å¿—æ€§å»ºç­‘ï¼Œèžåˆäº†å¤šç§å»ºç­‘é£Žæ ¼ã€‚",address:"å¤©æ´¥å¸‚å’Œå¹³åŒºå’Œå¹³è·¯290å·",position:{x:47,y:56,lng:z[4][0],lat:z[4][1]},year:1928,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3EåŠä¸šåœº%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eç™¾å¹´è€åº—%3C/text%3E%3C/svg%3E","data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3EåŠä¸šåœº%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eå•†ä¸šåœ°æ ‡%3C/text%3E%3C/svg%3E"],openingHours:"10:00-22:00",phone:"022-27211818",importance:5,tags:["ç™¾å¹´è€åº—","å•†ä¸šåœ°æ ‡","åŽ†å²å»ºç­‘"],relatedPois:[7]},{id:5,name:"æ¨æŸ³é’å¹´ç”»",category:"craft",description:"ä¸­å›½å››å¤§æœ¨ç‰ˆå¹´ç”»ä¹‹ä¸€ï¼Œä»¥è‰²å½©è‰³ä¸½ã€é¢˜æä¸°å¯Œã€æž„å›¾é¥±æ»¡è€Œè‘—ç§°ï¼Œå…·æœ‰æµ“éƒçš„æ°‘é—´è‰ºæœ¯ç‰¹è‰²ã€‚",address:"å¤©æ´¥å¸‚è¥¿é’åŒºæ¨æŸ³é’é•‡ä¼°è¡£è¡—23å·",position:{x:42,y:48,lng:z[5][0],lat:z[5][1]},year:1600,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eæ¨æŸ³é’å¹´ç”»%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eæ°‘é—´è‰ºæœ¯%3C/text%3E%3C/svg%3E","data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eæ¨æŸ³é’å¹´ç”»%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eå›½å®¶çº§éžé—%3C/text%3E%3C/svg%3E"],openingHours:"09:00-17:00",phone:"022-27940617",importance:5,tags:["æ°‘é—´è‰ºæœ¯","å›½å®¶çº§éžé—","ä¼ ç»Ÿå·¥è‰º"],relatedPois:[6]},{id:6,name:"æ³¥äººå¼ å½©å¡‘",category:"craft",description:"å¤©æ´¥ä¼ ç»Ÿæ°‘é—´è‰ºæœ¯ï¼Œä»¥å½¢ç¥žå…¼å¤‡ã€è‰²å½©é²œæ˜Žã€åšå·¥ç²¾ç»†è€Œé—»åï¼Œæ˜¯ä¸­å›½æ³¥å¡‘è‰ºæœ¯çš„ä»£è¡¨ã€‚",address:"å¤©æ´¥å¸‚å—å¼€åŒºå¤æ–‡åŒ–è¡—å®«åŒ—å¤§è¡—é€šåº†é‡Œ4å·",position:{x:46,y:54,lng:z[6][0],lat:z[6][1]},year:1844,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eæ³¥äººå¼ å½©å¡‘%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eæ°‘é—´è‰ºæœ¯%3C/text%3E%3C/svg%3E","data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eæ³¥äººå¼ å½©å¡‘%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eä¼ ç»Ÿå·¥è‰º%3C/text%3E%3C/svg%3E"],openingHours:"09:00-18:00",phone:"022-27353157",importance:5,tags:["æ°‘é—´è‰ºæœ¯","å›½å®¶çº§éžé—","ä¼ ç»Ÿå·¥è‰º"],relatedPois:[5]},{id:7,name:"å¤©æ´¥ä¹‹çœ¼",category:"landmark",description:"ä¸–ç•Œä¸Šå”¯ä¸€å»ºåœ¨æ¡¥ä¸Šçš„æ‘©å¤©è½®ï¼Œæ˜¯å¤©æ´¥çš„æ ‡å¿—æ€§å»ºç­‘ä¹‹ä¸€ï¼Œä¿¯çž°å¤©æ´¥å¸‚åŒºå…¨æ™¯ã€‚",address:"å¤©æ´¥å¸‚çº¢æ¡¥åŒºæŽå…¬ç¥ å¤§è¡—ä¸Žäº”é©¬è·¯äº¤å£",position:{x:44,y:50,lng:z[7][0],lat:z[7][1]},year:2008,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eå¤©æ´¥ä¹‹çœ¼%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3EçŽ°ä»£åœ°æ ‡%3C/text%3E%3C/svg%3E","data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eå¤©æ´¥ä¹‹çœ¼%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eæ—…æ¸¸æ™¯ç‚¹%3C/text%3E%3C/svg%3E"],openingHours:"09:30-21:30",phone:"022-26288830",importance:5,tags:["çŽ°ä»£åœ°æ ‡","æ—…æ¸¸æ™¯ç‚¹","åŸŽå¸‚åç‰‡"],relatedPois:[4]},{id:8,name:"å¤©æ´¥å¤§å‰§é™¢",category:"culture",description:"çŽ°ä»£åŒ–çš„å¤§åž‹ç»¼åˆå‰§åœºï¼Œæ˜¯å¤©æ´¥æ–‡åŒ–è‰ºæœ¯çš„é‡è¦é˜µåœ°ï¼Œä¸¾åŠžå„ç±»é«˜æ°´å¹³æ¼”å‡ºã€‚",address:"å¤©æ´¥å¸‚æ²³è¥¿åŒºå¹³æ±Ÿé“58å·",position:{x:49,y:58,lng:z[8][0],lat:z[8][1]},year:2012,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eå¤©æ´¥å¤§å‰§é™¢%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eæ–‡åŒ–è®¾æ–½%3C/text%3E%3C/svg%3E","data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eå¤©æ´¥å¤§å‰§é™¢%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eè‰ºæœ¯æ®¿å ‚%3C/text%3E%3C/svg%3E"],openingHours:"æ ¹æ®æ¼”å‡ºæ—¶é—´è€Œå®š",phone:"022-83882000",importance:4,tags:["çŽ°ä»£å»ºç­‘","æ–‡åŒ–è®¾æ–½","è‰ºæœ¯æ®¿å ‚"],featuredProducts:["æ­Œå‰§æ¼”å‡º","éŸ³ä¹ä¼š","è¯å‰§","èˆžè¹ˆè¡¨æ¼”"],honors:["å›½å®¶å¤§å‰§é™¢è”ç›Ÿæˆå‘˜","å¤©æ´¥å¸‚æ–‡åŒ–åœ°æ ‡"],culturalHeritageLevel:"å¸‚çº§",relatedPois:[7]},{id:9,name:"è€ç¾ŽåŽ",category:"retail",description:"å¤©æ´¥è‘—åçš„éž‹åº—ï¼Œä»¥åˆ¶ä½œä¼ ç»Ÿå¸ƒéž‹è€Œé—»åï¼Œæœ‰ç€ç™¾å¹´åŽ†å²ï¼Œæ˜¯å¤©æ´¥ä¼ ç»Ÿå•†ä¸šçš„ä»£è¡¨ã€‚",address:"å¤©æ´¥å¸‚å’Œå¹³åŒºå’Œå¹³è·¯290å·åŠä¸šåœºåº•å•†",position:{x:46,y:55,lng:z[1][0]+.01,lat:z[1][1]+.01},year:1911,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eè€ç¾ŽåŽ%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eç™¾å¹´éž‹åº—%3C/text%3E%3C/svg%3E"],openingHours:"09:30-21:00",phone:"022-27211587",importance:5,tags:["ç™¾å¹´è€åº—","ä¼ ç»Ÿå¸ƒéž‹","ä¸­åŽè€å­—å·"],featuredProducts:["ä¼ ç»Ÿå¸ƒéž‹","æ‰‹å·¥çš®éž‹","ä¸­è€å¹´éž‹","ç¤¼å“éž‹"],honors:["ä¸­åŽè€å­—å·","å›½å®¶çº§éžç‰©è´¨æ–‡åŒ–é—äº§","å¤©æ´¥åç‰Œäº§å“"],historicalSignificance:"è€ç¾ŽåŽå§‹åˆ›äºŽ1911å¹´ï¼Œç”±åºžé¹¤å¹´åˆ›ç«‹ï¼Œæ˜¯å¤©æ´¥ä¼ ç»Ÿå•†ä¸šçš„ä»£è¡¨ï¼Œè§è¯äº†å¤©æ´¥è¿‘ä»£å•†ä¸šçš„å‘å±•åŽ†ç¨‹ã€‚",culturalHeritageLevel:"å›½å®¶çº§",relatedPois:[4]},{id:10,name:"æžœä»å¼ ",category:"food",description:"å¤©æ´¥è‘—åçš„ä¼ ç»Ÿå°åƒï¼Œä»¥åˆ¶ä½œå„ç§é£Žå‘³æžœä»è€Œé—»åï¼Œæœ‰ç€æ‚ ä¹…çš„åŽ†å²å’Œç‹¬ç‰¹çš„åˆ¶ä½œå·¥è‰ºã€‚",address:"å¤©æ´¥å¸‚å—å¼€åŒºå¤æ–‡åŒ–è¡—å®«åŒ—å¤§è¡—10å·",position:{x:45,y:52,lng:z[3][0]+.01,lat:z[3][1]+.01},year:1830,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eæžœä»å¼ %3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eä¼ ç»Ÿå°åƒ%3C/text%3E%3C/svg%3E"],openingHours:"09:00-19:00",phone:"022-27355368",importance:4,tags:["å¤©æ´¥åå°åƒ","ä¼ ç»Ÿé£Ÿå“","ç™¾å¹´è€åº—"],featuredProducts:["äº”é¦™æžœä»","ç¥ç€æ¡ƒä»","éº»è¾£èŠ±ç”Ÿ","æ€ªå‘³è±†"],honors:["ä¸­åŽè€å­—å·","å¤©æ´¥åå°åƒ","å›½å®¶çº§éžç‰©è´¨æ–‡åŒ–é—äº§"],historicalSignificance:"æžœä»å¼ å§‹åˆ›äºŽ1830å¹´ï¼Œç”±å¼ æƒ å±±åˆ›ç«‹ï¼Œæ˜¯å¤©æ´¥ä¼ ç»Ÿå°åƒçš„ä»£è¡¨ï¼Œåˆ¶ä½œæŠ€è‰ºç‹¬ç‰¹ï¼Œé£Žå‘³å„å¼‚ã€‚",culturalHeritageLevel:"å›½å®¶çº§",relatedPois:[5,6]},{id:11,name:"å¤©æ´¥å¤æ–‡åŒ–è¡—",category:"landmark",description:"å¤©æ´¥è‘—åçš„æ–‡åŒ–æ—…æ¸¸æ™¯ç‚¹ï¼Œé›†ä¼ ç»Ÿå•†ä¸šã€æ–‡åŒ–å±•ç¤ºã€æ—…æ¸¸è§‚å…‰äºŽä¸€ä½“ï¼Œæ˜¯å¤©æ´¥ä¼ ç»Ÿæ–‡åŒ–çš„é‡è¦è½½ä½“ã€‚",address:"å¤©æ´¥å¸‚å—å¼€åŒºä¸œé—¨å¤–å¤§è¡—å®«åŒ—å¤§è¡—",position:{x:45,y:53,lng:z[3][0],lat:z[3][1]},year:1985,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eå¤©æ´¥å¤æ–‡åŒ–è¡—%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eæ–‡åŒ–æ—…æ¸¸æ™¯ç‚¹%3C/text%3E%3C/svg%3E"],openingHours:"09:00-21:00",phone:"022-27356433",importance:5,tags:["æ–‡åŒ–æ—…æ¸¸","ä¼ ç»Ÿå•†ä¸š","å¤©æ´¥åœ°æ ‡"],featuredProducts:["æ¨æŸ³é’å¹´ç”»","æ³¥äººå¼ å½©å¡‘","é£Žç­é­é£Žç­","å¤©æ´¥ç‰¹äº§"],honors:["å›½å®¶5Açº§æ—…æ¸¸æ™¯åŒº","ä¸­å›½åŽ†å²æ–‡åŒ–åè¡—","å¤©æ´¥å¸‚æ–‡åŒ–åœ°æ ‡"],historicalSignificance:"å¤©æ´¥å¤æ–‡åŒ–è¡—æ˜¯å¤©æ´¥ä¼ ç»Ÿæ–‡åŒ–çš„é‡è¦è½½ä½“ï¼Œé›†ä¸­å±•ç¤ºäº†å¤©æ´¥çš„åŽ†å²æ–‡åŒ–ã€ä¼ ç»Ÿå·¥è‰ºå’Œæ°‘ä¿—é£Žæƒ…ã€‚",culturalHeritageLevel:"å›½å®¶çº§",relatedPois:[5,6]},{id:12,name:"é£Žç­é­",category:"craft",description:"å¤©æ´¥è‘—åçš„é£Žç­åˆ¶ä½œæŠ€è‰ºï¼Œä»¥åˆ¶ä½œç²¾ç¾Žã€é€ åž‹ç‹¬ç‰¹çš„é£Žç­è€Œé—»åï¼Œæ˜¯ä¸­å›½ä¼ ç»Ÿæ‰‹å·¥è‰ºçš„ä»£è¡¨ã€‚",address:"å¤©æ´¥å¸‚å—å¼€åŒºå¤æ–‡åŒ–è¡—å®«å—å¤§è¡—12å·",position:{x:45,y:54,lng:z[3][0]-.01,lat:z[3][1]-.01},year:1892,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eé£Žç­é­%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eä¼ ç»Ÿæ‰‹å·¥è‰º%3C/text%3E%3C/svg%3E"],openingHours:"09:00-18:00",phone:"022-27356878",importance:4,tags:["ä¼ ç»Ÿæ‰‹å·¥è‰º","å›½å®¶çº§éžé—","å¤©æ´¥åäº§"],featuredProducts:["æ²™ç‡•é£Žç­","å·¨é¾™é£Žç­","è´è¶é£Žç­","äººç‰©é£Žç­"],honors:["å›½å®¶çº§éžç‰©è´¨æ–‡åŒ–é—äº§","ä¸­åŽè€å­—å·","ä¸­å›½ä¼ ç»Ÿå·¥è‰ºçå“"],historicalSignificance:"é£Žç­é­å§‹åˆ›äºŽ1892å¹´ï¼Œç”±é­å…ƒæ³°åˆ›ç«‹ï¼Œå…¶åˆ¶ä½œçš„é£Žç­ä»¥é€ åž‹ç²¾ç¾Žã€å·¥è‰ºç²¾æ¹›ã€æ”¾é£žç¨³å®šè€Œé—»åä¸­å¤–ã€‚",culturalHeritageLevel:"å›½å®¶çº§",relatedPois:[5,6,11]},{id:13,name:"å¤©æ´¥åšç‰©é¦†",category:"culture",description:"å¤©æ´¥æœ€å¤§çš„ç»¼åˆæ€§åšç‰©é¦†ï¼Œæ”¶è—äº†å¤§é‡å¤©æ´¥åŽ†å²æ–‡åŒ–é—äº§ï¼Œæ˜¯äº†è§£å¤©æ´¥åŽ†å²æ–‡åŒ–çš„é‡è¦åœºæ‰€ã€‚",address:"å¤©æ´¥å¸‚æ²³è¥¿åŒºå¹³æ±Ÿé“62å·",position:{x:48,y:59,lng:z[8][0]+.01,lat:z[8][1]+.01},year:1918,images:["data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f5f5f5'/%3E%3Ctext x='400' y='300' font-family='Arial' font-size='24' fill='%23333' text-anchor='middle' dy='0.3em'%3Eå¤©æ´¥åšç‰©é¦†%3C/text%3E%3Ctext x='400' y='340' font-family='Arial' font-size='16' fill='%23666' text-anchor='middle' dy='0.3em'%3Eç»¼åˆæ€§åšç‰©é¦†%3C/text%3E%3C/svg%3E"],openingHours:"09:00-16:30ï¼ˆå‘¨ä¸€é—­é¦†ï¼‰",phone:"022-83883000",importance:5,tags:["æ–‡åŒ–è®¾æ–½","åŽ†å²æ–‡ç‰©","å¤©æ´¥åœ°æ ‡"],featuredProducts:["æ–‡ç‰©å±•è§ˆ","åŽ†å²é™ˆåˆ—","ä¸´æ—¶ç‰¹å±•","æ–‡åˆ›äº§å“"],honors:["å›½å®¶ä¸€çº§åšç‰©é¦†","å¤©æ´¥å¸‚çˆ±å›½ä¸»ä¹‰æ•™è‚²åŸºåœ°"],historicalSignificance:"å¤©æ´¥åšç‰©é¦†æ˜¯å¤©æ´¥åŽ†å²æ–‡åŒ–çš„é‡è¦è½½ä½“ï¼Œæ”¶è—äº†å¤§é‡çè´µæ–‡ç‰©ï¼Œå±•ç¤ºäº†å¤©æ´¥ä»Žå¤ä»£åˆ°çŽ°ä»£çš„åŽ†å²å‘å±•è„‰ç»œã€‚",culturalHeritageLevel:"å›½å®¶çº§",relatedPois:[8]}]},J=ie.poi,fe=ie.categories;function ke(){var W;const{isDark:n,theme:b}=ge(),[a,l]=E.useState(1),[h,j]=E.useState("all"),[i,v]=E.useState(null),[L,N]=E.useState(!1),[P,C]=E.useState(()=>{const e={};return J.forEach(d=>{e[d.id]=d.images.map(()=>!1)}),e}),[T,I]=E.useState(0),[O,B]=E.useState(""),[S,D]=E.useState("all"),U=E.useMemo(()=>{const e=O.toLowerCase(),d=h==="all",p=S==="all";return J.filter(x=>{const w=d||x.category===h,r=e===""||x.name&&x.name.toLowerCase().includes(e)||x.description&&x.description.toLowerCase().includes(e);return w&&r&&(p||!0)})},[J,h,O,S]),H=E.useMemo(()=>[],[]),V=E.useMemo(()=>{const x={"bg-yellow-500":"#eab308","bg-blue-500":"#3b82f6","bg-purple-500":"#8b5cf6","bg-red-500":"#ef4444","bg-green-500":"#10b981"};return U.map(w=>{const r=typeof w.position.x=="number"?500+(w.position.x-50)*20:500,s=typeof w.position.y=="number"?500+(w.position.y-50)*20:500,c=me[w.category]||"bg-blue-500",g=x[c]||"#3b82f6";return{id:w.id.toString(),name:w.name,coordinate:{x:r,y:s},category:w.category,description:w.description,color:g}})},[U]),ee=E.useMemo(()=>[],[]);E.useEffect(()=>{(async()=>{const p=J.map(x=>({poi:x,imageUrl:x.images[0],index:0})).map(({poi:x,imageUrl:w,index:r})=>new Promise(s=>{const c=new Image;c.onload=()=>{C(g=>{const k=[...g[x.id]||Array(x.images.length).fill(!1)];return k[r]=!0,{...g,[x.id]:k}}),s()},c.onerror=()=>{s()},c.src=w}));await Promise.all(p)})()},[]),E.useEffect(()=>{I(0)},[i]);const Q=e=>{v(e),N(!0)},re=E.useCallback(e=>{const d=J.find(p=>p.id.toString()===e);d?Q(d):console.error("æœªæ‰¾åˆ°å¯¹åº”çš„POI:",e)},[J]),te=E.useCallback(()=>{N(!1),v(null)},[]);return t.jsxs("div",{className:`min-h-screen ${n?"bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white":"bg-gradient-to-br from-gray-50 via-white to-gray-100 text-gray-900"}`,children:[t.jsx(he,{title:"å¤©æ´¥è€å­—å·åŽ†å²åœ°å›¾",subtitle:"æŽ¢ç´¢å¤©æ´¥ç™¾å¹´è€å­—å·çš„åŽ†å²åˆ†å¸ƒä¸Žæ–‡åŒ–ä¼ æ‰¿",theme:"heritage",stats:[{label:"æ–‡åŒ–èµ„æº",value:J.length.toString()},{label:"æ–‡åŒ–åˆ†ç±»",value:Object.keys(fe).length.toString()},{label:"åŽ†å²è·¨åº¦",value:"è¿‘200å¹´"},{label:"æ–‡åŒ–é—äº§",value:"å›½å®¶çº§"}],pattern:!0,size:"lg"}),t.jsxs("main",{className:"container mx-auto px-4 py-8",children:[t.jsx("div",{className:`p-3 md:p-6 rounded-2xl shadow-lg mb-3 md:mb-6 ${n?"bg-gray-800/80 backdrop-blur-sm border border-gray-700":"bg-white/80 backdrop-blur-sm border border-gray-200"}`,children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"relative w-full",children:[t.jsx("input",{type:"text",placeholder:"æœç´¢è€å­—å·æˆ–åœ°æ ‡...",value:O,onChange:e=>B(e.target.value),className:`w-full pl-10 pr-10 py-2 rounded-lg border ${n?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-gray-100 border-gray-300 text-gray-900 placeholder-gray-500"} focus:outline-none focus:ring-2 focus:ring-red-500 transition-all duration-300`}),t.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),O&&t.jsx("button",{onClick:()=>B(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:t.jsx("i",{className:"fas fa-times"})})]}),t.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3 pt-1",children:t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{className:`px-3 py-1.5 rounded-full text-xs md:text-sm font-medium transition-all duration-300 ease-in-out transform hover:scale-105 shadow-md hover:shadow-lg ${h==="all"?n?"bg-gradient-to-r from-red-600 to-red-700 text-white":"bg-gradient-to-r from-red-500 to-red-600 text-white":n?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"} border border-transparent hover:border-opacity-50`,onClick:()=>j("all"),children:"å…¨éƒ¨"}),Object.entries(fe).map(([e,d])=>{const p=d.color.replace("bg-","");return t.jsxs("button",{className:`px-3 py-1.5 rounded-full text-xs md:text-sm font-medium transition-all duration-300 ease-in-out transform hover:scale-105 shadow-md hover:shadow-lg flex items-center gap-1.5 ${h===e?(n?`bg-gradient-to-r from-${p}/80 to-${p}`:`bg-gradient-to-r from-${p} to-${p}/80`)+" text-white":n?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"} border border-transparent hover:border-opacity-50`,onClick:()=>j(e),children:[t.jsx("span",{className:"text-base",children:d.icon})," ",t.jsx("span",{className:"hidden sm:inline",children:d.name})]},e)})]})})]})}),t.jsxs("div",{className:"relative w-full rounded-2xl shadow-xl overflow-hidden bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-900 border border-gray-100 dark:border-gray-700",style:{height:"800px",minHeight:"500px",maxHeight:"calc(100vh - 100px)"},children:[t.jsx(je,{initialRegions:H,initialPOIs:V,initialPaths:ee,onPOIClick:re,onMapClick:te,className:`${n?"bg-gray-800/80 backdrop-blur-sm":"bg-white/80 backdrop-blur-sm"}`,style:{height:"100%",width:"100%"}}),L&&i&&t.jsxs(xe.div,{className:`absolute bottom-0 left-0 right-0 md:bottom-4 md:left-4 md:right-auto md:w-80 lg:w-96 bg-white dark:bg-gray-800 rounded-t-xl md:rounded-xl shadow-2xl border-t md:border ${n?"border-gray-700":"border-gray-200"} overflow-hidden z-50 max-h-[70vh] md:max-h-[90vh]`,initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},transition:{duration:.4,ease:"easeOut"},children:[t.jsxs("div",{className:"relative h-52 overflow-hidden bg-gray-200 dark:bg-gray-700",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent z-10"}),i.images.map((e,d)=>t.jsx("img",{src:e,alt:`${i.name} - å›¾ç‰‡ ${d+1}`,className:`absolute inset-0 w-full h-full object-cover transition-transform duration-500 hover:scale-110 ${d===T?"opacity-100":"opacity-0"}`,onLoad:()=>{C(p=>{const w=[...p[i.id]||Array(i.images.length).fill(!1)];return w[d]=!0,{...p,[i.id]:w}})},onError:p=>{const x=p.target;x.src=`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300' viewBox='0 0 400 300'%3E%3Crect width='400' height='300' fill='%23${n?"374151":"e5e7eb"}'/%3E%3Ctext x='200' y='150' font-family='Arial' font-size='20' fill='%23${n?"9ca3af":"6b7280"}' text-anchor='middle' dy='0.3em'%3E${i.name}%3C/text%3E%3Ctext x='200' y='180' font-family='Arial' font-size='14' fill='%23${n?"9ca3af":"6b7280"}' text-anchor='middle' dy='0.3em'%3Eå›¾ç‰‡åŠ è½½ä¸­...%3C/text%3E%3C/svg%3E`,x.alt=`${i.name} å›¾ç‰‡`,C(w=>{const s=[...w[i.id]||Array(i.images.length).fill(!1)];return s[d]=!0,{...w,[i.id]:s}})},style:{display:"block"}},d)),t.jsxs("div",{className:"absolute top-3 left-3 bg-black/80 text-white text-xs px-3 py-1 rounded-full backdrop-blur-sm flex items-center gap-1",children:[t.jsx("i",{className:"fas fa-calendar-alt text-xs"}),i.year," å¹´"]}),i.images.length>1&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300 backdrop-blur-sm z-20",onClick:()=>I(e=>(e-1+i.images.length)%i.images.length),children:t.jsx("i",{className:"fas fa-chevron-left text-sm"})}),t.jsx("button",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300 backdrop-blur-sm z-20",onClick:()=>I(e=>(e+1)%i.images.length),children:t.jsx("i",{className:"fas fa-chevron-right text-sm"})}),t.jsx("div",{className:"absolute bottom-3 left-1/2 transform -translate-x-1/2 flex gap-1.5 z-20",children:i.images.map((e,d)=>t.jsx("button",{className:`w-2 h-2 rounded-full transition-all duration-300 ${d===T?"bg-white w-6":"bg-white/50 hover:bg-white/70"}`,onClick:()=>I(d)},d))})]})]}),t.jsxs("div",{className:"p-5 overflow-y-auto max-h-[calc(80vh-130px)] md:max-h-[calc(90vh-130px)]",children:[t.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:i.name}),i.importance&&t.jsxs("div",{className:"mb-3 flex items-center gap-1",children:[Array.from({length:5}).map((e,d)=>t.jsx("i",{className:`fas fa-star ${d<i.importance?"text-yellow-500":"text-gray-300 dark:text-gray-600"} text-sm`},d)),t.jsx("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["","ä¸€èˆ¬","é‡è¦","å¾ˆé‡è¦","éžå¸¸é‡è¦","æžå…¶é‡è¦"][i.importance]||""})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[t.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium ${n?"bg-blue-900/30 text-blue-400":"bg-blue-100 text-blue-800"}`,children:[ce[i.category]," ",((W=ie.categories[i.category])==null?void 0:W.name)||"å…¶ä»–"]}),t.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[t.jsx("i",{className:"fas fa-map-marker-alt text-xs"}),i.address]})]}),i.tags&&i.tags.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:i.tags.map((e,d)=>t.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${n?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"} hover:opacity-80 transition-opacity`,children:["#",e]},d))}),t.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 gap-3 mb-5 p-4 rounded-xl ${n?"bg-gray-700/50":"bg-gray-50"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${n?"bg-blue-900/30 text-blue-400":"bg-blue-100 text-blue-800"}`,children:t.jsx("i",{className:"fas fa-calendar-alt text-xs"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"åˆ›ç«‹æ—¶é—´"}),t.jsxs("div",{className:"text-sm font-semibold dark:text-white",children:[i.year," å¹´"]})]})]}),i.openingHours&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${n?"bg-green-900/30 text-green-400":"bg-green-100 text-green-800"}`,children:t.jsx("i",{className:"fas fa-clock text-xs"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"å¼€æ”¾æ—¶é—´"}),t.jsx("div",{className:"text-sm font-semibold dark:text-white",children:i.openingHours})]})]}),i.phone&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${n?"bg-purple-900/30 text-purple-400":"bg-purple-100 text-purple-800"}`,children:t.jsx("i",{className:"fas fa-phone text-xs"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"è”ç³»ç”µè¯"}),t.jsx("div",{className:"text-sm font-semibold dark:text-white",children:i.phone})]})]}),i.culturalHeritageLevel&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${n?"bg-yellow-900/30 text-yellow-400":"bg-yellow-100 text-yellow-800"}`,children:t.jsx("i",{className:"fas fa-award text-xs"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"é—äº§çº§åˆ«"}),t.jsx("div",{className:"text-sm font-semibold dark:text-white",children:i.culturalHeritageLevel})]})]})]}),t.jsxs("div",{className:"mb-5",children:[t.jsxs("h4",{className:"text-sm font-semibold mb-2 dark:text-white flex items-center gap-1",children:[t.jsx("i",{className:"fas fa-history text-gray-500 dark:text-gray-400"}),"åŽ†å²èƒŒæ™¯"]}),t.jsx("p",{className:"text-sm dark:text-gray-300 leading-relaxed",children:i.description})]}),i.historicalSignificance&&t.jsxs("div",{className:"mb-5",children:[t.jsxs("h4",{className:"text-sm font-semibold mb-2 dark:text-white flex items-center gap-1",children:[t.jsx("i",{className:"fas fa-book text-gray-500 dark:text-gray-400"}),"åŽ†å²æ„ä¹‰"]}),t.jsx("p",{className:"text-sm dark:text-gray-300 leading-relaxed",children:i.historicalSignificance})]}),i.featuredProducts&&i.featuredProducts.length>0&&t.jsxs("div",{className:"mb-5",children:[t.jsxs("h4",{className:"text-sm font-semibold mb-2 dark:text-white flex items-center gap-1",children:[t.jsx("i",{className:"fas fa-gift text-gray-500 dark:text-gray-400"}),"ç‰¹è‰²äº§å“"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:i.featuredProducts.map((e,d)=>t.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${n?"bg-green-900/30 text-green-400 hover:bg-green-800/30":"bg-green-100 text-green-800 hover:bg-green-200"} hover:opacity-80 transition-all duration-300`,children:e},d))})]}),i.honors&&i.honors.length>0&&t.jsxs("div",{className:"mb-5",children:[t.jsxs("h4",{className:"text-sm font-semibold mb-2 dark:text-white flex items-center gap-1",children:[t.jsx("i",{className:"fas fa-trophy text-gray-500 dark:text-gray-400"}),"è£èª‰èµ„è´¨"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:(i.honors||[]).map((e,d)=>t.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${n?"bg-blue-900/30 text-blue-400 hover:bg-blue-800/30":"bg-blue-100 text-blue-800 hover:bg-blue-200"} hover:opacity-80 transition-all duration-300`,children:e},`honor-${d}`))})]}),i.relatedPois&&i.relatedPois.length>0&&t.jsxs("div",{className:"mb-5",children:[t.jsxs("h4",{className:"text-sm font-semibold mb-2 dark:text-white flex items-center gap-1",children:[t.jsx("i",{className:"fas fa-compass text-gray-500 dark:text-gray-400"}),"ç›¸å…³æŽ¨è"]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:i.relatedPois.map(e=>{var p;const d=J.find(x=>x.id===e);return d?t.jsxs("button",{className:`px-3 py-2 rounded-lg text-sm font-medium flex items-center gap-2 ${n?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200 text-gray-700"} transition-all duration-300 hover:shadow-md`,onClick:()=>Q(d),children:[t.jsx("span",{className:`text-lg ${me[d.category]}`,children:ce[d.category]}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("div",{className:"font-medium truncate",children:d.name}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:(p=ie.categories[d.category])==null?void 0:p.name})]}),t.jsx("i",{className:"fas fa-chevron-right text-xs text-gray-400 dark:text-gray-500"})]},d.id):null})})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{className:`flex-1 py-2 rounded-lg transition-all duration-300 ${n?"bg-red-600 hover:bg-red-700 text-white":"bg-red-500 hover:bg-red-600 text-white"} font-medium text-sm flex items-center justify-center gap-1 shadow-md hover:shadow-lg transform hover:-translate-y-0.5`,onClick:()=>N(!1),children:[t.jsx("i",{className:"fas fa-times"}),"å…³é—­"]}),t.jsxs("button",{className:`flex-1 py-2 rounded-lg transition-all duration-300 ${n?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"} font-medium text-sm flex items-center justify-center gap-1 shadow-md hover:shadow-lg transform hover:-translate-y-0.5`,children:[t.jsx("i",{className:"fas fa-share-alt"}),"åˆ†äº«"]})]}),t.jsxs("button",{className:`w-full mt-3 py-2 rounded-lg transition-all duration-300 ${n?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-500 hover:bg-blue-600 text-white"} font-medium text-sm flex items-center justify-center gap-1 shadow-md hover:shadow-lg transform hover:-translate-y-0.5`,onClick:()=>window.open("/AR","_blank","width=1000,height=800"),children:[t.jsx("i",{className:"fas fa-vr-cardboard"}),"ARä½“éªŒ"]})]})]})]}),t.jsxs("div",{className:`p-6 rounded-2xl shadow-lg mt-6 ${n?"bg-gray-800/80 backdrop-blur-sm border border-gray-700":"bg-white/80 backdrop-blur-sm border border-gray-200"}`,children:[t.jsx("h3",{className:"text-xl font-bold mb-4",children:"åœ°å›¾ä½¿ç”¨è¯´æ˜Ž"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("i",{className:"fas fa-mouse-pointer text-red-500 mt-1"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold",children:"ç‚¹å‡»æ ‡è®°"}),t.jsx("p",{className:"text-sm dark:text-gray-400",children:"ç‚¹å‡»åœ°å›¾ä¸Šçš„æ ‡è®°ç‚¹æŸ¥çœ‹è€å­—å·è¯¦ç»†ä¿¡æ¯"})]})]}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("i",{className:"fas fa-filter text-blue-500 mt-1"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold",children:"åˆ†ç±»ç­›é€‰"}),t.jsx("p",{className:"text-sm dark:text-gray-400",children:"ä½¿ç”¨é¡¶éƒ¨åˆ†ç±»æŒ‰é’®ç­›é€‰ä¸åŒç±»åž‹çš„è€å­—å·"})]})]}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("i",{className:"fas fa-search-plus text-green-500 mt-1"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold",children:"ç¼©æ”¾æŽ§åˆ¶"}),t.jsx("p",{className:"text-sm dark:text-gray-400",children:"ä½¿ç”¨é¼ æ ‡æ»šè½®æˆ–åœ°å›¾æŽ§ä»¶è°ƒæ•´åœ°å›¾å¤§å°"})]})]}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("i",{className:"fas fa-info-circle text-purple-500 mt-1"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold",children:"äº†è§£åŽ†å²"}),t.jsx("p",{className:"text-sm dark:text-gray-400",children:"æŽ¢ç´¢å¤©æ´¥è€å­—å·çš„ç™¾å¹´åŽ†å²ä¸Žæ–‡åŒ–ä¼ æ‰¿"})]})]})]})]})]})]})}export{ke as default};
