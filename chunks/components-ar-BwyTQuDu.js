import{r as e,j as s,f as t,O as a,g as n,h as l}from"./vendor-react-7rlDZYVK.js";import{T as r,D as i}from"./three-core-DHZMy_Lk.js";import"./i18n-CPi6PAmy.js";import"./vendor-other-CRhi5s5X.js";import"./charts-recharts-D0ssCqK6.js";import"./three-stdlib-C_4-sCbx.js";const o=new Map,c=({url:t,onLoad:a,position:n,rotation:r,scale:i})=>{const c=o.get(t),d=Date.now();if(c&&d-c.timestamp<36e5)return o.set(t,{...c,usageCount:c.usageCount+1,timestamp:d}),e.useEffect(()=>{a&&a()},[a]),s.jsx("primitive",{object:c.gltf.scene,position:n,rotation:r,scale:i});const x=l(t);return e.useEffect(()=>{if(x.scene){if(o.size>=5){const e=Array.from(o.entries());e.sort((e,s)=>e[1].usageCount!==s[1].usageCount?e[1].usageCount-s[1].usageCount:e[1].timestamp-s[1].timestamp),o.delete(e[0][0])}o.set(t,{gltf:x,timestamp:Date.now(),usageCount:1}),a&&a()}},[x.scene,a,t]),s.jsx("primitive",{object:x.scene,position:n,rotation:r,scale:i})},d=async e=>{if(!o.has(e))try{if("string"!=typeof e||!e)throw new Error("Invalid model URL");o.set(e,{gltf:{scene:null},timestamp:Date.now(),usageCount:0})}catch(s){}},x=({url:t,onLoad:a,onError:n,position:l,rotation:r,scale:i})=>{const[o,d]=e.useState(null);return o?s.jsxs("mesh",{position:l,rotation:r,scale:i,children:[s.jsx("boxGeometry",{args:[2,2,2]}),s.jsx("meshStandardMaterial",{color:"#ef4444",opacity:.7,transparent:!0})]}):s.jsx(m,{onError:e=>{d(e),n?.(e)},children:s.jsx(c,{url:t,onLoad:()=>{a?.()},position:l,rotation:r,scale:i})})};class m extends n.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e){this.props.onError(e)}render(){return this.state.hasError?null:this.props.children}}const h=({config:n,onClose:l})=>{const[o,c]=e.useState(null),[d,m]=e.useState(!1),[h,p]=e.useState(!0),[u,g]=e.useState(0),[f,j]=e.useState(null),[b,y]=e.useState(0),[N,v]=e.useState(null),[w,C]=e.useState(n.scale||5),[k,E]=e.useState(n.rotation||{x:0,y:0,z:0}),[S,z]=e.useState(n.position||{x:0,y:0,z:0}),[M,R]=e.useState(!1),U=e.useRef(null),L=e.useRef(null),A=e.useRef(null);e.useEffect(()=>{(async()=>{try{const e=await(navigator.xr?.isSessionSupported("immersive-ar"))||!1,s="undefined"!=typeof HTMLCanvasElement,t="undefined"!=typeof WebGLRenderingContext,a=navigator.userAgent;let n={name:"Unknown",version:"Unknown"};/Chrome/.test(a)?n={name:"Chrome",version:a.match(/Chrome\/(\d+\.\d+)/)?.[1]||"Unknown"}:/Firefox/.test(a)?n={name:"Firefox",version:a.match(/Firefox\/(\d+\.\d+)/)?.[1]||"Unknown"}:/Safari/.test(a)&&!/Chrome/.test(a)?n={name:"Safari",version:a.match(/Version\/(\d+\.\d+)/)?.[1]||"Unknown"}:/Edge/.test(a)&&(n={name:"Edge",version:a.match(/Edg\/(\d+\.\d+)/)?.[1]||"Unknown"}),v(e&&s&&t)}catch(e){v(!1)}})()},[]);const I=e.useCallback(async()=>{if("3d"!==n.type||n.modelUrl)if("2d"!==n.type||n.imageUrl)try{if(p(!0),j(null),g(0),c(null),m(!1),"2d"===n.type&&n.imageUrl){const e=(e=>{try{return new URL(e),e.startsWith("https://")}catch{return!1}})(n.imageUrl)?n.imageUrl:"https://images.unsplash.com/photo-1614850526283-3a3560210a5a?w=800&h=600&fit=crop&q=80";n.imageUrl;const s=new r;L.current=s,await new Promise((t,a)=>{try{s.load(e,e=>{c(e),g(100),t()},e=>{if(e.lengthComputable){const s=Math.round(e.loaded/e.total*100);g(s)}else g(e=>Math.min(e+10,90))},e=>{a(new Error("å›¾åƒèµ„æºåŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"))})}catch(n){a(new Error("å›¾åƒåŠ è½½è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•"))}})}else"3d"===n.type&&g(50);p(!1)}catch(e){j(e instanceof Error?e.message:"èµ„æºåŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"),p(!1)}else p(!1);else p(!1)},[n.imageUrl,n.modelUrl,n.type]),P=e.useCallback(()=>{b<3&&(y(e=>e+1),j(null),p(!0),g(0),c(null),m(!1))},[b,3]);e.useEffect(()=>(I(),()=>{o&&"function"==typeof o.dispose&&o.dispose()}),[I,o]),e.useEffect(()=>{b>0&&I()},[b,I]);const F=e.useCallback(()=>{m(!0),g(100),p(!1)},[]),D=e.useCallback(e=>{j("3Dæ¨¡å‹åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"),p(!1)},[]);return e.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),s.jsxs("div",{ref:U,onClick:e=>{e.target===U.current&&l()},className:"fixed inset-0 z-50 flex flex-col bg-black",style:{pointerEvents:"auto"},children:[s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-900 text-white z-10",children:[s.jsx("h2",{className:"text-xl font-bold",children:"ARé¢„è§ˆ"}),s.jsx("button",{onClick:l,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"å…³é—­"})]}),s.jsxs("div",{className:"flex-1 relative",children:[s.jsxs(t,{camera:{position:[5,5,5]},gl:{antialias:!0},style:{width:"100%",height:"100%"},children:[s.jsx("ambientLight",{intensity:n.ambientLightIntensity||1}),s.jsx("directionalLight",{position:[10,10,10],intensity:n.directionalLightIntensity||1}),s.jsx(a,{enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:2,maxDistance:15}),s.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-1,0],children:[s.jsx("planeGeometry",{args:[20,20]}),s.jsx("meshStandardMaterial",{color:"#e2e8f0"})]}),"2d"===n.type&&o&&s.jsxs("mesh",{ref:A,position:[S.x,S.y,S.z],rotation:[k.x,k.y,k.z],scale:w,castShadow:!0,receiveShadow:!0,children:[s.jsx("planeGeometry",{args:[3,3]}),s.jsx("meshPhysicalMaterial",{map:o,transparent:!0,side:i,roughness:.5,metalness:.2,transmission:.1})]}),"3d"===n.type&&n.modelUrl&&s.jsx(x,{url:n.modelUrl,onLoad:F,onError:D,position:[S.x,S.y,S.z],rotation:[k.x,k.y,k.z],scale:w}),"3d"===n.type&&!d&&s.jsxs("mesh",{position:[S.x,S.y,S.z],rotation:[k.x,k.y,k.z],scale:w,children:[s.jsx("boxGeometry",{args:[2,2,2]}),s.jsx("meshStandardMaterial",{color:"#4f46e5",opacity:.5,transparent:!0})]})]}),s.jsx("div",{className:"absolute bottom-4 right-4 z-10 flex flex-col gap-3",children:s.jsx("button",{onClick:()=>R(!M),className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors shadow-lg hover:shadow-xl transition-all duration-200",children:M?"å…³é—­æ§åˆ¶":"è°ƒæ•´æ¨¡å‹"})}),M&&s.jsxs("div",{className:"absolute bottom-20 right-4 z-10 bg-gray-800 bg-opacity-90 text-white p-4 rounded-lg shadow-xl max-w-xs w-full",children:[s.jsxs("h3",{className:"text-lg font-bold mb-3 flex items-center justify-between",children:[s.jsx("span",{children:"æ¨¡å‹æ§åˆ¶"}),s.jsx("button",{onClick:()=>R(!1),className:"text-gray-400 hover:text-white transition-colors",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("label",{className:"text-sm font-medium",children:"ç¼©æ”¾"}),s.jsxs("span",{className:"text-sm opacity-80",children:[w.toFixed(1),"x"]})]}),s.jsx("input",{type:"range",min:"0.5",max:"10",step:"0.1",value:w,onChange:e=>C(parseFloat(e.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500"}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[s.jsx("span",{children:"0.5x"}),s.jsx("span",{children:"10x"})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"text-sm font-medium mb-2",children:"æ—‹è½¬"}),s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("label",{className:"text-xs text-gray-300",children:"Xè½´"}),s.jsxs("span",{className:"text-xs opacity-80",children:[(180*k.x/Math.PI).toFixed(0),"Â°"]})]}),s.jsx("input",{type:"range",min:"-180",max:"180",step:"5",value:180*k.x/Math.PI,onChange:e=>E(s=>({...s,x:parseFloat(e.target.value)*Math.PI/180})),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500"}),s.jsxs("div",{className:"flex justify-between items-center mb-1 mt-2",children:[s.jsx("label",{className:"text-xs text-gray-300",children:"Yè½´"}),s.jsxs("span",{className:"text-xs opacity-80",children:[(180*k.y/Math.PI).toFixed(0),"Â°"]})]}),s.jsx("input",{type:"range",min:"-180",max:"180",step:"5",value:180*k.y/Math.PI,onChange:e=>E(s=>({...s,y:parseFloat(e.target.value)*Math.PI/180})),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500"}),s.jsxs("div",{className:"flex justify-between items-center mb-1 mt-2",children:[s.jsx("label",{className:"text-xs text-gray-300",children:"Zè½´"}),s.jsxs("span",{className:"text-xs opacity-80",children:[(180*k.z/Math.PI).toFixed(0),"Â°"]})]}),s.jsx("input",{type:"range",min:"-180",max:"180",step:"5",value:180*k.z/Math.PI,onChange:e=>E(s=>({...s,z:parseFloat(e.target.value)*Math.PI/180})),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),s.jsx("button",{onClick:()=>{C(n.scale||5),E(n.rotation||{x:0,y:0,z:0}),z(n.position||{x:0,y:0,z:0})},className:"w-full py-2 bg-gray-700 hover:bg-gray-600 text-sm rounded-lg transition-colors",children:"é‡ç½®æ¨¡å‹"})]}),s.jsx("div",{className:"absolute bottom-4 left-4 z-10 flex flex-col gap-3",children:null===N?s.jsx("div",{className:"flex flex-col gap-2",children:s.jsxs("div",{className:"text-white text-sm bg-gray-800 bg-opacity-90 px-4 py-3 rounded-lg backdrop-blur-md shadow-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("i",{className:"fas fa-spinner fa-spin text-blue-400"}),s.jsx("span",{className:"font-medium",children:"æ­£åœ¨æ£€æµ‹è®¾å¤‡ARå…¼å®¹æ€§"})]}),s.jsx("p",{className:"text-xs opacity-90",children:"è¯·ç¨å€™..."})]})}):N?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"text-white text-sm bg-blue-900 bg-opacity-90 px-4 py-3 rounded-lg max-w-xs backdrop-blur-md shadow-lg",children:[s.jsxs("div",{className:"font-medium mb-2 flex items-center gap-2",children:[s.jsx("i",{className:"fas fa-vr-cardboard text-blue-400"}),s.jsx("span",{children:"ARåŠŸèƒ½è¯´æ˜"})]}),s.jsxs("div",{className:"space-y-1 text-xs",children:[s.jsxs("p",{className:"flex items-start gap-1",children:[s.jsx("span",{className:"text-blue-400",children:"ğŸ“±"}),s.jsx("span",{children:"ç›®å‰ä»…åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ”¯æŒå®Œæ•´ARåŠŸèƒ½"})]}),s.jsxs("p",{className:"flex items-start gap-1",children:[s.jsx("span",{className:"text-blue-400",children:"ğŸ”"}),s.jsx("span",{children:"ç¡®ä¿è®¾å¤‡æ”¯æŒWebXRæŠ€æœ¯"})]}),s.jsxs("p",{className:"flex items-start gap-1",children:[s.jsx("span",{className:"text-blue-400",children:"ğŸŒ"}),s.jsx("span",{children:"åœ¨æ˜äº®ç¯å¢ƒä¸­ä½¿ç”¨æ•ˆæœæ›´ä½³"})]}),s.jsxs("p",{className:"flex items-start gap-1",children:[s.jsx("span",{className:"text-blue-400",children:"ğŸ“‹"}),s.jsx("span",{children:"å°†è®¾å¤‡å¯¹å‡†å¹³é¢è¡¨é¢"})]})]})]}),s.jsxs("button",{onClick:()=>{alert("ğŸ“± ARåŠŸèƒ½å¼€å‘ä¸­\n\nå¼€å‘å›¢é˜Ÿæ­£åœ¨åŠªåŠ›å¼€å‘å®Œæ•´çš„ARåŠŸèƒ½ï¼Œæ•¬è¯·æœŸå¾…ï¼\n\næ‚¨å¯ä»¥ç»§ç»­ä½¿ç”¨3Dé¢„è§ˆåŠŸèƒ½æŸ¥çœ‹å’Œæ“ä½œæ¨¡å‹ã€‚")},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:translate-y-[-2px] transform",children:[s.jsx("i",{className:"fas fa-vr-cardboard mr-2"}),"äº†è§£ARåŠŸèƒ½"]})]}):s.jsx("div",{className:"flex flex-col gap-2",children:s.jsxs("div",{className:"text-white text-sm bg-gray-900 bg-opacity-90 px-4 py-3 rounded-lg max-w-xs backdrop-blur-md shadow-lg",children:[s.jsxs("div",{className:"font-medium mb-2 flex items-center gap-2",children:[s.jsx("i",{className:"fas fa-info-circle text-yellow-400"}),s.jsx("span",{children:"è®¾å¤‡ä¸æ”¯æŒARåŠŸèƒ½"})]}),s.jsx("p",{className:"text-xs mb-2 opacity-90",children:"å½“å‰è®¾å¤‡æš‚ä¸æ”¯æŒWebXR ARåŠŸèƒ½"}),s.jsxs("div",{className:"text-xs",children:[s.jsx("p",{className:"font-medium mb-1",children:"å»ºè®®ä½¿ç”¨ä»¥ä¸‹è®¾å¤‡å’Œæµè§ˆå™¨ï¼š"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsxs("li",{className:"flex items-start gap-1",children:[s.jsx("span",{className:"text-green-400",children:"âœ…"}),s.jsx("span",{children:"Androidè®¾å¤‡ + Chrome 90+"})]}),s.jsxs("li",{className:"flex items-start gap-1",children:[s.jsx("span",{className:"text-green-400",children:"âœ…"}),s.jsx("span",{children:"Androidè®¾å¤‡ + Edge 90+"})]}),s.jsxs("li",{className:"flex items-start gap-1",children:[s.jsx("span",{className:"text-green-400",children:"âœ…"}),s.jsx("span",{children:"iOS 15+è®¾å¤‡ + Safari 15+"})]})]})]})]})})}),h&&s.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-50 z-10",children:s.jsxs("div",{className:"text-white text-center",children:[s.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-t-transparent border-white rounded-full mx-auto mb-4"}),s.jsx("p",{className:"text-lg font-medium mb-2",children:"æ­£åœ¨åŠ è½½ARèµ„æº..."}),s.jsx("div",{className:"w-64 bg-gray-700 rounded-full h-2.5 mb-2",children:s.jsx("div",{className:"bg-white h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${u}%`}})}),s.jsxs("p",{className:"text-sm opacity-80",children:[u,"%"]})]})}),f&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 z-10",children:s.jsxs("div",{className:"text-white text-center p-8 bg-red-900 bg-opacity-70 rounded-lg max-w-md",children:[s.jsx("div",{className:"text-5xl mb-4",children:"âš ï¸"}),s.jsx("h3",{className:"text-2xl font-bold mb-3",children:"åŠ è½½å¤±è´¥"}),s.jsx("p",{className:"mb-4",children:f}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[s.jsx("button",{onClick:P,disabled:b>=3,className:"px-6 py-3 rounded-lg transition-all duration-200 font-medium "+(b>=3?"bg-gray-600 text-gray-300 cursor-not-allowed opacity-60":"bg-red-600 text-white hover:bg-red-700 hover:shadow-lg"),children:b>=3?"å·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°":`é‡è¯• (${b}/3)`}),s.jsx("button",{onClick:l,className:"px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 hover:shadow-lg transition-all duration-200 font-medium",children:"å…³é—­"})]}),b>=3&&s.jsx("p",{className:"text-sm opacity-80 mt-4",children:"è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•"})]})})]})]})};export{h as default,d as preloadModel};
