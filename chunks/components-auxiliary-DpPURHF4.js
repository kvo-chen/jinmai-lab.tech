import{r as e,j as t,g as s,m as a,t as r}from"./vendor-react-7rlDZYVK.js";import{u as i}from"./components-analytics-D0Glag6r.js";import{A as n}from"./components-admin-u5o8ISLL.js";const l=({asMenuItem:s=!1,isDark:a=!1,hideFixedButton:r=!1,forceShow:i=!1})=>{const[n,l]=e.useState(null),[o,c]=e.useState(!1),[d,u]=e.useState(!1),[m,g]=e.useState("idle");e.useEffect(()=>{const e=e=>{e.preventDefault(),l(e),c(!0),u(!0)},t=()=>{l(null),c(!1),u(!1),g("installed"),setTimeout(()=>g("idle"),3e3)},s=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{e.length})};window.addEventListener("beforeinstallprompt",e),window.addEventListener("appinstalled",t),s();const a=setInterval(s,1e3);return setTimeout(()=>clearInterval(a),1e4),()=>{window.removeEventListener("beforeinstallprompt",e),window.removeEventListener("appinstalled",t),clearInterval(a)}},[n]);const h=async()=>{if(!n)return window.matchMedia("(display-mode: standalone)").matches?(g("installed"),void setTimeout(()=>{g("idle")},3e3)):("serviceWorker"in navigator&&(await navigator.serviceWorker.getRegistrations()).length,"BeforeInstallPromptEvent"in window?"https:"!==window.location.protocol?(g("dismissed"),void setTimeout(()=>{g("idle"),c(!0)},3e3)):void window.location.reload():(g("dismissed"),void setTimeout(()=>{g("idle"),c(!0)},3e3)));g("installing"),u(!1);try{await n.prompt();const{outcome:e,platform:t}=await n.userChoice;"accepted"===e?(g("installed"),setTimeout(()=>{g("idle")},3e3)):(g("dismissed"),setTimeout(()=>{g("idle"),c(!0)},3e3))}catch(e){g("dismissed"),setTimeout(()=>{g("idle"),c(!0)},3e3)}l(null),c(!1),setTimeout(()=>g("idle"),3e3)},x=()=>"BeforeInstallPromptEvent"in window;return t.jsxs(t.Fragment,{children:[!s&&d&&x()&&t.jsx("div",{className:"fixed bottom-20 right-6 z-40 max-w-xs",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-4 border border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex justify-between items-start mb-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"å®‰è£…åº”ç”¨åˆ°ä¸»å±å¹•"}),t.jsx("button",{onClick:()=>{u(!1)},className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:t.jsx("i",{className:"fas fa-times"})})]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œå°†åº”ç”¨å®‰è£…åˆ°ä¸»å±å¹•ï¼Œè·å¾—æ›´å¥½çš„ä½¿ç”¨ä½“éªŒã€‚"}),t.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-2 mb-4",children:[t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("i",{className:"fas fa-check-circle text-green-500 mt-1"}),t.jsx("span",{children:"æ”¯æŒç¦»çº¿ä½¿ç”¨"})]}),t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("i",{className:"fas fa-check-circle text-green-500 mt-1"}),t.jsx("span",{children:"æ›´å¿«çš„åŠ è½½é€Ÿåº¦"})]}),t.jsxs("li",{className:"flex items-start gap-2",children:[t.jsx("i",{className:"fas fa-check-circle text-green-500 mt-1"}),t.jsx("span",{children:"ç±»ä¼¼åŸç”Ÿåº”ç”¨çš„ä½“éªŒ"})]})]})]})}),s?t.jsxs("button",{onClick:h,className:"w-full text-left px-4 py-2 "+(a?"hover:bg-gray-700":"hover:bg-gray-50"),children:[t.jsx("i",{className:"fas fa-download mr-3"}),t.jsx("span",{children:"å®‰è£…åº”ç”¨"})]}):o&&x()&&!r&&t.jsx("div",{className:"fixed bottom-6 left-6 z-40",children:t.jsxs("button",{onClick:h,className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold py-3 px-8 rounded-full shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all duration-300 flex items-center gap-3",children:[t.jsx("i",{className:"fas fa-download text-lg"}),t.jsx("span",{children:"å®‰è£…åº”ç”¨"})]})}),"idle"!==m&&t.jsx("div",{className:"fixed bottom-6 left-6 z-40",children:t.jsxs("div",{className:"flex items-center gap-3 px-5 py-3 rounded-full shadow-lg transition-all duration-300 "+("installing"===m?"bg-yellow-100 text-yellow-800":"installed"===m?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["installing"===m&&t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-spinner fa-spin"}),t.jsx("span",{children:"æ­£åœ¨å®‰è£…..."})]}),"installed"===m&&t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-check-circle"}),t.jsx("span",{children:"å®‰è£…æˆåŠŸï¼"})]}),"dismissed"===m&&t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-times-circle"}),t.jsx("span",{children:"å½“å‰ç¯å¢ƒä¸æ”¯æŒç›´æ¥å®‰è£…åº”ç”¨"})]})]})})]})},o=Object.freeze(Object.defineProperty({__proto__:null,default:l},Symbol.toStringTag,{value:"Module"})),c=new class{dbName="jinmai-offline-db";version=1;db=null;async init(){if(!("indexedDB"in window))throw new Error("IndexedDB is not supported");return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("posts")){const e=t.createObjectStore("posts",{keyPath:"id"});e.createIndex("date","date",{unique:!1}),e.createIndex("category","category",{unique:!1})}if(t.objectStoreNames.contains("drafts")||t.createObjectStore("drafts",{keyPath:"id"}).createIndex("lastModified","lastModified",{unique:!1}),!t.objectStoreNames.contains("comments")){const e=t.createObjectStore("comments",{keyPath:"id"});e.createIndex("postId","postId",{unique:!1}),e.createIndex("date","date",{unique:!1})}t.objectStoreNames.contains("syncQueue")||t.createObjectStore("syncQueue",{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1})}})}isOnline(){return navigator.onLine}addNetworkListener(e){window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1))}async saveDraft(e){this.db||await this.init();const t={...e,lastModified:Date.now(),isDraft:!0};return new Promise((e,s)=>{const a=this.db.transaction(["drafts"],"readwrite").objectStore("drafts").put(t);a.onerror=()=>s(a.error),a.onsuccess=()=>e()})}async getDrafts(){return this.db||await this.init(),new Promise((e,t)=>{const s=this.db.transaction(["drafts"],"readonly").objectStore("drafts").getAll();s.onerror=()=>t(s.error),s.onsuccess=()=>e(s.result)})}async deleteDraft(e){return this.db||await this.init(),new Promise((t,s)=>{const a=this.db.transaction(["drafts"],"readwrite").objectStore("drafts").delete(e);a.onerror=()=>s(a.error),a.onsuccess=()=>t()})}async cachePosts(e){return this.db||await this.init(),new Promise((t,s)=>{const a=this.db.transaction(["posts"],"readwrite"),r=a.objectStore("posts");r.clear(),e.forEach(e=>{r.add(e)}),a.oncomplete=()=>t(),a.onerror=()=>s(a.error)})}async getCachedPosts(){return this.db||await this.init(),new Promise((e,t)=>{const s=this.db.transaction(["posts"],"readonly").objectStore("posts").getAll();s.onerror=()=>t(s.error),s.onsuccess=()=>e(s.result)})}async addToSyncQueue(e){this.db||await this.init();const t={...e,id:Date.now().toString()+Math.random().toString(36).substr(2,9),timestamp:Date.now(),attempts:0};return new Promise((e,s)=>{const a=this.db.transaction(["syncQueue"],"readwrite").objectStore("syncQueue").add(t);a.onerror=()=>s(a.error),a.onsuccess=()=>e()})}async getSyncQueue(){return this.db||await this.init(),new Promise((e,t)=>{const s=this.db.transaction(["syncQueue"],"readonly").objectStore("syncQueue").getAll();s.onerror=()=>t(s.error),s.onsuccess=()=>e(s.result)})}async processSyncQueue(){if(!this.isOnline())return;const e=await this.getSyncQueue();for(const s of e)try{await this.removeFromSyncQueue(s.id)}catch(t){await this.incrementAttempts(s.id)}}async removeFromSyncQueue(e){return this.db||await this.init(),new Promise((t,s)=>{const a=this.db.transaction(["syncQueue"],"readwrite").objectStore("syncQueue").delete(e);a.onerror=()=>s(a.error),a.onsuccess=()=>t()})}async incrementAttempts(e){return this.db||await this.init(),new Promise((t,s)=>{const a=this.db.transaction(["syncQueue"],"readwrite").objectStore("syncQueue"),r=a.get(e);r.onsuccess=()=>{const i=r.result;if(i&&i.attempts<5){i.attempts+=1;const e=a.put(i);e.onsuccess=()=>t(),e.onerror=()=>s(e.error)}else a.delete(e),t()},r.onerror=()=>s(r.error)})}async getStorageInfo(){if(!navigator.storage||!navigator.storage.estimate)return{total:0,used:0,available:0,usagePercentage:0};const e=await navigator.storage.estimate();return{total:e.quota||0,used:e.usage||0,available:(e.quota||0)-(e.usage||0),usagePercentage:e.quota?(e.usage||0)/e.quota*100:0}}},d=({position:s="top-right",showDetails:a=!1})=>{const[r,i]=e.useState(!0),[n,l]=e.useState(!1),[o,d]=e.useState({total:0,used:0,available:0,usagePercentage:0}),[u,m]=e.useState(0),[g,h]=e.useState(!1);e.useEffect(()=>{l(window.matchMedia("(display-mode: standalone)").matches);const e=window.matchMedia("(display-mode: standalone)"),t=()=>{l(e.matches)};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]),e.useEffect(()=>{i(navigator.onLine),c.addNetworkListener(e=>{i(e)})},[]),e.useEffect(()=>{const e=async()=>{try{const e=await c.getStorageInfo();d(e)}catch(e){}};e();const t=setInterval(e,3e4);return()=>clearInterval(t)},[]),e.useEffect(()=>{const e=async()=>{try{const e=await c.getSyncQueue();m(e.length)}catch(e){}};e();const t=setInterval(e,1e4);return()=>clearInterval(t)},[]);const x=async()=>{if(r)try{await c.processSyncQueue();const e=await c.getSyncQueue();m(e.length)}catch(e){}},b=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]};return t.jsxs("div",{className:`fixed ${{"top-left":"top-4 left-4","top-right":"top-4 right-4","bottom-left":"bottom-4 left-4","bottom-right":"bottom-4 right-4"}[s]} z-50 flex flex-col gap-2`,children:[t.jsxs("div",{className:"relative",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[t.jsxs("button",{className:"w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 "+(r?n?"bg-green-500 hover:bg-green-600":"bg-blue-500 hover:bg-blue-600":"bg-yellow-500 hover:bg-yellow-600"),onClick:x,title:r?"ç‚¹å‡»åŒæ­¥æ•°æ®":"ç½‘ç»œå·²æ–­å¼€",children:[t.jsx("div",{className:"text-white text-lg",children:n?"ğŸ“±":r?"ğŸŒ":"ğŸ“´"}),u>0&&r&&t.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:u})]}),g&&t.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 bottom-full mb-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 border border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"åº”ç”¨æ¨¡å¼:"}),t.jsx("span",{className:"text-sm font-medium "+(n?"text-green-600":"text-blue-600"),children:n?"PWAåº”ç”¨":"æµè§ˆå™¨"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"ç½‘ç»œçŠ¶æ€:"}),t.jsx("span",{className:"text-sm font-medium "+(r?"text-green-600":"text-yellow-600"),children:r?"åœ¨çº¿":"ç¦»çº¿"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"å­˜å‚¨ä½¿ç”¨:"}),t.jsxs("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:[b(o.used)," / ",b(o.total)]})]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(o.usagePercentage>90?"bg-red-500":o.usagePercentage>70?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(o.usagePercentage,100)}%`}})})]}),u>0&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"å¾…åŒæ­¥:"}),t.jsxs("span",{className:"text-sm font-medium text-red-600",children:[u," é¡¹"]})]}),t.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("button",{onClick:x,disabled:!r||0===u,className:"flex-1 px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"åŒæ­¥æ•°æ®"}),n&&t.jsx("button",{onClick:()=>window.close(),className:"px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600 transition-colors",children:"å…³é—­åº”ç”¨"})]})]})})]}),a&&t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 border border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"åº”ç”¨çŠ¶æ€"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"æ¨¡å¼:"}),t.jsx("span",{className:"ml-2 font-medium "+(n?"text-green-600":"text-blue-600"),children:n?"PWA":"Web"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"ç½‘ç»œ:"}),t.jsx("span",{className:"ml-2 font-medium "+(r?"text-green-600":"text-yellow-600"),children:r?"åœ¨çº¿":"ç¦»çº¿"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"å­˜å‚¨:"}),t.jsx("span",{className:"ml-2 font-medium",children:b(o.used)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"å¾…åŒæ­¥:"}),t.jsx("span",{className:"ml-2 font-medium "+(u>0?"text-red-600":"text-green-600"),children:u})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[t.jsx("span",{children:"å­˜å‚¨ä½¿ç”¨ç‡"}),t.jsxs("span",{children:[o.usagePercentage.toFixed(1),"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(o.usagePercentage>90?"bg-red-500":o.usagePercentage>70?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(o.usagePercentage,100)}%`}})})]})]})})]})},u=s.memo(()=>{const[s,a]=e.useState(!1),[r,i]=e.useState(0),[n,l]=e.useState(!1),o=e.useCallback(()=>{a(!1),localStorage.setItem("firstLaunch","false"),localStorage.setItem("hasSeenGuide","true")},[]),c=e.useCallback(()=>{r<m.length-1?(l(!0),setTimeout(()=>{i(e=>e+1),l(!1)},300)):o()},[r,o]),d=e.useCallback(()=>{o()},[o]),u=e.useCallback(()=>{r>0&&(l(!0),setTimeout(()=>{i(e=>e-1),l(!1)},300))},[r]);e.useEffect(()=>{const e=e=>{if(s)switch(e.key){case"ArrowRight":case"ArrowDown":case"Enter":e.preventDefault(),c();break;case"ArrowLeft":case"ArrowUp":e.preventDefault(),u();break;case"Escape":e.preventDefault(),d()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[s,c,u,d]),e.useEffect(()=>{const e=null===localStorage.getItem("firstLaunch"),t="true"===localStorage.getItem("hasSeenGuide");window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone,!e&&t||setTimeout(()=>{a(!0)},1e3)},[]);const m=[{title:"æ¬¢è¿ä½¿ç”¨æ´¥è„‰æ™ºåŠ",content:"æ„Ÿè°¢æ‚¨å®‰è£…æ´¥è„‰æ™ºåŠåº”ç”¨ï¼è¿™æ˜¯ä¸€ä¸ªä¸“æ³¨äºæ´¥é—¨è€å­—å·ä¼ æ‰¿ä¸åˆ›æ–°çš„å…±åˆ›å¹³å°ã€‚",image:"/icons/icon-192x192.svg"},{title:"æ¢ç´¢ä¼˜è´¨å†…å®¹",content:"æµè§ˆæ´¥é—¨è€å­—å·çš„ç²¾å½©ä½œå“ï¼Œå‘ç°ä¼ ç»Ÿæ–‡åŒ–çš„ç°ä»£é­…åŠ›ã€‚",image:"https://via.placeholder.com/150/2563eb/ffffff?text=æ¢ç´¢"},{title:"å‚ä¸å…±åˆ›",content:"å‘æŒ¥æ‚¨çš„åˆ›æ„ï¼Œå‚ä¸åˆ°æ´¥é—¨è€å­—å·çš„åˆ›æ–°å‘å±•ä¸­æ¥ã€‚",image:"https://via.placeholder.com/150/2563eb/ffffff?text=å…±åˆ›"},{title:"ç¦»çº¿ä½¿ç”¨",content:"åº”ç”¨æ”¯æŒç¦»çº¿ä½¿ç”¨ï¼Œå³ä½¿æ²¡æœ‰ç½‘ç»œä¹Ÿèƒ½æµè§ˆå·²ç¼“å­˜çš„å†…å®¹ã€‚",image:"https://via.placeholder.com/150/2563eb/ffffff?text=ç¦»çº¿"}];return s?t.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300",style:{opacity:s?1:0},children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden transition-all duration-500 transform",style:{opacity:s?1:0,transform:s?"scale(1)":"scale(0.9)"},children:[t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"flex justify-center mb-6",children:m.map((e,s)=>t.jsx("div",{className:"flex-1 h-1 mx-0.5 rounded-full transition-all duration-300 ease-in-out "+(s===r?"bg-blue-600 scale-y-125":"bg-gray-300 dark:bg-gray-600"),"aria-current":s===r?"step":void 0,role:"progressbar","aria-label":`æ­¥éª¤ ${s+1} / ${m.length}`},s))}),t.jsxs("div",{className:"text-center mb-8 transition-all duration-500 ease-in-out transform",style:{opacity:n?0:1,transform:n?"translateX(20px)":"translateX(0)",transitionDelay:n?"0s":"0.1s"},children:[t.jsx("div",{className:"flex justify-center mb-6",children:t.jsx("img",{src:m[r].image,alt:m[r].title,className:"w-32 h-32 object-contain transition-transform duration-500 ease-in-out",style:{transform:n?"scale(0.9)":"scale(1)"},loading:"lazy"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-3 transition-all duration-500",style:{opacity:n?0:1},children:m[r].title}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 transition-all duration-500",style:{opacity:n?0:1,transitionDelay:"0.2s"},children:m[r].content})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[r>0?t.jsx("button",{onClick:u,className:"text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 font-medium transition-colors duration-300","aria-label":"ä¸Šä¸€æ­¥",children:"ä¸Šä¸€æ­¥"}):t.jsx("button",{onClick:d,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 font-medium transition-colors duration-300","aria-label":"è·³è¿‡",children:"è·³è¿‡"}),t.jsx("button",{onClick:c,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","aria-label":r===m.length-1?"å®Œæˆ":"ä¸‹ä¸€æ­¥",children:r===m.length-1?"å®Œæˆ":"ä¸‹ä¸€æ­¥"})]})]}),t.jsxs("div",{className:"text-center text-sm text-gray-500 dark:text-gray-500 pb-4",children:["æ­¥éª¤ ",r+1," / ",m.length]})]})}):null}),m=Object.freeze(Object.defineProperty({__proto__:null,default:u},Symbol.toStringTag,{value:"Module"})),g=new class{tickets=new Map;lastId=0;constructor(){this.initializeMockData()}initializeMockData(){[{userId:"user-1",username:"æµ‹è¯•ç”¨æˆ·1",email:"test1@example.com",type:"bug",title:"é¡µé¢åŠ è½½é€Ÿåº¦æ…¢",description:"é¦–é¡µåŠ è½½æ—¶é—´è¶…è¿‡5ç§’ï¼Œä½“éªŒå¾ˆå·®",status:"pending",priority:"medium"},{userId:"user-2",username:"æµ‹è¯•ç”¨æˆ·2",email:"test2@example.com",type:"feature",title:"å¸Œæœ›å¢åŠ å¤œé—´æ¨¡å¼",description:"å¸Œæœ›å¹³å°èƒ½å¢åŠ å¤œé—´æ¨¡å¼ï¼Œä¿æŠ¤çœ¼ç›",status:"processing",priority:"high"},{userId:"user-3",username:"æµ‹è¯•ç”¨æˆ·3",email:"test3@example.com",type:"suggestion",title:"å»ºè®®ä¼˜åŒ–æœç´¢åŠŸèƒ½",description:"æœç´¢åŠŸèƒ½ä¸å¤Ÿæ™ºèƒ½ï¼Œå¸Œæœ›èƒ½ä¼˜åŒ–æœç´¢ç®—æ³•",status:"resolved",priority:"low",assignedTo:"admin-1",resolvedAt:new Date(Date.now()-864e5),resolution:"å·²è®¡åˆ’åœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¼˜åŒ–æœç´¢åŠŸèƒ½"}].forEach(e=>{this.createTicket({...e,userId:e.userId,email:e.email})})}createTicket(e){const t="ticket-"+ ++this.lastId,s=new Date,a={...e,id:t,comments:[],createdAt:s,updatedAt:s};return this.tickets.set(t,a),a}getAllTickets(){return Array.from(this.tickets.values()).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}getTicketById(e){return this.tickets.get(e)}getTicketsByUserId(e){return Array.from(this.tickets.values()).filter(t=>t.userId===e).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}updateTicketStatus(e,t,s){const a=this.tickets.get(e);if(!a)return;const r={...a,status:t,updatedAt:new Date,resolution:"resolved"===t?s:a.resolution,resolvedAt:"resolved"===t?new Date:a.resolvedAt};return this.tickets.set(e,r),r}updateTicketPriority(e,t){const s=this.tickets.get(e);if(!s)return;const a={...s,priority:t,updatedAt:new Date};return this.tickets.set(e,a),a}assignTicket(e,t){const s=this.tickets.get(e);if(!s)return;const a={...s,assignedTo:t,updatedAt:new Date};return this.tickets.set(e,a),a}addComment(e,t){const s=this.tickets.get(e);if(!s)return;const a={...t,id:`comment-${Date.now()}-${Math.floor(1e3*Math.random())}`,ticketId:e,createdAt:new Date},r={...s,comments:[...s.comments,a],updatedAt:new Date};return this.tickets.set(e,r),a}getTicketsByStatus(e){return Array.from(this.tickets.values()).filter(t=>t.status===e).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}getTicketsByPriority(e){return Array.from(this.tickets.values()).filter(t=>t.priority===e).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}closeTicket(e,t){const s=this.tickets.get(e);if(!s)return;const a={...s,status:"closed",resolution:t,resolvedAt:new Date,updatedAt:new Date};return this.tickets.set(e,a),a}getTicketStats(){const e=Array.from(this.tickets.values());return{total:e.length,pending:e.filter(e=>"pending"===e.status).length,processing:e.filter(e=>"processing"===e.status).length,resolved:e.filter(e=>"resolved"===e.status).length,closed:e.filter(e=>"closed"===e.status).length,byPriority:{low:e.filter(e=>"low"===e.priority).length,medium:e.filter(e=>"medium"===e.priority).length,high:e.filter(e=>"high"===e.priority).length}}}},h=Object.freeze(Object.defineProperty({__proto__:null,default:({isOpen:s,onClose:l})=>{const{isDark:o}=i(),{user:c}=e.useContext(n),[d,u]=e.useState({type:"bug",title:"",description:"",email:"",priority:"medium"}),[m,h]=e.useState(!1),[x,b]=e.useState({}),f=e=>{const{name:t,value:s}=e.target;u(e=>({...e,[t]:s})),x[t]&&b(e=>{const s={...e};return delete s[t],s})};return s?t.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:`fixed inset-0 z-50 flex items-center justify-center ${o?"bg-gray-900 bg-opacity-80":"bg-gray-50 bg-opacity-80"} backdrop-blur-sm`,onClick:()=>l(),children:t.jsxs(a.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},className:`rounded-2xl ${o?"bg-gray-800 text-white":"bg-white text-gray-900"} shadow-xl max-w-lg w-full mx-4 overflow-hidden flex flex-col`,onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:`p-6 border-b ${o?"border-gray-700":"border-gray-200"} flex justify-between items-center`,children:[t.jsx("h3",{className:"text-xl font-bold",children:"ç”¨æˆ·åé¦ˆ"}),t.jsx("button",{onClick:l,className:`p-2 rounded-full ${o?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200"} transition-colors`,"aria-label":"å…³é—­",children:t.jsx("i",{className:"fas fa-times"})})]}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return d.title.trim()?d.title.length<5&&(e.title="æ ‡é¢˜è‡³å°‘5ä¸ªå­—ç¬¦"):e.title="æ ‡é¢˜ä¸èƒ½ä¸ºç©º",d.description.trim()?d.description.length<10&&(e.description="æè¿°è‡³å°‘10ä¸ªå­—ç¬¦"):e.description="æè¿°ä¸èƒ½ä¸ºç©º",d.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)||(e.email="è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€"):e.email="é‚®ç®±ä¸èƒ½ä¸ºç©º",b(e),0===Object.keys(e).length})()){h(!0);try{await new Promise(e=>setTimeout(e,1e3)),g.createTicket({userId:c?.id||`anonymous-${Date.now()}`,username:c?.username||"åŒ¿åç”¨æˆ·",email:d.email,type:d.type,title:d.title,description:d.description,screenshot:d.screenshot,status:"pending",priority:d.priority}),r.success("æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼æˆ‘ä»¬ä¼šå°½å¿«å¤„ç†ã€‚"),l(),u({type:"bug",title:"",description:"",email:"",priority:"medium"})}catch(t){r.error("æäº¤åé¦ˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚")}finally{h(!1)}}},className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"åé¦ˆç±»å‹"}),t.jsx("select",{name:"type",value:d.type,onChange:f,className:`w-full px-4 py-2 rounded-lg border ${o?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}\n                focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[{value:"bug",label:"BugæŠ¥å‘Š"},{value:"feature",label:"åŠŸèƒ½è¯·æ±‚"},{value:"suggestion",label:"å»ºè®®"},{value:"other",label:"å…¶ä»–"}].map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"æ ‡é¢˜"}),t.jsx("input",{type:"text",name:"title",value:d.title,onChange:f,placeholder:"è¯·ç®€è¦æè¿°æ‚¨çš„åé¦ˆ",className:`w-full px-4 py-2 rounded-lg border ${o?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}\n                focus:outline-none focus:ring-2 focus:ring-blue-500 ${x.title?"border-red-500":""}`}),x.title&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.title})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"è¯¦ç»†æè¿°"}),t.jsx("textarea",{name:"description",value:d.description,onChange:f,placeholder:"è¯·è¯¦ç»†æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜æˆ–å»ºè®®",rows:5,className:`w-full px-4 py-2 rounded-lg border ${o?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}\n                focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none ${x.description?"border-red-500":""}`}),x.description&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.description})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"é‚®ç®±åœ°å€"}),t.jsx("input",{type:"email",name:"email",value:d.email,onChange:f,placeholder:"è¯·è¾“å…¥æ‚¨çš„é‚®ç®±ï¼Œä»¥ä¾¿æˆ‘ä»¬è”ç³»æ‚¨",className:`w-full px-4 py-2 rounded-lg border ${o?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}\n                focus:outline-none focus:ring-2 focus:ring-blue-500 ${x.email?"border-red-500":""}`}),x.email&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:x.email})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"ä¼˜å…ˆçº§"}),t.jsx("select",{name:"priority",value:d.priority,onChange:f,className:`w-full px-4 py-2 rounded-lg border ${o?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}\n                focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[{value:"low",label:"ä½"},{value:"medium",label:"ä¸­"},{value:"high",label:"é«˜"}].map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsx("button",{type:"submit",disabled:m,className:`w-full py-2 rounded-lg transition-colors ${o?"bg-blue-600 hover:bg-blue-500 disabled:bg-gray-600":"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300"}\n              text-white font-medium disabled:cursor-not-allowed flex items-center justify-center gap-2`,children:m?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-spinner fa-spin"}),"æäº¤ä¸­..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-paper-plane"}),"æäº¤åé¦ˆ"]})})]})]})}):null}},Symbol.toStringTag,{value:"Module"}));export{m as F,l as P,h as U,d as a,o as b};
