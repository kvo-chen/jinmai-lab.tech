import{v as e,r as t,j as o,g as r}from"./vendor-react-7rlDZYVK.js";const n={initialCenter:{x:500,y:500},initialZoom:4,minZoom:3,maxZoom:10,themes:[{name:"默认主题",backgroundColor:"#f8fafc",gridColor:"#e2e8f0",regionFillOpacity:.3,poiIconSize:14,pathColor:"#3b82f6",textColor:"#1e293b"},{name:"深色主题",backgroundColor:"#0f172a",gridColor:"#334155",regionFillOpacity:.4,poiIconSize:14,pathColor:"#60a5fa",textColor:"#f1f5f9"},{name:"高对比度主题",backgroundColor:"#ffffff",gridColor:"#d1d5db",regionFillOpacity:.5,poiIconSize:16,pathColor:"#ef4444",textColor:"#000000"}]},i=e((e,t)=>({center:n.initialCenter,zoom:n.initialZoom,targetZoom:n.initialZoom,targetCenter:n.initialCenter,theme:n.themes[0],themes:n.themes,regions:[],pois:[],paths:[],isDragging:!1,dragStart:null,lastDragPosition:null,dragVelocity:{x:0,y:0},width:0,height:0,hoveredPOIId:null,setConfig:t=>{e(e=>{const o={};return t.initialCenter&&(t.initialCenter.x===e.center.x&&t.initialCenter.y===e.center.y||(o.center=t.initialCenter)),void 0!==t.initialZoom&&t.initialZoom!==e.zoom&&(o.zoom=t.initialZoom),Object.keys(o).length>0?o:e})},setSize:(t,o)=>{e({width:t,height:o})},setInitialData:t=>{const o=(t.regions||[]).filter(e=>e&&e.id&&e.coordinates&&Array.isArray(e.coordinates)&&e.coordinates.length>0),r=(t.pois||[]).filter(e=>e&&e.id&&e.coordinate&&"number"==typeof e.coordinate.x&&!isNaN(e.coordinate.x)&&"number"==typeof e.coordinate.y&&!isNaN(e.coordinate.y)),n=(t.paths||[]).filter(e=>e&&e.id&&e.points&&Array.isArray(e.points)&&e.points.length>0);e({regions:o,pois:r,paths:n})},easeOutCubic:e=>1-Math.pow(1-e,3),setCenter:o=>{e({targetCenter:o});const r=performance.now(),n=t().center,i=Math.sqrt(Math.pow(o.x-n.x,2)+Math.pow(o.y-n.y,2)),a=Math.min(500,Math.max(100,.5*i)),l=()=>{const i=performance.now()-r,s=Math.min(i/a,1),c=t().easeOutCubic(s),d=o.x-n.x,h=o.y-n.y,f={x:n.x+d*c,y:n.y+h*c};e({center:f}),s<1&&requestAnimationFrame(l)};l()},updateCenter:t=>{e({center:t,targetCenter:t})},setZoom:o=>{const r=Math.max(n.minZoom,Math.min(n.maxZoom,o));e({targetZoom:r});const i=performance.now(),a=t().zoom,l=Math.abs(r-a),s=Math.min(400,Math.max(100,80*l)),c=()=>{const o=performance.now()-i,n=Math.min(o/s,1),l=t().easeOutCubic(n);e({zoom:a+(r-a)*l}),n<1&&requestAnimationFrame(c)};c()},updateZoom:t=>{const o=Math.max(n.minZoom,Math.min(n.maxZoom,t));e({zoom:o,targetZoom:o})},zoomIn:()=>{t().setZoom(t().targetZoom+1)},zoomOut:()=>{t().setZoom(t().targetZoom-1)},startDrag:t=>{e({isDragging:!0,dragStart:t,lastDragPosition:t,dragVelocity:{x:0,y:0}})},drag:o=>{const r=t();if(r.isDragging&&r.dragStart){const t=.5,n=(o.x-r.dragStart.x)*t,i=(o.y-r.dragStart.y)*t;if(Math.abs(n)<1||Math.abs(i)<1)return;const a={x:r.center.x-n,y:r.center.y-i};e({center:a,targetCenter:a,dragStart:o,lastDragPosition:o})}},endDrag:()=>{e({isDragging:!1,dragStart:null,dragVelocity:{x:0,y:0}})},addRegion:t=>{t&&t.id&&t.coordinates&&Array.isArray(t.coordinates)&&e(e=>({regions:[...e.regions,t]}))},removeRegion:t=>{e(e=>({regions:e.regions.filter(e=>e.id!==t)}))},clearRegions:()=>{e({regions:[]})},addPOI:t=>{t&&t.id&&t.coordinate&&e(e=>({pois:[...e.pois,t]}))},removePOI:t=>{e(e=>({pois:e.pois.filter(e=>e.id!==t)}))},clearPOIs:()=>{e({pois:[]})},addPath:t=>{t&&t.id&&t.points&&Array.isArray(t.points)&&e(e=>({paths:[...e.paths,t]}))},removePath:t=>{e(e=>({paths:e.paths.filter(e=>e.id!==t)}))},clearPaths:()=>{e({paths:[]})},setTheme:t=>e({theme:t}),updateTheme:t=>e({theme:t}),setHoveredPOI:t=>e({hoveredPOIId:t}),screenToWorld:e=>{const o=t(),r=Math.pow(2,o.zoom-1);return{x:o.center.x+(e.x-o.width/2)/r,y:o.center.y+(e.y-o.height/2)/r}},worldToScreen:e=>{const o=t(),r=Math.pow(2,o.zoom-1);return{x:o.width/2+(e.x-o.center.x)*r,y:o.height/2+(e.y-o.center.y)*r}},getViewport:()=>{const e=t(),o=Math.pow(2,e.zoom-1),r=e.width/o,n=e.height/o;return{x:e.center.x-r/2,y:e.center.y-n/2,width:r,height:n}}})),a=({className:e=""})=>{const r=t.useRef(null),n=t.useRef(null),[a,l]=t.useState(!1),{center:s,zoom:c,theme:d,regions:h,pois:f,paths:u,worldToScreen:g,getViewport:m,setSize:y,hoveredPOIId:x}=i(),w=t.useCallback(()=>{let e=800,t=600;if(n.current){const o=n.current.getBoundingClientRect(),i=window.devicePixelRatio||1;e=o.width||800,t=o.height||600;const a=r.current;if(a){a.width=e*i,a.height=t*i,a.style.width=`${e}px`,a.style.height=`${t}px`;const o=a.getContext("2d");o&&(o.clearRect(0,0,a.width,a.height),o.scale(i,i)),l(!0)}}y(e,t)},[y]);t.useEffect(()=>(w(),window.addEventListener("resize",w),window.addEventListener("orientationchange",w),()=>{window.removeEventListener("resize",w),window.removeEventListener("orientationchange",w)}),[w]);const p=t.useMemo(()=>({viewport:m(),scale:Math.pow(2,c-1)}),[s,c]),[b,v]=t.useState({renderTime:0,fps:60,poiCount:0,regionCount:0,pathCount:0,visiblePoiCount:0}),C=t.useRef({frameCount:0,lastTime:performance.now(),currentFps:60}),M=t.useCallback((e,t)=>{const o=performance.now();try{e.fillStyle=d.backgroundColor,e.fillRect(0,0,t.width,t.height),c<=6&&((e,t,o,r,n)=>{try{e.strokeStyle=d.gridColor,e.lineWidth=.5;const t=50*Math.pow(.5,Math.floor(c/2));e.fillStyle="rgba(255, 255, 255, 0.05)",e.fillRect(0,0,r,n);for(let o=-20;o<21;o++){const r=s.x+o*t,i=g({x:r,y:s.y}).x;e.beginPath(),e.moveTo(i,0),e.lineTo(i,n),e.stroke()}for(let o=-20;o<21;o++){const n=s.y+o*t,i=g({x:s.x,y:n}).y;e.beginPath(),e.moveTo(0,i),e.lineTo(r,i),e.stroke()}}catch(i){}})(e,p.viewport,p.scale,t.width,t.height),((e,t,o,r,n)=>{const i=t.filter(e=>{if(e.zoomLevel>o)return!1;if(e.coordinates.length<2)return!1;let t=Number.MAX_VALUE,r=Number.MAX_VALUE,i=Number.MIN_VALUE,a=Number.MIN_VALUE;for(const o of e.coordinates)t=Math.min(t,o.x),r=Math.min(r,o.y),i=Math.max(i,o.x),a=Math.max(a,o.y);return!(i<n.x||t>n.x+n.width||a<n.y||r>n.y+n.height)});0!==i.length&&i.forEach(t=>{try{e.beginPath();const n=r(t.coordinates[0]);if(isNaN(n.x)||isNaN(n.y))return;e.moveTo(n.x,n.y);let i=!0;for(let o=1;o<t.coordinates.length;o++){const n=r(t.coordinates[o]);if(isNaN(n.x)||isNaN(n.y)){i=!1;break}e.lineTo(n.x,n.y)}if(!i)return;if(e.closePath(),e.fillStyle=t.color,e.globalAlpha=d.regionFillOpacity,e.fill(),e.globalAlpha=1,e.strokeStyle=t.borderColor,e.lineWidth=t.borderWidth,e.lineJoin="round",e.lineCap="round",e.stroke(),o>=5){const o=t.coordinates.reduce((e,t)=>e+t.x,0)/t.coordinates.length,n=t.coordinates.reduce((e,t)=>e+t.y,0)/t.coordinates.length,i=r({x:o,y:n});e.fillStyle=d.backgroundColor,e.shadowColor="rgba(0, 0, 0, 0.3)",e.shadowBlur=4,e.font="bold 14px sans-serif",e.textAlign="center",e.textBaseline="middle";const a=e.measureText(t.name).width,l=24,s=8;e.fillRect(i.x-a/2-s,i.y-l/2,a+2*s,l),e.fillStyle=d.textColor,e.shadowBlur=0,e.fillText(t.name,i.x,i.y)}}catch(n){}})})(e,h,c,g,p.viewport),((e,t,o,r)=>{const n=t.filter(e=>{if(e.points.length<2)return!1;let t=Number.MAX_VALUE,o=Number.MAX_VALUE,n=Number.MIN_VALUE,i=Number.MIN_VALUE;for(const r of e.points){const e=r.coordinate;t=Math.min(t,e.x),o=Math.min(o,e.y),n=Math.max(n,e.x),i=Math.max(i,e.y)}return!(n<r.x||t>r.x+r.width||i<r.y||o>r.y+r.height)});0!==n.length&&n.forEach(t=>{try{e.beginPath();const r=o(t.points[0].coordinate);if(isNaN(r.x)||isNaN(r.y))return;e.moveTo(r.x,r.y);let n=!0;for(let i=1;i<t.points.length;i++){const r=o(t.points[i].coordinate);if(isNaN(r.x)||isNaN(r.y)){n=!1;break}e.lineTo(r.x,r.y)}if(!n)return;e.strokeStyle=t.color||"#3b82f6",e.lineWidth=t.width||3,e.lineCap="round",e.lineJoin="round",e.stroke(),c>=6&&t.points.forEach(r=>{try{if(r.isWaypoint){const n=o(r.coordinate);if(isNaN(n.x)||isNaN(n.y))return;e.fillStyle="#ffffff",e.beginPath(),e.arc(n.x,n.y,(t.width||3)+4,0,2*Math.PI),e.fill(),e.fillStyle=t.color||"#3b82f6",e.beginPath(),e.arc(n.x,n.y,(t.width||3)+2,0,2*Math.PI),e.fill()}}catch(n){}})}catch(r){}})})(e,u,g,p.viewport),((e,t,o,r,n)=>{if(0===t.length)return;const i=t,a=c<7,l=Math.max(20,Math.min(60,60-5*(c-1))),s=d.poiIconSize,h=Math.max(s,s*(1+.2*(c-1))*Math.min(o/1e3,1.5));if(a){const t={};i.forEach(e=>{const o=`${Math.floor(e.coordinate.x/l)},${Math.floor(e.coordinate.y/l)}`;t[o]||(t[o]=[]),t[o].push(e)}),Object.values(t).forEach(t=>{try{const o=t.reduce((e,t)=>e+(t.importance||1),0),r=t.reduce((e,t)=>e+t.coordinate.x*(t.importance||1),0)/o,i=t.reduce((e,t)=>e+t.coordinate.y*(t.importance||1),0)/o,a=n({x:r,y:i});if(isNaN(a.x)||isNaN(a.y))return;const l=t.length,c=Math.max(1.5*s,s+Math.min(.8*l,30));e.save(),e.shadowColor="rgba(0, 0, 0, 0.4)",e.shadowBlur=12,e.shadowOffsetX=0,e.shadowOffsetY=4;const d={};t.forEach(e=>{d[e.category]=(d[e.category]||0)+1});const f=Object.keys(d).reduce((e,t)=>d[e]>d[t]?e:t),u={food:"#ef4444",retail:"#3b82f6",craft:"#8b5cf6",landmark:"#f59e0b",culture:"#10b981",default:"#6b7280"},g=u[f]||u.default,m=e.createRadialGradient(a.x,a.y,0,a.x,a.y,c);m.addColorStop(0,g),m.addColorStop(1,g+"99"),e.fillStyle=m,e.beginPath(),e.arc(a.x,a.y,c,0,2*Math.PI),e.fill(),e.strokeStyle="#ffffff",e.lineWidth=3,e.stroke();const y=e.createRadialGradient(a.x,a.y,0,a.x,a.y,.6*c);y.addColorStop(0,"rgba(255, 255, 255, 0.8)"),y.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=y,e.beginPath(),e.arc(a.x,a.y,.6*c,0,2*Math.PI),e.fill(),e.restore();const x=t[0].name||"品牌集群";e.fillStyle="#ffffff",e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=8,e.shadowOffsetX=0,e.shadowOffsetY=2,e.font="bold 12px sans-serif";const w=e.measureText(x).width,p=6,b=20;if(e.fillRect(a.x-w/2-p,a.y-c-b-10,w+2*p,b),e.fillStyle="#000000",e.textAlign="center",e.textBaseline="middle",e.shadowBlur=0,e.fillText(x,a.x,a.y-c-10),e.fillStyle="#ffffff",e.font=`bold ${Math.min(.6*c,18)}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(l.toString(),a.x,a.y),l>1){e.save(),e.translate(a.x+.6*c,a.y-.6*c),e.scale(.5,.5),e.fillStyle="#ffffff",e.beginPath();const t=.8*h;e.fillStyle=g,e.beginPath(),e.arc(0,0,t,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",e.beginPath(),"food"===f?(e.arc(0,0,.7*t,0,2*Math.PI),e.fill(),e.fillStyle=g,e.fillRect(.2*-t,.6*-t,.4*t,1.2*t)):"retail"===f?(e.arc(0,0,t,0,Math.PI,!0),e.lineTo(-t,-t),e.lineTo(t,-t),e.closePath(),e.fill()):"craft"===f?(e.moveTo(-t,-t),e.lineTo(t,t),e.lineTo(t-.3*t,t),e.lineTo(.3*t-t,-t),e.closePath(),e.fill()):"landmark"===f?(e.fillRect(-t,-t,2*t,2*t),e.fill(),e.fillStyle=g,e.fillRect(.5*-t,-t,t,2*t)):"culture"===f?(e.fillRect(-t,-t,2*t,1.8*t),e.fill(),e.fillStyle=g,e.fillRect(-t,.3*-t,2*t,.15*t)):(e.arc(0,0,.5*t,0,2*Math.PI),e.fill()),e.restore()}e.save(),e.globalAlpha=.3,e.fillStyle=g,e.beginPath(),e.arc(a.x,a.y,1.2*c,0,2*Math.PI),e.fill(),e.restore()}catch(o){}})}else i.forEach(t=>{try{const o=n(t.coordinate);if(isNaN(o.x)||isNaN(o.y))return;const r=t.color||"#3b82f6",i=t.id===x,a=i?1.3*h:h;e.save(),e.shadowColor="rgba(0, 0, 0, 0.4)",e.shadowBlur=i?12:8,e.shadowOffsetX=0,e.shadowOffsetY=4;const l=e.createRadialGradient(o.x,o.y,0,o.x,o.y,a);l.addColorStop(0,r),l.addColorStop(1,r+"cc"),e.fillStyle=l,e.beginPath(),e.arc(o.x,o.y,a,0,2*Math.PI),e.fill(),e.strokeStyle="#ffffff",e.lineWidth=i?4:3,e.stroke(),e.restore(),e.fillStyle="#ffffff",e.save(),e.translate(o.x,o.y);const s=.7*a;e.beginPath(),"food"===t.category?(e.arc(0,0,.6*s,0,2*Math.PI),e.fill(),e.fillStyle=r,e.fillRect(.2*-s,.8*-s,.4*s,1.6*s),e.fillRect(.6*-s,.2*-s,1.2*s,.4*s)):"retail"===t.category?(e.moveTo(-s,-s),e.lineTo(-s,.8*s),e.arcTo(-s,s,0,s,s),e.arcTo(s,s,s,.8*s,s),e.lineTo(s,-s),e.lineTo(0,1.5*-s),e.closePath(),e.fill()):"craft"===t.category?(e.moveTo(.3*-s,-s),e.lineTo(.3*s,.3*-s),e.lineTo(s,0),e.lineTo(.3*s,.3*s),e.lineTo(.3*-s,s),e.lineTo(-s,0),e.closePath(),e.fill(),e.beginPath(),e.moveTo(s,0),e.lineTo(1.2*s,.3*-s),e.lineTo(1.2*s,.3*s),e.closePath(),e.fill()):"landmark"===t.category?(e.fillRect(-s,-s,2*s,2*s),e.beginPath(),e.moveTo(1.2*-s,-s),e.lineTo(0,1.5*-s),e.lineTo(1.2*s,-s),e.closePath(),e.fill(),e.fillRect(.25*-s,.3*s,.5*s,.7*s)):"culture"===t.category?(e.fillRect(-s,.6*-s,2*s,1.2*s),e.fillStyle=r,e.fillRect(1.1*-s,.7*-s,.2*s,1.4*s),e.fillStyle="#ffffff",e.fillRect(.8*-s,.2*-s,1.6*s,.1*s)):(e.arc(0,0,.8*s,0,2*Math.PI),e.fill(),e.fillStyle=r,e.arc(0,0,.3*s,0,2*Math.PI),e.fill()),e.restore(),e.fillStyle="#ffffff",e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=8,e.shadowOffsetX=0,e.shadowOffsetY=2;const c=t.name||"";e.font="bold 12px sans-serif";const f=e.measureText(c).width,u=6,g=20;if(e.fillRect(o.x-f/2-u,o.y-a-g-10,f+2*u,g),e.fillStyle="#000000",e.textAlign="center",e.shadowBlur=0,e.fillText(c,o.x,o.y-a-10),i){e.fillStyle=d.backgroundColor,e.shadowColor="rgba(0, 0, 0, 0.3)",e.shadowBlur=8,e.shadowOffsetX=0,e.shadowOffsetY=2;const r=t.name||"";e.font="bold 14px sans-serif";const n=e.measureText(r).width,i=10,l=24;if(e.fillRect(o.x-n/2-i,o.y-a-l-12,n+2*i,l),e.fillStyle=d.textColor,e.textAlign="center",e.shadowBlur=0,e.fillText(r,o.x,o.y-a-12+l/2),t.description){const r=t.description.length>30?t.description.substring(0,30)+"...":t.description;e.font="12px sans-serif";const n=e.measureText(r).width,s=20;e.fillStyle=d.backgroundColor,e.shadowBlur=8,e.fillRect(o.x-n/2-i,o.y-a-l-s-16,n+2*i,s),e.fillStyle=d.textColor,e.shadowBlur=0,e.fillText(r,o.x,o.y-a-l-16+s/2)}}}catch(o){}})})(e,f,t.width,t.height,g,p.viewport);const r=performance.now()-o,n=C.current;n.frameCount++;const i=performance.now();i-n.lastTime>=1e3&&(n.currentFps=Math.round(1e3*n.frameCount/(i-n.lastTime)),n.frameCount=0,n.lastTime=i),v(e=>({...e,renderTime:parseFloat(r.toFixed(2)),fps:n.currentFps,poiCount:f.length,regionCount:h.length,pathCount:u.length,visiblePoiCount:f.filter(e=>{const t=e.coordinate;return t.x>=p.viewport.x-100&&t.x<=p.viewport.x+p.viewport.width+100&&t.y>=p.viewport.y-100&&t.y<=p.viewport.y+p.viewport.height+100}).length}))}catch(r){}},[d,h,c,u,f,g,p,x]),k=t.useRef({animationFrameId:0,lastRenderTime:0,shouldRender:!1,renderRequestId:0});t.useEffect(()=>{k.current.renderRequestId&&cancelAnimationFrame(k.current.renderRequestId),k.current.shouldRender=!0,k.current.renderRequestId=requestAnimationFrame(()=>{0===k.current.animationFrameId&&(k.current.animationFrameId=requestAnimationFrame(S))})},[s,c,d,h,u,f,x,p]);const S=e=>{if(!a)return void(k.current.animationFrameId=0);const t=r.current;if(!t)return void(k.current.animationFrameId=0);const o=t.getContext("2d");if(o){if(k.current.shouldRender)try{M(o,t),k.current.lastRenderTime=e,k.current.shouldRender=!1}catch(n){}k.current.shouldRender?k.current.animationFrameId=requestAnimationFrame(S):k.current.animationFrameId=0}else k.current.animationFrameId=0};return t.useEffect(()=>{const e=()=>{k.current.shouldRender=!0,0===k.current.animationFrameId&&(k.current.animationFrameId=requestAnimationFrame(S))};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[a]),o.jsx("div",{ref:n,className:`${e} relative w-full h-full`,children:o.jsx("canvas",{ref:r,className:"w-full h-full",style:{display:"block",cursor:"grab",userSelect:"none"}})})},l=({children:e,onPOIClick:n,onMapClick:a})=>{const{isDragging:l,startDrag:s,drag:c,endDrag:d,setZoom:h,worldToScreen:f,setHoveredPOI:u}=i(),[g,m]=t.useState(null),[y,x]=t.useState(null),[w,p]=t.useState(null),[b,v]=t.useState(!1),C=r.useCallback(e=>{try{const t=25,o=i.getState(),r=o.zoom;if(void 0===r)return null;const n=o.pois,a=Math.min(40,t+2*(r-1)),l=a*a;for(const i of n){const t=f(i.coordinate),o=e.x-t.x,r=e.y-t.y;if(o*o+r*r<=l)return i}}catch(t){}return null},[f]),M=r.useCallback((e,t)=>{let o;return function(...r){clearTimeout(o),o=setTimeout(()=>{clearTimeout(o),e(...r)},t)}},[]),k=r.useCallback(M(e=>{const t=C(e);u(t?t.id:null)},30),[C,u]);return o.jsx("div",{style:{width:"100%",height:"100%",position:"relative",overflow:"hidden",cursor:l?"grabbing":"grab",touchAction:"none",background:"transparent"},onMouseDown:e=>{if(0!==e.button)return;const t={x:e.clientX,y:e.clientY};p(t),v(!0),s(t)},onMouseMove:e=>{const t={x:e.clientX,y:e.clientY};if(c(t),w){const t=e.clientX-w.x,o=e.clientY-w.y;Math.sqrt(t*t+o*o)>3&&v(!1)}if(!l)try{const t=e.currentTarget.getBoundingClientRect(),o=e.clientX-t.left,r=e.clientY-t.top;k({x:o,y:r})}catch(o){}},onMouseUp:()=>{d()},onMouseLeave:()=>{d(),u(null),v(!1),p(null)},onWheel:e=>{e.preventDefault(),e.stopPropagation();const t=i.getState().zoom;if(void 0===t)return;const o=.15*(1-.05*(t-1));let r=t+(e.deltaY>0?-o:o);r=Math.max(3,Math.min(10,r)),h(r)},onClick:e=>{try{const t=e.currentTarget.getBoundingClientRect(),o={x:e.clientX-t.left,y:e.clientY-t.top},r=i.getState();let l=null;const s=40,c=s*s;for(const e of r.pois){const t=r.worldToScreen(e.coordinate),n=o.x-t.x,i=o.y-t.y;if(n*n+i*i<=c){l=e;break}}if(l&&n)return n(l.id),v(!1),void p(null);if(a){const e=r.screenToWorld(o);a(e)}v(!1),p(null)}catch(t){v(!1),p(null)}},onContextMenu:e=>e.preventDefault(),onTouchStart:e=>{if(e.preventDefault(),1===e.touches.length){const t=e.touches[0],o={x:t.clientX,y:t.clientY};m(o),s(o)}else if(2===e.touches.length){const t=e.touches[0],o=e.touches[1],r=Math.sqrt(Math.pow(o.clientX-t.clientX,2)+Math.pow(o.clientY-t.clientY,2));x(r)}},onTouchMove:e=>{if(e.preventDefault(),1===e.touches.length){if(!g)return;const t=e.touches[0],o={x:t.clientX,y:t.clientY};c(o),m(o)}else if(2===e.touches.length){const t=e.touches[0],o=e.touches[1],r=Math.sqrt(Math.pow(o.clientX-t.clientX,2)+Math.pow(o.clientY-t.clientY,2));if(y){const e=r/y,t=i.getState().zoom;h(t+.5*(e-1))}x(r)}},onTouchEnd:e=>{e.preventDefault(),m(null),x(null),d()},onTouchCancel:()=>{m(null),x(null),d()},children:e})},s=({className:e=""})=>{const{zoom:t,zoomIn:r,zoomOut:a,updateCenter:l,themes:s,setTheme:c,getViewport:d}=i(),h=n.minZoom,f=n.maxZoom;d();const u=1/Math.pow(2,t-1)/100;return o.jsxs("div",{className:`absolute top-4 right-4 z-10 flex flex-col gap-2 ${e}`,children:[o.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[o.jsx("button",{className:"w-10 h-10 flex items-center justify-center text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-lg transition-colors",onClick:r,disabled:t>=f,"aria-label":"放大地图",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),o.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700"}),o.jsx("div",{className:"w-10 h-10 flex items-center justify-center text-gray-600 dark:text-gray-400 text-sm font-medium",children:t}),o.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700"}),o.jsx("button",{className:"w-10 h-10 flex items-center justify-center text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-lg transition-colors",onClick:a,disabled:t<=h,"aria-label":"缩小地图",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})})]}),o.jsx("button",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 w-10 h-10 flex items-center justify-center text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>{try{const e=i.getState().theme;if(!s||!e)return;const t=(s.findIndex(t=>t.name===e.name)+1)%s.length;c(s[t])}catch(e){}},"aria-label":"切换地图主题",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})})}),o.jsx("button",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 w-10 h-10 flex items-center justify-center text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>{l({x:500,y:500})},"aria-label":"重置地图视图",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.33 5.88 3 6.27 3 6.695V18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z"})})}),o.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 px-3 py-2 flex items-center gap-2",children:[o.jsx("div",{className:"h-4 border-r border-gray-300 dark:border-gray-600 w-1"}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("div",{className:"w-12 h-1 bg-blue-500"}),o.jsx("div",{className:"w-6 h-1 border border-gray-300 dark:border-gray-600 bg-transparent"})]}),o.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 whitespace-nowrap",children:[(18*u).toFixed(1)," km"]})]})]})},c=({width:e,height:r,config:n={},initialRegions:c=[],initialPOIs:d=[],initialPaths:h=[],onPOIClick:f,onMapClick:u,className:g="",style:m})=>{const y=t.useRef(null),{setSize:x,setInitialData:w}=i(),[p,b]=t.useState(!1),v=()=>{if(!y.current)return;const e=y.current.getBoundingClientRect(),t=e.width||800,o=e.height||600;x(t,o),!p&&t>0&&o>0&&b(!0)};return t.useEffect(()=>(v(),window.addEventListener("resize",v),()=>{window.removeEventListener("resize",v)}),[x,p]),t.useEffect(()=>{v()},[e,r,x,p]),t.useEffect(()=>{try{w({regions:c||[],pois:d||[],paths:h||[]})}catch(e){}},[c,d,h,w]),o.jsxs("div",{ref:y,className:`relative w-full h-full ${g} overflow-hidden`,style:m,children:[o.jsx(l,{onPOIClick:e=>{f&&f(e)},onMapClick:e=>{u&&u(e)},children:o.jsx(a,{className:"w-full h-full"})}),o.jsx(s,{})]})};export{c as V};
