# Navicat 连接指南

## 1. 简介

Navicat 是一款强大的数据库管理工具，支持多种数据库类型，包括 SQLite。本指南将帮助您使用 Navicat 连接到项目的 SQLite 数据库，以便进行数据库管理、查询和维护。

## 2. 连接准备

### 2.1 确认数据库文件位置

项目的 SQLite 数据库文件默认位于：
```
项目根目录/data/app.db
```

如果您通过环境变量自定义了数据库路径，请使用自定义的路径。

### 2.2 安装 Navicat

确保您已经安装了 Navicat 软件。如果尚未安装，可以从 [Navicat 官网](https://www.navicat.com.cn/) 下载并安装。

## 3. 连接步骤

### 3.1 打开 Navicat

启动 Navicat 软件，进入主界面。

### 3.2 创建新连接

1. 点击左上角的「连接」按钮，或选择「文件」→「新建连接」→「SQLite」。
2. 在弹出的「SQLite - 新建连接」对话框中，填写以下信息：

   | 选项 | 说明 |
   |------|------|
   | 连接名 | 自定义名称，如「项目数据库」 |
   | 连接类型 | 选择「SQLite 文件」 |
   | 数据库文件 | 点击「浏览」按钮，选择项目根目录下的 `data/app.db` 文件 |
   | 密码 | 如果数据库设置了密码，请填写；否则留空 |
   | 编码 | 保持默认（UTF-8） |

3. 点击「测试连接」按钮，确认连接成功。
4. 点击「确定」按钮，保存连接配置。

### 3.3 连接到数据库

在 Navicat 左侧的「连接」面板中，找到您刚刚创建的连接，双击即可连接到数据库。

## 4. 常用操作

### 4.1 查看表结构

1. 连接成功后，展开连接节点，点击「表」。
2. 右键点击要查看的表（如 `favorites` 或 `video_tasks`），选择「设计表」。
3. 在弹出的窗口中，可以查看和修改表结构。

### 4.2 执行 SQL 查询

1. 点击工具栏中的「查询」按钮，或选择「工具」→「SQL 编辑器」→「新建查询」。
2. 在 SQL 编辑器中输入 SQL 语句，例如：
   ```sql
   SELECT * FROM favorites;
   SELECT * FROM video_tasks WHERE status = 'completed';
   ```
3. 点击「运行」按钮，执行查询。
4. 在下方的「结果」面板中查看查询结果。

### 4.3 管理数据

1. 展开连接节点，点击「表」。
2. 双击要管理的表，进入数据视图。
3. 可以直接在表格中添加、修改或删除数据。
4. 修改完成后，点击「保存」按钮保存更改。

### 4.4 导出数据

1. 右键点击要导出的表，选择「导出向导」。
2. 选择导出格式（如 CSV、Excel、SQL 等）。
3. 按照向导提示完成导出设置。
4. 点击「开始」按钮，执行导出操作。

### 4.5 导入数据

1. 右键点击要导入数据的表，选择「导入向导」。
2. 选择导入格式和数据源。
3. 按照向导提示完成导入设置。
4. 点击「开始」按钮，执行导入操作。

## 5. 数据库结构说明

### 5.1 表结构

#### 5.1.1 favorites 表

| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | INTEGER | 教程ID，主键 |

#### 5.1.2 video_tasks 表

| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | TEXT | 任务ID，主键 |
| status | TEXT | 任务状态 |
| model | TEXT | 使用的模型 |
| created_at | INTEGER | 创建时间戳 |
| updated_at | INTEGER | 更新时间戳 |
| payload_json | TEXT | 任务参数（JSON格式） |

#### 5.1.3 schema_migrations 表

| 字段名 | 类型 | 描述 |
|--------|------|------|
| version | INTEGER | 迁移版本号，主键 |
| applied_at | INTEGER | 迁移应用时间戳 |

### 5.2 索引

- `idx_video_tasks_status`：video_tasks 表的 status 字段索引
- `idx_video_tasks_created_at`：video_tasks 表的 created_at 字段索引
- `idx_video_tasks_updated_at`：video_tasks 表的 updated_at 字段索引

## 6. 故障排除

### 6.1 连接失败

- **问题**：无法连接到数据库，提示「文件不存在」或「无法打开数据库文件」。
- **解决方案**：
  1. 检查数据库文件路径是否正确。
  2. 确认数据库文件存在且有读取权限。
  3. 检查 Navicat 是否有足够的权限访问该文件。

### 6.2 查询执行缓慢

- **问题**：执行查询时速度较慢。
- **解决方案**：
  1. 确保查询条件使用了索引字段。
  2. 优化查询语句，避免全表扫描。
  3. 考虑增加更多索引（但不要过度索引）。

### 6.3 数据丢失

- **问题**：修改数据后，数据丢失或未保存。
- **解决方案**：
  1. 确保修改后点击了「保存」按钮。
  2. 检查数据库文件是否有写入权限。
  3. 定期备份数据库文件。

## 7. 最佳实践

1. **定期备份**：定期备份数据库文件，避免数据丢失。
2. **使用事务**：执行复杂操作时，使用事务确保数据一致性。
3. **优化查询**：编写高效的 SQL 查询，避免全表扫描。
4. **合理使用索引**：根据查询需求添加适当的索引，提高查询性能。
5. **避免直接修改生产数据**：在生产环境中，尽量避免直接修改数据，而是通过应用程序接口进行操作。
6. **使用参数化查询**：防止 SQL 注入攻击。
7. **定期清理数据**：定期清理过期或无用的数据，保持数据库性能。

## 8. 环境变量配置

项目支持通过环境变量自定义数据库配置，相关环境变量如下：

| 环境变量 | 说明 | 默认值 |
|----------|------|--------|
| DB_DATA_DIR | 数据目录路径 | 项目根目录/data |
| DB_FILE | 数据库文件路径 | 项目根目录/data/app.db |
| DB_JSON_FILE | JSON 后备存储文件路径 | 项目根目录/data/db.json |
| DB_MAX_RETRIES | 连接重试次数 | 3 |
| DB_RETRY_DELAY | 连接重试延迟（毫秒） | 1000 |
| DB_TIMEOUT | 连接超时时间（毫秒） | 5000 |
| DB_VERBOSE | 是否启用详细日志 | false |

您可以在项目根目录创建 `.env` 文件，设置这些环境变量。

## 9. 联系支持

如果您在使用 Navicat 连接数据库时遇到问题，可以：

1. 查看项目的 README 文件，了解更多信息。
2. 检查项目的日志文件，查找错误信息。
3. 联系项目开发团队，寻求技术支持。

---

希望本指南能帮助您顺利使用 Navicat 连接和管理项目数据库。祝您使用愉快！